!function(e){var t=window.webpackHotUpdate;window.webpackHotUpdate=function(e,n){!function(e,t){if(!w[e]||!b[e])return;for(var n in b[e]=!1,t)Object.prototype.hasOwnProperty.call(t,n)&&(f[n]=t[n]);0==--y&&0===g&&S()}(e,n),t&&t(e,n)};var n,r=!0,i="9b1e5320c1e2cacdb917",o={},a=[],s=[];function u(e){var t=C[e];if(!t)return M;var r=function(r){return t.hot.active?(C[r]?-1===C[r].parents.indexOf(e)&&C[r].parents.push(e):(a=[e],n=r),-1===t.children.indexOf(r)&&t.children.push(r)):(console.warn("[HMR] unexpected require("+r+") from disposed module "+e),a=[]),M(r)},i=function(e){return{configurable:!0,enumerable:!0,get:function(){return M[e]},set:function(t){M[e]=t}}};for(var o in M)Object.prototype.hasOwnProperty.call(M,o)&&"e"!==o&&"t"!==o&&Object.defineProperty(r,o,i(o));return r.e=function(e){return"ready"===h&&d("prepare"),g++,M.e(e).then(t,(function(e){throw t(),e}));function t(){g--,"prepare"===h&&(x[e]||_(e),0===g&&0===y&&S())}},r.t=function(e,t){return 1&t&&(e=r(e)),M.t(e,-2&t)},r}function c(t){var r={_acceptedDependencies:{},_declinedDependencies:{},_selfAccepted:!1,_selfDeclined:!1,_selfInvalidated:!1,_disposeHandlers:[],_main:n!==t,active:!0,accept:function(e,t){if(void 0===e)r._selfAccepted=!0;else if("function"==typeof e)r._selfAccepted=e;else if("object"==typeof e)for(var n=0;n<e.length;n++)r._acceptedDependencies[e[n]]=t||function(){};else r._acceptedDependencies[e]=t||function(){}},decline:function(e){if(void 0===e)r._selfDeclined=!0;else if("object"==typeof e)for(var t=0;t<e.length;t++)r._declinedDependencies[e[t]]=!0;else r._declinedDependencies[e]=!0},dispose:function(e){r._disposeHandlers.push(e)},addDisposeHandler:function(e){r._disposeHandlers.push(e)},removeDisposeHandler:function(e){var t=r._disposeHandlers.indexOf(e);t>=0&&r._disposeHandlers.splice(t,1)},invalidate:function(){switch(this._selfInvalidated=!0,h){case"idle":(f={})[t]=e[t],d("ready");break;case"ready":N(t);break;case"prepare":case"check":case"dispose":case"apply":(m=m||[]).push(t)}},check:E,apply:O,status:function(e){if(!e)return h;l.push(e)},addStatusHandler:function(e){l.push(e)},removeStatusHandler:function(e){var t=l.indexOf(e);t>=0&&l.splice(t,1)},data:o[t]};return n=void 0,r}var l=[],h="idle";function d(e){h=e;for(var t=0;t<l.length;t++)l[t].call(null,e)}var p,f,v,m,y=0,g=0,x={},b={},w={};function T(e){return+e+""===e?+e:e}function E(e){if("idle"!==h)throw new Error("check() is only allowed in idle status");return r=e,d("check"),(t=1e4,t=t||1e4,new Promise((function(e,n){if("undefined"==typeof XMLHttpRequest)return n(new Error("No browser support"));try{var r=new XMLHttpRequest,o=M.p+""+i+".hot-update.json";r.open("GET",o,!0),r.timeout=t,r.send(null)}catch(e){return n(e)}r.onreadystatechange=function(){if(4===r.readyState)if(0===r.status)n(new Error("Manifest request to "+o+" timed out."));else if(404===r.status)e();else if(200!==r.status&&304!==r.status)n(new Error("Manifest request to "+o+" failed."));else{try{var t=JSON.parse(r.responseText)}catch(e){return void n(e)}e(t)}}}))).then((function(e){if(!e)return d(R()?"ready":"idle"),null;b={},x={},w=e.c,v=e.h,d("prepare");var t=new Promise((function(e,t){p={resolve:e,reject:t}}));f={};return _(0),"prepare"===h&&0===g&&0===y&&S(),t}));var t}function _(e){w[e]?(b[e]=!0,y++,function(e){var t=document.createElement("script");t.charset="utf-8",t.src=M.p+""+e+"."+i+".hot-update.js",document.head.appendChild(t)}(e)):x[e]=!0}function S(){d("ready");var e=p;if(p=null,e)if(r)Promise.resolve().then((function(){return O(r)})).then((function(t){e.resolve(t)}),(function(t){e.reject(t)}));else{var t=[];for(var n in f)Object.prototype.hasOwnProperty.call(f,n)&&t.push(T(n));e.resolve(t)}}function O(t){if("ready"!==h)throw new Error("apply() is only allowed in ready status");return function t(r){var s,u,c,l,h;function p(e){for(var t=[e],n={},r=t.map((function(e){return{chain:[e],id:e}}));r.length>0;){var i=r.pop(),o=i.id,a=i.chain;if((l=C[o])&&(!l.hot._selfAccepted||l.hot._selfInvalidated)){if(l.hot._selfDeclined)return{type:"self-declined",chain:a,moduleId:o};if(l.hot._main)return{type:"unaccepted",chain:a,moduleId:o};for(var s=0;s<l.parents.length;s++){var u=l.parents[s],c=C[u];if(c){if(c.hot._declinedDependencies[o])return{type:"declined",chain:a.concat([u]),moduleId:o,parentId:u};-1===t.indexOf(u)&&(c.hot._acceptedDependencies[o]?(n[u]||(n[u]=[]),y(n[u],[o])):(delete n[u],t.push(u),r.push({chain:a.concat([u]),id:u})))}}}}return{type:"accepted",moduleId:e,outdatedModules:t,outdatedDependencies:n}}function y(e,t){for(var n=0;n<t.length;n++){var r=t[n];-1===e.indexOf(r)&&e.push(r)}}R();var g={},x=[],b={},E=function(){console.warn("[HMR] unexpected require("+S.moduleId+") to disposed module")};for(var _ in f)if(Object.prototype.hasOwnProperty.call(f,_)){var S;h=T(_),S=f[_]?p(h):{type:"disposed",moduleId:_};var O=!1,N=!1,D=!1,P="";switch(S.chain&&(P="\nUpdate propagation: "+S.chain.join(" -> ")),S.type){case"self-declined":r.onDeclined&&r.onDeclined(S),r.ignoreDeclined||(O=new Error("Aborted because of self decline: "+S.moduleId+P));break;case"declined":r.onDeclined&&r.onDeclined(S),r.ignoreDeclined||(O=new Error("Aborted because of declined dependency: "+S.moduleId+" in "+S.parentId+P));break;case"unaccepted":r.onUnaccepted&&r.onUnaccepted(S),r.ignoreUnaccepted||(O=new Error("Aborted because "+h+" is not accepted"+P));break;case"accepted":r.onAccepted&&r.onAccepted(S),N=!0;break;case"disposed":r.onDisposed&&r.onDisposed(S),D=!0;break;default:throw new Error("Unexception type "+S.type)}if(O)return d("abort"),Promise.reject(O);if(N)for(h in b[h]=f[h],y(x,S.outdatedModules),S.outdatedDependencies)Object.prototype.hasOwnProperty.call(S.outdatedDependencies,h)&&(g[h]||(g[h]=[]),y(g[h],S.outdatedDependencies[h]));D&&(y(x,[S.moduleId]),b[h]=E)}var L,k=[];for(u=0;u<x.length;u++)h=x[u],C[h]&&C[h].hot._selfAccepted&&b[h]!==E&&!C[h].hot._selfInvalidated&&k.push({module:h,parents:C[h].parents.slice(),errorHandler:C[h].hot._selfAccepted});d("dispose"),Object.keys(w).forEach((function(e){!1===w[e]&&function(e){delete installedChunks[e]}(e)}));var I,A,j=x.slice();for(;j.length>0;)if(h=j.pop(),l=C[h]){var H={},F=l.hot._disposeHandlers;for(c=0;c<F.length;c++)(s=F[c])(H);for(o[h]=H,l.hot.active=!1,delete C[h],delete g[h],c=0;c<l.children.length;c++){var z=C[l.children[c]];z&&((L=z.parents.indexOf(h))>=0&&z.parents.splice(L,1))}}for(h in g)if(Object.prototype.hasOwnProperty.call(g,h)&&(l=C[h]))for(A=g[h],c=0;c<A.length;c++)I=A[c],(L=l.children.indexOf(I))>=0&&l.children.splice(L,1);d("apply"),void 0!==v&&(i=v,v=void 0);for(h in f=void 0,b)Object.prototype.hasOwnProperty.call(b,h)&&(e[h]=b[h]);var V=null;for(h in g)if(Object.prototype.hasOwnProperty.call(g,h)&&(l=C[h])){A=g[h];var B=[];for(u=0;u<A.length;u++)if(I=A[u],s=l.hot._acceptedDependencies[I]){if(-1!==B.indexOf(s))continue;B.push(s)}for(u=0;u<B.length;u++){s=B[u];try{s(A)}catch(e){r.onErrored&&r.onErrored({type:"accept-errored",moduleId:h,dependencyId:A[u],error:e}),r.ignoreErrored||V||(V=e)}}}for(u=0;u<k.length;u++){var J=k[u];h=J.module,a=J.parents,n=h;try{M(h)}catch(e){if("function"==typeof J.errorHandler)try{J.errorHandler(e)}catch(t){r.onErrored&&r.onErrored({type:"self-accept-error-handler-errored",moduleId:h,error:t,originalError:e}),r.ignoreErrored||V||(V=t),V||(V=e)}else r.onErrored&&r.onErrored({type:"self-accept-errored",moduleId:h,error:e}),r.ignoreErrored||V||(V=e)}}if(V)return d("fail"),Promise.reject(V);if(m)return t(r).then((function(e){return x.forEach((function(t){e.indexOf(t)<0&&e.push(t)})),e}));return d("idle"),new Promise((function(e){e(x)}))}(t=t||{})}function R(){if(m)return f||(f={}),m.forEach(N),m=void 0,!0}function N(t){Object.prototype.hasOwnProperty.call(f,t)||(f[t]=e[t])}var C={};function M(t){if(C[t])return C[t].exports;var n=C[t]={i:t,l:!1,exports:{},hot:c(t),parents:(s=a,a=[],s),children:[]};return e[t].call(n.exports,n,n.exports,u(t)),n.l=!0,n.exports}M.m=e,M.c=C,M.d=function(e,t,n){M.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},M.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},M.t=function(e,t){if(1&t&&(e=M(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(M.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)M.d(n,r,function(t){return e[t]}.bind(null,r));return n},M.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return M.d(t,"a",t),t},M.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},M.p="./",M.h=function(){return i},u("./editorgl/index.js")(M.s="./editorgl/index.js")}({"./editorgl/index.js":function(e,t,n){"use strict";n.r(t);var r=n("./node_modules/@babel/runtime/helpers/defineProperty.js"),i=n.n(r),o=n("./node_modules/@babel/runtime/helpers/classCallCheck.js"),a=n.n(o),s=n("./node_modules/@babel/runtime/helpers/createClass.js"),u=n.n(s),c=n("./node_modules/@babel/runtime/helpers/classPrivateFieldGet.js"),l=n.n(c),h=n("./node_modules/@babel/runtime/helpers/typeof.js"),d=n.n(h),p={type_1:function(e){return(e*=2)>1?.5*e*(e-2)+1:.5*e*(2-e)},type_2:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)},type_3:function(e){return e*(2-e)},type_4:function(e){return e*e},type_5:function(e){return e*=2,.5*(--e*e*e+1)},type_6:function(e){return(e*=2)<1?.5*e*e*e:e=.5*((e-=2)*e*e+2)},type_7:function(e){return--e*e*e+1},type_8:function(e){return e*e*e},type_9:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375}},f=[Number,String,Date,RegExp,HTMLElement,NodeList,Boolean,Function],v={_cId:0,creatId:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"ce";this._cId++;var t=[(Date.now()+this._cId).toString(16),Math.random().toString().substr(2,5),Math.random().toString(36).substr(2,6)],n=t[0],r=t[1],i=t[2],o="".concat(e,"_").concat(i).concat(n.substr(n.length-5)).concat(r);return o},isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},isFunction:function(e){return"[object Function]"===Object.prototype.toString.call(e)},toFunction:function(e){return this.isFunction(e)?e:function(){}},exeFunction:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];this.isFunction(e)&&e.call.apply(e,n)},isDomElement:function(e){return!!(e instanceof HTMLElement)||!(!e||"object"!==d()(e)||1!==e.nodeType||"string"!=typeof e.nodeName)},clamp:function(e,t,n,r){return Math.min(n,Math.max(t,Number.isNaN(e)?r:e))},lerp:function(e,t,n){return e+(t-e)*n},limit:function(e,t){return-1!==t.indexOf(e)?e:t[0]},toNum:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return e-=0,Number.isNaN(e)?t:e},greater:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.001;return e-=0,Number.isNaN(e)?t:Math.max(t,e)},initParams:function(e,t,n){for(var r=0;r<n.length;r++){var i=n[r];Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}},setObjParams:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object.keys(t).forEach((function(n){Object.prototype.hasOwnProperty.call(e,n)&&(e[n]=t[n])}))},easing:function(e,t){return this.isFunction(t)&&(e=e<=0?0:e>=1?1:t(e)),e},getEasingFun:function(e){return p["type_".concat(e)]},setEasingFun:function(e,t){this.isFunction(t)&&(p["type_".concat(e)]=t)},checkStr:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;return!(!e||!t)&&(1===n?e===t:0===e.indexOf(t)||0===t.indexOf(e))},startsWith:function(e,t){return e.slice(0,t.length)===t},endsWith:function(e,t){return e.slice(-t.length)===t},deepClone:function(e){var t,n=this,r=Object.prototype.toString.call(e);if("[object Array]"===r){if(t=[],e.length>0)for(var i=0;i<e.length;i++)t.push(this.deepClone(e[i]))}else"[object Object]"===r?(t={},Object.keys(e).forEach((function(r){t[r]=n.deepClone(e[r])}))):t=e;return t},removeArrItem:function(e,t){for(var n=e.length-1;n>=0;n--)if(e[n]===t){e.splice(n,1);break}return e},removeArrItem2:function(e,t){return e.filter((function(e){return e!==t}))},now:function(){return(new Date).getTime()},throttle:function(e,t,n){var r,i,o,a=null,s=0;n||(n={});var u=function(){s=!1===n.leading?0:v.now(),a=null,o=e.apply(r,i),a||(i=null,r=null)},c=function(){var c=v.now();s||!1!==n.leading||(s=c);var l=t-(c-s);r=this;for(var h=arguments.length,d=new Array(h),p=0;p<h;p++)d[p]=arguments[p];return i=d,l<=0||l>t?(a&&(clearTimeout(a),a=null),s=c,o=e.apply(r,i),a||(i=null,r=null)):a||!1===n.trailing||(a=setTimeout(u,l)),o};return c.cancel=function(){clearTimeout(a),s=0,i=null,r=null,a=null},c},isSimpleObj:function(e){var t=e&&e.constructor===Proxy;return t||"object"!==d()(e)&&!t||null==e||!t&&f.some((function(t){return e instanceof t}))},copy:function(e,t){var n=this;return Object.keys(t).forEach((function(r){var i=t[r];n.isSimpleObj(i)?e[r]=i:n.isSimpleObj(e[r])?e[r]=n.copy(i instanceof Array?[]:{},i):e[r]=n.copy(e[r],i)})),e},extend:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=Reflect.apply(Array.prototype.splice,t,[0]);if(r[0]instanceof Boolean||"boolean"==typeof r[0]){var i=r.splice(0,1)[0];if(i){var o=r.splice(0,1)[0];return r.forEach((function(e){return v.copy(o,e)})),o}}return Reflect.apply(Object.assign,Object,r)},loopObject:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};Object.keys(e||{}).forEach(t)},clearObject:function(e){this.loopObject(e,(function(t){Reflect.deleteProperty(e,t)}))},isEqual:function(e,t){if(e===t)return!0;if(JSON.stringify(e)===JSON.stringify(t))return!0;if(this.isSimpleObj(e)||this.isSimpleObj(t)||this.isArray(e)||this.isArray(t))return!1;var n=[Object.getOwnPropertyNames(e),Object.getOwnPropertyNames(t)],r=n[0],i=n[1];if(r.length!==i.length)return!1;for(var o=0;o<r.length;o++){var a=r[o];if(Object.prototype.hasOwnProperty.call(t,a))return!1;var s=[e[a],t[a]],u=s[0],c=s[1];if("object"===d()(u)){if(!this.isEqual(u,c))return!1}else if(u!==c)return!1}return!0},getMercator:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:180,r=e*n/180,i=t;if(t<67&&t>-67){var o=Math.PI/360,a=n/Math.PI;i=Math.log(Math.tan((90+t)*o))*a}return{mx:r,my:i}},getSegPoint:function(e,t,n){var r={};return Object.keys(e).forEach((function(i){r[i]=e[i]-e[i]*n+t[i]*n})),r},canvasToImg:function(e,t,n,r){t=this.toNum(t,1),n=this.toNum(n,1),r=r||"#24292D";var i=[],o=i[1],a=i[2];a=(o=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")).getContext("2d"),o.width=t,o.height=n,a.fillStyle=r,a.fillRect(0,0,t,n),a.imageSmoothingQuality="high";var s,u,c,l,h,d,p,f,v,m,y,g=(s=t,u=n,c=e.width,l=e.height,d=(h=[])[0],p=h[1],f=h[2],v=h[3],(m=s/c)>=(y=u/l)?(d=0,f=c,p=(l-u/m)/2,v=u/m):(d=(c-s/y)/2,f=s/y,p=0,v=l),{sx:d,sy:p,sw:f,sh:v});return a.drawImage(e,g.sx,g.sy,g.sw,g.sh,0,0,t,n),o.toDataURL("image/jpeg",1).replace("image/jpeg","image/octet-stream")},eachObject:function(e,t){Object.keys(e).forEach((function(n,r){t&&t(e[n],n,r)}))}},m=v;window._isSupportWebGL=-1;var y={mtl:{point:function(e){return new THREE.PointsMaterial(e)},sprite:function(e){return new THREE.SpriteMaterial(e)},line:function(e){return new THREE.LineBasicMaterial(e)},lineD:function(e){return new THREE.LineDashedMaterial(e)},shader:function(e){return new THREE.ShaderMaterial(e)},basic:function(e){return new THREE.MeshBasicMaterial(e)},phong:function(e){return new THREE.MeshPhongMaterial(e)},lambert:function(e){return new THREE.MeshLambertMaterial(e)},standard:function(e){return new THREE.MeshStandardMaterial(e)}},geo:{geo:function(){return new THREE.Geometry},buf:function(){return new THREE.BufferGeometry},insBuf:function(){return new THREE.InstancedBufferGeometry},shape:function(e,t){return new THREE.ShapeBufferGeometry(e,t)},extrude:function(e,t){return new THREE.ExtrudeBufferGeometry(e,t)},plane:function(e,t,n,r){return new THREE.PlaneBufferGeometry(e,t,n,r)},circle:function(e,t){return new THREE.CircleBufferGeometry(e,t)},box:function(e,t,n){return new THREE.BoxBufferGeometry(e,t,n)},sphere:function(e,t,n,r,i,o,a){return new THREE.SphereBufferGeometry(e,t,n,r,i,o,a)},torus:function(e,t,n,r){return new THREE.TorusBufferGeometry(e,t,n,r)},Icosah:function(e,t){return new THREE.IcosahedronBufferGeometry(e,t)},cylinder:function(e,t,n,r,i){return new THREE.CylinderBufferGeometry(e,t,n,r,1,i)}},PI:3.141592653589793,M_PI:6.283185307179586,M_PI2:1.5707963267948966,wh:400,txueLoader:new THREE.TextureLoader,obj:function(e){var t=new THREE.Object3D;return t.name=e,t.userData.describe=e,t},group:function(e){var t=new THREE.Group;return t.name=e,t.userData.describe=e,t},color:function(e){return new THREE.Color(e)},creatCGeo:function(e){return(new THREE.CurvePath).createGeometry(e)},tgShape:function(e,t){return THREE.ShapeUtils.triangulateShape(e,t)},detector:function(){if(-1!==window._isSupportWebGL)return window._isSupportWebGL;try{return window._isSupportWebGL=!!window.WebGLRenderingContext&&!!document.createElement("canvas").getContext("webgl"),window._isSupportWebGL}catch(e){return window._isSupportWebGL=!1,window._isSupportWebGL}},reverse:function(e){THREE.ShapeUtils.isClockWise(e)||(e=e.reverse())},holeReverse:function(e){THREE.ShapeUtils.isClockWise(e)&&(e=e.reverse())},getColorArr:function(e){function t(e){return 1===e.length?"0".concat(e):"".concat(e)}if(m.isArray(e))return e;var n=[],r="".concat(e).toLowerCase().replace(/\s/g,"");if(/^((?:rgba)?)\(\s*([^)]*)/.test(r)){var i=r.replace(/rgba\(|\)/gi,"").split(","),o=[t(Math.round(i[0]-0||0).toString(16)),t(Math.round(i[1]-0||0).toString(16)),t(Math.round(i[2]-0||0).toString(16))];n[0]=this.color("#".concat(o.join(""))),n[1]=Math.max(0,Math.min(1,i[3]-0||0))}else"transparent"===e?(n[0]=this.color(),n[1]=0):(n[0]=this.color(e),n[1]=1);return n},getRGBColor:function(e){if(!this.isArray(e))return e;if(!e[0].isColor)return e;var t=e[0].clone().multiplyScalar(255),n=Number.isNaN(e[1])?1:e[1];return"rgba(".concat(0|t.r,",").concat(0|t.g,",").concat(0|t.b,",").concat(n,")")},transCoord:function(e,t){var n=t.width/2,r=t.height/2,i=e.clone().applyMatrix4(t.scene.matrix).project(t.camera),o=i.x*n+n,a=-i.y*r+r;return new THREE.Vector2(o,a)},transPosition:function(e,t,n){var r=new THREE.Vector3,i=new THREE.Vector3;r.set(e.x/n.width*2-1,-e.y/n.height*2+1,.5),r.unproject(n.camera),r.sub(n.camera.position).normalize();var o=(t-n.camera.position.y)/r.y;return i.copy(n.camera.position).add(r.multiplyScalar(o)),i},disposeArr:function(e){Object.keys(e||{}).forEach((function(t){e[t].dispose&&e[t].dispose(),delete e[t]}))},disposeObj:function(e){e&&"Scene"===e.type&&e.background&&(e.background.dispose(),e.background=null),e instanceof THREE.Object3D&&this.objectTraverse(e,y.disposeNode.bind(y))},disposeNode:function(e){if(m.isArray(e._txueArr)){for(var t=0;t<e._txueArr.length;t++)e._txueArr[t].dispose(),e._txueArr[t]=null;e._txueArr=null}this.deleteGeometry(e),this.deleteMaterial(e),e.dispose&&"Scene"!==e.type&&e.dispose(),e.parent&&e.parent.remove(e),e.userData=null,e=null},deleteGeometry:function(e){e.geometry&&e.geometry.dispose&&(e.geometry._bufferGeometry&&e.geometry._bufferGeometry.dispose(),e.geometry.dispose(),e.geometry=null)},deleteMaterial:function(e){m.isArray(e.material)?e.material.forEach(y.disposeMaterial.bind(y)):e.material&&this.disposeMaterial(e.material),e.material=null},disposeMaterial:function(e){Object.keys(e).forEach((function(t){e[t]&&m.isFunction(e[t].dispose)||"uniforms"===t?"uniforms"===t?Object.keys(e.uniforms).forEach((function(t){var n=e.__webglShader?e.__webglShader.uniforms[t]:void 0;n&&n.value&&(n.value.dispose&&n.value.dispose(),n.value=null),(n=e.uniforms[t]).value&&(n.value.dispose&&n.value.dispose(),n.value=null)})):(e[t].dispose(),e[t]=null):"program"!==t&&"fragmentShader"!==t&&"vertexShader"!==t||(e[t]=null)})),e.dispose(),e=null},objectTraverse:function(e,t){if(m.isFunction(t)){for(var n=e.children,r=n.length-1;r>=0;r--)this.objectTraverse(n[r],t);t(e)}},eachMaterial:function(e,t){return!!e&&(Array.isArray(e)?e.forEach((function(e,n){t&&t(e,n)})):t&&t(e,0),!0)},getCameraData:function(e,t){return{camera:{x:parseFloat(e.x.toFixed(2)),y:parseFloat(e.y.toFixed(2)),z:parseFloat(e.z.toFixed(2))},target:{x:parseFloat(t.x.toFixed(2)),y:parseFloat(t.y.toFixed(2)),z:parseFloat(t.z.toFixed(2))}}}},g=y,x=function(){function e(t,n,r){a()(this,e),this.canvas=document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),this.context=this.canvas.getContext("2d"),this.image=new Image,this.onLoad=function(){},this.beforeScreenCut=function(){},this.screenCut=n,this.beforeDestroy=function(){},this.destroyed=function(){},this.drawDom(t,!1,r)}return u()(e,[{key:"drawDom",value:function(e,t,n){if(e){t&&(e=e.cloneNode(!0)),this.beforeScreenCut(e,this),this.screenCut('data:image/svg+xml;charset=utf-8,\n            <svg xmlns="http://www.w3.org/2000/svg" \n                width="'.concat(n&&n.width||e.offsetWidth,'" \n                height="').concat(n&&n.height||e.offsetHeight,'">\n                <foreignObject x="0" y="0" width="100%" height="100%">\n                ').concat((new XMLSerializer).serializeToString(e).replace(/#/g,"%23").replace(/\n/g,"%0A"),"\n                </foreignObject></svg>")),this.beforeDestroy(e,this);var r=this.destroyed;this.destroy(),r.call(this,e,this)}}},{key:"drawImg",value:function(e){var t=e.width,n=e.height;this.canvas.width=t,this.canvas.height=n,this.context.clearRect(0,0,t,n),this.context.drawImage(e,0,0),this.beforeScreenCut(e,this),this.screenCut(this.canvas.toDataURL("image/png"),this),this.beforeDestroy(e,this);var r=this.destroyed;this.destroy(),r.call(this,e,this)}},{key:"destroy",value:function(){var e=this;delete this.image.onload,Object.keys(this||{}).forEach((function(t){delete e[t]}))}}]),e}(),b={};!function(e){var t=r,n=r;function r(e,t,n){n=n||2;var r,s,u,c,l,p,v,m=t&&t.length,y=m?t[0]*n:e.length,g=i(e,0,y,n,!0),x=[];if(!g)return x;if(m&&(g=function(e,t,n,r){var a,s,u,c,l,p=[];for(a=0,s=t.length;a<s;a++)u=t[a]*r,c=a<s-1?t[a+1]*r:e.length,(l=i(e,u,c,r,!1))===l.next&&(l.steiner=!0),p.push(f(l));for(p.sort(h),a=0;a<p.length;a++)d(p[a],n),n=o(n,n.next);return n}(e,t,g,n)),e.length>80*n){r=u=e[0],s=c=e[1];for(var b=n;b<y;b+=n)(l=e[b])<r&&(r=l),(p=e[b+1])<s&&(s=p),l>u&&(u=l),p>c&&(c=p);v=0!==(v=Math.max(u-r,c-s))?1/v:0}return a(g,x,n,r,s,v),x}function i(e,t,n,r,i){var o,a;if(i===S(e,t,n,r)>0)for(o=t;o<n;o+=r)a=T(o,e[o],e[o+1],a);else for(o=n-r;o>=t;o-=r)a=T(o,e[o],e[o+1],a);return a&&g(a,a.next)&&(E(a),a=a.next),a}function o(e,t){if(!e)return e;t||(t=e);var n,r=e;do{if(n=!1,r.steiner||!g(r,r.next)&&0!==y(r.prev,r,r.next))r=r.next;else{if(E(r),(r=t=r.prev)===r.next)break;n=!0}}while(n||r!==t);return t}function a(e,t,n,r,i,h,d){if(e){!d&&h&&function(e,t,n,r){var i=e;do{null===i.z&&(i.z=p(i.x,i.y,t,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){var t,n,r,i,o,a,s,u,c=1;do{for(n=e,e=null,o=null,a=0;n;){for(a++,r=n,s=0,t=0;t<c&&(s++,r=r.nextZ);t++);for(u=c;s>0||u>0&&r;)0!==s&&(0===u||!r||n.z<=r.z)?(i=n,n=n.nextZ,s--):(i=r,r=r.nextZ,u--),o?o.nextZ=i:e=i,i.prevZ=o,o=i;n=r}o.nextZ=null,c*=2}while(a>1)}(i)}(e,r,i,h);for(var f,v,m=e;e.prev!==e.next;)if(f=e.prev,v=e.next,h?u(e,r,i,h):s(e))t.push(f.i/n),t.push(e.i/n),t.push(v.i/n),E(e),e=v.next,m=v.next;else if((e=v)===m){d?1===d?a(e=c(e,t,n),t,n,r,i,h,2):2===d&&l(e,t,n,r,i,h):a(o(e),t,n,r,i,h,1);break}}}function s(e){var t=e.prev,n=e,r=e.next;if(y(t,n,r)>=0)return!1;for(var i=e.next.next;i!==e.prev;){if(v(t.x,t.y,n.x,n.y,r.x,r.y,i.x,i.y)&&y(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function u(e,t,n,r){var i=e.prev,o=e,a=e.next;if(y(i,o,a)>=0)return!1;for(var s=i.x<o.x?i.x<a.x?i.x:a.x:o.x<a.x?o.x:a.x,u=i.y<o.y?i.y<a.y?i.y:a.y:o.y<a.y?o.y:a.y,c=i.x>o.x?i.x>a.x?i.x:a.x:o.x>a.x?o.x:a.x,l=i.y>o.y?i.y>a.y?i.y:a.y:o.y>a.y?o.y:a.y,h=p(s,u,t,n,r),d=p(c,l,t,n,r),f=e.prevZ,m=e.nextZ;f&&f.z>=h&&m&&m.z<=d;){if(f!==e.prev&&f!==e.next&&v(i.x,i.y,o.x,o.y,a.x,a.y,f.x,f.y)&&y(f.prev,f,f.next)>=0)return!1;if(f=f.prevZ,m!==e.prev&&m!==e.next&&v(i.x,i.y,o.x,o.y,a.x,a.y,m.x,m.y)&&y(m.prev,m,m.next)>=0)return!1;m=m.nextZ}for(;f&&f.z>=h;){if(f!==e.prev&&f!==e.next&&v(i.x,i.y,o.x,o.y,a.x,a.y,f.x,f.y)&&y(f.prev,f,f.next)>=0)return!1;f=f.prevZ}for(;m&&m.z<=d;){if(m!==e.prev&&m!==e.next&&v(i.x,i.y,o.x,o.y,a.x,a.y,m.x,m.y)&&y(m.prev,m,m.next)>=0)return!1;m=m.nextZ}return!0}function c(e,t,n){var r=e;do{var i=r.prev,o=r.next.next;!g(i,o)&&x(i,r,r.next,o)&&b(i,o)&&b(o,i)&&(t.push(i.i/n),t.push(r.i/n),t.push(o.i/n),E(r),E(r.next),r=e=o),r=r.next}while(r!==e);return r}function l(e,t,n,r,i,s){var u=e;do{for(var c=u.next.next;c!==u.prev;){if(u.i!==c.i&&m(u,c)){var l=w(u,c);return u=o(u,u.next),l=o(l,l.next),a(u,t,n,r,i,s),void a(l,t,n,r,i,s)}c=c.next}u=u.next}while(u!==e)}function h(e,t){return e.x-t.x}function d(e,t){if(t=function(e,t){var n,r=t,i=e.x,o=e.y,a=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var s=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=i&&s>a){if(a=s,s===i){if(o===r.y)return r;if(o===r.next.y)return r.next}n=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!n)return null;if(i===a)return n.prev;var u,c=n,l=n.x,h=n.y,d=1/0;r=n.next;for(;r!==c;)i>=r.x&&r.x>=l&&i!==r.x&&v(o<h?i:a,o,l,h,o<h?a:i,o,r.x,r.y)&&((u=Math.abs(o-r.y)/(i-r.x))<d||u===d&&r.x>n.x)&&b(r,e)&&(n=r,d=u),r=r.next;return n}(e,t)){var n=w(t,e);o(n,n.next)}}function p(e,t,n,r,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function f(e){var t=e,n=e;do{t.x<n.x&&(n=t),t=t.next}while(t!==e);return n}function v(e,t,n,r,i,o,a,s){return(i-a)*(t-s)-(e-a)*(o-s)>=0&&(e-a)*(r-s)-(n-a)*(t-s)>=0&&(n-a)*(o-s)-(i-a)*(r-s)>=0}function m(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&x(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&b(e,t)&&b(t,e)&&function(e,t){var n=e,r=!1,i=(e.x+t.x)/2,o=(e.y+t.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}(e,t)}function y(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function g(e,t){return e.x===t.x&&e.y===t.y}function x(e,t,n,r){return!!(g(e,t)&&g(n,r)||g(e,r)&&g(n,t))||y(e,t,n)>0!=y(e,t,r)>0&&y(n,r,e)>0!=y(n,r,t)>0}function b(e,t){return y(e.prev,e,e.next)<0?y(e,t,e.next)>=0&&y(e,e.prev,t)>=0:y(e,t,e.prev)<0||y(e,e.next,t)<0}function w(e,t){var n=new _(e.i,e.x,e.y),r=new _(t.i,t.x,t.y),i=e.next,o=t.prev;return e.next=t,t.prev=e,n.next=i,i.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function T(e,t,n,r){var i=new _(e,t,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function E(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function _(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function S(e,t,n,r){for(var i=0,o=t,a=n-r;o<n;o+=r)i+=(e[a]-e[o])*(e[o+1]+e[a+1]),a=o;return i}function O(e,t){return e[0]*t[0]+e[1]*t[1]}function R(e,t){var n=t[0],r=t[1],i=Math.sqrt(n*n+r*r);return e[0]=n/i,e[1]=r/i,e}function N(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e}r.deviation=function(e,t,n,r){var i=t&&t.length,o=i?t[0]*n:e.length,a=Math.abs(S(e,0,o,n));if(i)for(var s=0,u=t.length;s<u;s++){var c=t[s]*n,l=s<u-1?t[s+1]*n:e.length;a-=Math.abs(S(e,c,l,n))}var h=0;for(s=0;s<r.length;s+=3){var d=r[s]*n,p=r[s+1]*n,f=r[s+2]*n;h+=Math.abs((e[d]-e[f])*(e[p+1]-e[d+1])-(e[d]-e[p])*(e[f+1]-e[d+1]))}return 0===a&&0===h?0:Math.abs((h-a)/a)},r.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},r=0,i=0;i<e.length;i++){for(var o=0;o<e[i].length;o++)for(var a=0;a<t;a++)n.vertices.push(e[i][o][a]);i>0&&(r+=e[i-1].length,n.holes.push(r))}return n},t.default=n;var C=[],M=[],D=[];function P(e,t,n,r,i,o,a,s){var u=null!=a,c=i,l=null;u&&(l=new Uint32Array(r-n));for(var h=n;h<r;h++){var d=h===r-1?n:h+1,p=h===n?r-1:h-1,f=e[2*p],v=e[2*p+1],m=e[2*h],y=e[2*h+1],g=e[2*d],x=e[2*d+1];if(C[0]=m-f,C[1]=y-v,M[0]=g-m,M[1]=x-y,R(C,C),R(M,M),u&&(l[h]=c),s||h!==n)if(s||h!==r-1){N(D,M,C);var b=D[1];D[1]=-D[0],D[0]=b,R(D,D);var w=O(D,M),T=Math.sqrt(1-w*w),E=o*Math.min(10,1/T);if(u&&1/T>a&&o*w<0){var _=m+D[0]*o,S=y+D[1]*o,P=Math.acos(T)/2,L=Math.tan(P)*Math.abs(o);t[2*c]=_+D[1]*L,t[2*c+1]=S-D[0]*L,t[2*++c]=_-D[1]*L,t[2*c+1]=S+D[0]*L,c++}else t[2*c]=m+D[0]*E,t[2*c+1]=y+D[1]*E,c++}else D[0]=C[1],D[1]=-C[0],R(D,D),t[2*c]=m+D[0]*o,t[2*c+1]=y+D[1]*o,c++;else D[0]=M[1],D[1]=-M[0],R(D,D),t[2*c]=m+D[0]*o,t[2*c+1]=y+D[1]*o,c++}return l}function L(e,t,n,r,i,o,a,s){var u=null!=a,c=i,l=null;u&&(l=new Uint32Array(r-n));for(var h=n;h<r;h++){var d=h===r-1?n:h+1,p=h===n?r-1:h-1,f=e[2*p],v=e[2*p+1],m=e[2*h],y=e[2*h+1],g=e[2*d],x=e[2*d+1];if(C[0]=m-f,C[1]=y-v,M[0]=g-m,M[1]=x-y,R(C,C),R(M,M),u&&(l[h]=c),s||h!==n)if(s||h!==r-1){N(D,M,C);var b=D[1];D[1]=-D[0],D[0]=b,R(D,D);var w=O(D,M),T=Math.sqrt(1-w*w),E=o*Math.min(10,1/T);if(u&&1/T>a&&o*w<0){var _=m+D[0]*o,S=y+D[1]*o,P=Math.acos(T)/2,L=Math.tan(P)*Math.abs(o);t[2*c]=_+D[1]*L,t[2*c+1]=S-D[0]*L,t[2*++c]=_-D[1]*L,t[2*c+1]=S+D[0]*L,c++}else t[2*c]=D[0]*E,t[2*c+1]=D[1]*E,c++}else D[0]=C[1],D[1]=-C[0],R(D,D),t[2*c]=D[0]*o,t[2*c+1]=D[1]*o,c++;else D[0]=M[1],D[1]=-M[0],R(D,D),t[2*c]=D[0]*o,t[2*c+1]=D[1]*o,c++}return l}e.flatten=function(e){return t.flatten(e)},e.triangulate=function(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;return t(e,n,r)},e.offsetPolygon2=function(e,t,n){var r=[];if(L(e,r,0,t&&t.length?t[0]:e.length/2,0,1,null,n),t)for(var i=0;i<t.length;i++){var o=t[i];L(e,r,o,t[i+1]||e.length/2,o,1,null,n)}return r},e.offsetPolygon=function(e,t,n,r,i){var o=null!=r?[]:new Float32Array(e.length);if(P(e,o,0,t&&t.length?t[0]:e.length/2,0,n,r,i),t)for(var a=0;a<t.length;a++){var s=t[a];P(e,o,s,t[a+1]||e.length/2,null!=r?o.length/2:s,n,r,i)}return o}}(b);var w,T=b,E=n("./editorgl/utils/detail/Tween.js"),_=n("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),S=n.n(_),O=Symbol("COMPUTED"),R=function e(t){a()(this,e),i()(this,"_createListener",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=this,o={},a={},s={},u={},c={},l={},h=[],d=h[0],p=h[1],f=h[2],v=h[3];function m(e){return!(!a[e]&&!o[e])}function y(){i._listener.setListener(i._listenerList)}function g(){i._listener.setListener(o)}function x(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};i._listener.bind(e,t)}function b(e,t,n){p||(p=!0,requestAnimationFrame((function(){p=!1,w.loopObject(u,(function(e){var t;g(),(t=i._listener).trigger.apply(t,S()(u[e]).concat([e])),y(),Reflect.deleteProperty(u,e)}))}))),u[e]=[e,d,t,n]}function T(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];w.loopObject(e,(function(r){var i=[n.slice(),e[r]],o=i[0],a=i[1];o.push(r),t(a,o),w.isSimpleObj(a)||T(a,t,o)}))}function E(){w.clearObject(o),w.clearObject(a),w.clearObject(s),g(),T(t,(function(e,t){if(e instanceof Function){var n=t[0];t.forEach((function(i,o){var a,s,u;o&&(n+=".".concat(i)),x(n,(a=o,s=e,u=t.filter((function(e,t){return t>a})),function(e,t,n){u.length&&u.some((function(t){return void 0===(e=e[t])})),Reflect.apply(s,r,[e,t,n,this])}))}))}})),i.computed=!0,w.loopObject(n,(function(e){i.computedName=e,s[e]=Reflect.apply(n[e],d,[]),Reflect.deleteProperty(i,"computedName")})),Reflect.deleteProperty(i,"computed"),y()}function _(e,t){w.loopObject(e,(function(r){if(n[r]){var o=s[r];s[r]=Reflect.apply(n[r],d,[]);var a=s[r];if(!t&&a===o)return;g(),i._listener.trigger(r,d,a,t?void 0:o,r),y()}Reflect.deleteProperty(e,r)}))}function R(e){f||(f=!0,requestAnimationFrame((function(){f=!1,_(c)}))),e.forEach((function(e){c[e]=!0}))}function N(e){v||(v=!0,requestAnimationFrame((function(){requestAnimationFrame((function(){E(),v=!1,_(l,!0)}))}))),l[e]=!0}var C=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";function l(e){return c?"".concat(c,".").concat("string"==typeof e?e:"Symble---toString"):e}return new Proxy(t,{ownKeys:function(e){var t=Object.keys(e);return e instanceof Array&&t.push("length"),t},get:function(t,n,h){if("__getBase__"===n)return t;if("constructor"===n)return Proxy;var d=l(n),p=Reflect.get(t,n,h);if(i.computed){g(),a[d]=a[d]||new Set,a[d].add(i.computedName),o[d]=o[d]||[];var f=o[d];if(!f.some((function(e){return e.isComputed}))){var v=R.bind(null,a[d]);v.isComputed=!0,f.push(v)}y()}return Array.isArray(t)&&p instanceof Function?function(){for(var n=t.map((function(t,n){var i=l(n);return w.isSimpleObj(t)?t:e(t,r[n],u,i)})),i=n.length,o=arguments.length,a=new Array(o),s=0;s<o;s++)a[s]=arguments[s];var h,d=Reflect.apply(p,n,a),f=n.length;return f!==i&&(h=t.slice()),t.splice(0),n.forEach((function(e){w.isSimpleObj(e)?t.push(e):t.push(e.__getBase__)})),f!==i&&b(c,t.slice(),h),d}:p===O?Reflect.get(s,n,h):m(d)&&!w.isSimpleObj(p)?e(p,r[n],u,d):p},set:function(e,t,r,i){var o=l(t),a=e[t];return a===O?(r instanceof Function?n[t]=r:(Reflect.deleteProperty(n,t),Reflect.set(e,t,r,i)),N(t),!0):(!w.isEqual(r,a)&&m(o)&&b(o,r,a),Reflect.set(e,t,r,i))}})};return d=C(e,t,n),E(),d})),i()(this,"_listenerList",{}),w=t,this._listener=new w.Listener,this.bind=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};w.loopObject(e.computed,(function(t){e.data[t]=O}));var n=this._createListener(e.data,e.watch,e.computed,e.bind);return t(n),n},this.dispose=function(e){this._listener.destroy(),e||(w.clearObject(this),w=null)}};function N(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function C(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?N(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):N(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var M,D,P,L,k=C(C(C({},g),m),{},{screenCut:function(e,t,n){return new x(e,t,n)},Listener:function e(){a()(this,e);var t={};this.bind=function(e,n){var r=t[e]||[];t[e]||(t[e]=r),r.push(n)},this.unbind=function(e,n){e||Object.keys(t).forEach((function(e){Reflect.deleteProperty(t,e)}));var r=t[e];return!r||(r&&!n?Reflect.deleteProperty(t,e):(t[e]=r.filter((function(e){return e!==n})),!!t[e].length||Reflect.deleteProperty(t,e)))},this.getListener=function(){return t},this.setListener=function(e){t=e},this.trigger=function(e,n){for(var r=arguments.length,i=new Array(r>2?r-2:0),o=2;o<r;o++)i[o-2]=arguments[o];var a=t[e];return!!a&&(a.forEach((function(e){e.apply(n,i)})),!0)},this.stream=function(e,n){var r=t[e];if(r){for(var i=-1,o=function e(){var t=r[++i];if(t){for(var o=arguments.length,a=new Array(o),s=0;s<o;s++)a[s]=arguments[s];t.apply(n,[e].concat(a))}},a=arguments.length,s=new Array(a>2?a-2:0),u=2;u<a;u++)s[u-2]=arguments[u];o.apply(void 0,s)}},this.destroy=function(){Object.keys(t).forEach((function(e){Reflect.deleteProperty(t,e)}))}},geoEtds:T,TWEEN:E.a});D=new R(M=k),M._setDiff=function(e,t){return D.bind(e,t)},M._disposeDiff=function(e){D.dispose&&D.dispose(e)},g.detector(),k.browserType=(P=window.navigator.userAgent.toLowerCase(),(L=[P.match(/opera.([\d.]+)/),P.match(/firefox\/([\d.]+)/),P.match(/version\/([\d.]+).*safari/),P.match(/chrome\/([\d.]+)/),P.indexOf("edge")>-1,window.document.documentMode])[0]?"Opera":L[1]?"FF":L[2]?"Safari":L[3]?"Chrome":L[4]?"Edge":L[5]?"IE":"");var I=k,A=n("./node_modules/@babel/runtime/helpers/assertThisInitialized.js"),j=n.n(A),H=n("./node_modules/@babel/runtime/helpers/inherits.js"),F=n.n(H),z=n("./node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),V=n.n(z),B=n("./node_modules/@babel/runtime/helpers/getPrototypeOf.js"),J=n.n(B),U=n("./node_modules/@babel/runtime/helpers/classPrivateFieldSet.js"),G=n.n(U);function q(e){this.uuid=THREE.MathUtils.generateUUID(),this.name="",this.type=e,this.userData={}}function W(e,t){q.call(this,e),t=t||{},this.shared=void 0===t.shared||t.shared,this.unique=void 0!==t.unique&&t.unique}function X(e,t){(t=t||{}).shared=void 0!==t.shared&&t.shared,W.call(this,e,t),this.readonly=!1}q.prototype={constructor:q,isNode:!0,analyze:function(e,t){t=t||{},e.analyzing=!0,this.build(e.addFlow(t.slot,t.cache,t.context),"v4"),e.clearVertexNodeCode(),e.clearFragmentNodeCode(),e.removeFlow(),e.analyzing=!1},analyzeAndFlow:function(e,t,n){return n=n||{},this.analyze(e,n),this.flow(e,t,n)},flow:function(e,t,n){n=n||{},e.addFlow(n.slot,n.cache,n.context);var r={};return r.result=this.build(e,t),r.code=e.clearNodeCode(),r.extra=e.context.extra,e.removeFlow(),r},build:function(e,t,n){t=t||this.getType(e,t);var r=e.getNodeData(n||this);return e.analyzing&&this.appendDepsNode(e,r,t),-1===e.nodes.indexOf(this)&&e.nodes.push(this),void 0!==this.updateFrame&&-1===e.updaters.indexOf(this)&&e.updaters.push(this),this.generate(e,t,n)},generate:function(){},appendDepsNode:function(e,t,n){t.deps=(t.deps||0)+1;var r=e.getTypeLength(n);(r>(t.outputMax||0)||this.getType(e,n))&&(t.outputMax=r,t.output=n)},setName:function(e){return this.name=e,this},getName:function(){return this.name},getType:function(e,t){return"sampler2D"===t||"samplerCube"===t?t:this.type},getJSONNode:function(e){if(!(void 0===e||"string"==typeof e)&&void 0!==e.nodes[this.uuid])return e.nodes[this.uuid]},copy:function(e){return void 0!==e.name&&(this.name=e.name),void 0!==e.userData&&(this.userData=JSON.parse(JSON.stringify(e.userData))),this},createJSONNode:function(e){var t=void 0===e||"string"==typeof e,n={};if("string"!=typeof this.nodeType)throw new Error("Node does not allow serialization.");return n.uuid=this.uuid,n.nodeType=this.nodeType,""!==this.name&&(n.name=this.name),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),t||(e.nodes[this.uuid]=n),n},toJSON:function(e){return this.getJSONNode(e)||this.createJSONNode(e)}},W.prototype=Object.create(q.prototype),W.prototype.constructor=W,W.prototype.build=function(e,t,n,r){if(t=t||this.getType(e),this.getShared(e,t)){var i=this.getUnique(e,t);i&&void 0===this.constructor.uuid&&(this.constructor.uuid=THREE.MathUtils.generateUUID()),n=e.getUuid(n||this.getUuid(),!i);var o=e.getNodeData(n),a=o.output||this.getType(e);if(e.analyzing)return(o.deps||0)>0||this.getLabel()?(this.appendDepsNode(e,o,t),this.generate(e,t,n)):q.prototype.build.call(this,e,t,n);if(i)return o.name=o.name||q.prototype.build.call(this,e,t,n),o.name;if(!this.getLabel()&&(!this.getShared(e,a)||e.context.ignoreCache||1===o.deps))return q.prototype.build.call(this,e,t,n);n=this.getUuid(!1);var s=this.getTemp(e,n);if(s)return e.format(s,a,t);s=W.prototype.generate.call(this,e,t,n,o.output,r);var u=this.generate(e,a,n);return e.addNodeCode(s+" = "+u+";"),e.format(s,a,t)}return q.prototype.build.call(this,e,t,n)},W.prototype.getShared=function(e,t){return"sampler2D"!==t&&"samplerCube"!==t&&this.shared},W.prototype.getUnique=function(){return this.unique},W.prototype.setLabel=function(e){return this.label=e,this},W.prototype.getLabel=function(){return this.label},W.prototype.getUuid=function(e){var t=(e||null==e)&&this.constructor.uuid||this.uuid;return"string"==typeof this.scope&&(t=this.scope+"-"+t),t},W.prototype.getTemp=function(e,t){t=t||this.uuid;var n=e.getVars()[t];return n?n.name:void 0},W.prototype.generate=function(e,t,n,r,i){return this.getShared(e,t)||console.error("THREE.TempNode is not shared!"),n=n||this.uuid,e.getTempVar(n,r||this.getType(e),i,this.getLabel()).name},X.prototype=Object.create(W.prototype),X.prototype.constructor=X,X.prototype.setReadonly=function(e){return this.readonly=e,this},X.prototype.getReadonly=function(){return this.readonly},X.prototype.copy=function(e){return W.prototype.copy.call(this,e),void 0!==e.readonly&&(this.readonly=e.readonly),this},X.prototype.createJSONNode=function(e){var t=W.prototype.createJSONNode.call(this,e);return!0===this.readonly&&(t.readonly=this.readonly),t},X.prototype.generate=function(e,t,n,r,i,o){n=e.getUuid(n||this.getUuid()),r=r||this.getType(e);var a=e.getNodeData(n);return this.getReadonly(e)&&void 0!==this.generateReadonly?this.generateReadonly(e,t,n,r,i,o):e.isShader("vertex")?(a.vertex||(a.vertex=e.createVertexUniform(r,this,i,o,this.getLabel())),e.format(a.vertex.name,r,t)):(a.fragment||(a.fragment=e.createFragmentUniform(r,this,i,o,this.getLabel())),e.format(a.fragment.name,r,t))};var Y=/^([a-z_0-9]+)\s([a-z_0-9]+)\s?\=?\s?(.*?)(\;|$)/i;function Z(e,t){W.call(this),this.parse(e||Z.PI,t)}function K(e,t){q.call(this,e),this.value=t}Z.PI="PI",Z.PI2="PI2",Z.RECIPROCAL_PI="RECIPROCAL_PI",Z.RECIPROCAL_PI2="RECIPROCAL_PI2",Z.LOG2="LOG2",Z.EPSILON="EPSILON",Z.prototype=Object.create(W.prototype),Z.prototype.constructor=Z,Z.prototype.nodeType="Const",Z.prototype.getType=function(e){return e.getTypeByFormat(this.type)},Z.prototype.parse=function(e,t){this.src=e||"";var n,r,i="",o=this.src.match(Y);this.useDefine=t||"#"===this.src.charAt(0),o&&o.length>1?(r=o[1],n=o[2],i=o[3]):(n=this.src,r="f"),this.name=n,this.type=r,this.value=i},Z.prototype.build=function(e,t){return"source"!==t?(e.include(this),e.format(this.name,this.getType(e),t)):this.value?this.useDefine?"#define "+this.name+" "+this.value:"const "+this.type+" "+this.name+" = "+this.value+";":this.useDefine?this.src:void 0},Z.prototype.generate=function(e,t){return e.format(this.name,this.getType(e),t)},Z.prototype.copy=function(e){return W.prototype.copy.call(this,e),this.parse(e.src,e.useDefine),this},Z.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).src=this.src,!0===t.useDefine&&(t.useDefine=!0)),t},K.prototype=Object.create(q.prototype),K.prototype.constructor=K,K.prototype.nodeType="Var",K.prototype.getType=function(e){return e.getTypeByFormat(this.type)},K.prototype.generate=function(e,t){var n=e.getVar(this.uuid,this.type);return this.value&&e.isShader("vertex")&&e.addNodeCode(n.name+" = "+this.value.build(e,this.getType(e))+";"),e.format(n.name,this.getType(e),t)},K.prototype.copy=function(e){return q.prototype.copy.call(this,e),this.type=e.type,this.value=e.value,this},K.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).type=this.type,this.value&&(t.value=this.value.toJSON(e).uuid)),t};var Q=/^struct\s*([a-z_0-9]+)\s*{\s*((.|\n)*?)}/gim,$=/\s*(\w*?)\s*(\w*?)(\=|\;)/gim;function ee(e){W.call(this),this.parse(e)}function te(e,t){q.call(this,t),this.name=e}ee.prototype=Object.create(W.prototype),ee.prototype.constructor=ee,ee.prototype.nodeType="Struct",ee.prototype.getType=function(e){return e.getTypeByFormat(this.name)},ee.prototype.getInputByName=function(e){for(var t=this.inputs.length;t--;)if(this.inputs[t].name===e)return this.inputs[t]},ee.prototype.generate=function(e,t){return"source"===t?this.src+";":e.format("( "+this.src+" )",this.getType(e),t)},ee.prototype.parse=function(e){this.src=e||"",this.inputs=[];var t=Q.exec(this.src);if(t){for(var n,r=t[2];n=$.exec(r);)this.inputs.push({type:n[1],name:n[2]});this.name=t[1]}else this.name="";this.type=this.name},ee.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).src=this.src),t},te.prototype=Object.create(q.prototype),te.prototype.constructor=te,te.prototype.nodeType="Attribute",te.prototype.getAttributeType=function(e){return"number"==typeof this.type?e.getConstructorFromLength(this.type):this.type},te.prototype.getType=function(e){var t=this.getAttributeType(e);return e.getTypeByFormat(t)},te.prototype.generate=function(e,t){var n=this.getAttributeType(e),r=e.getAttribute(this.name,n),i=e.isShader("vertex")?this.name:r.varying.name;return e.format(i,this.getType(e),t)},te.prototype.copy=function(e){return q.prototype.copy.call(this,e),this.type=e.type,this},te.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).type=this.type),t};var ne={nodes:{},keywords:{},add:function(e){this.nodes[e.name]=e},addKeyword:function(e,t,n){n=void 0===n||n,this.keywords[e]={callback:t,cache:n}},remove:function(e){delete this.nodes[e.name]},removeKeyword:function(e){delete this.keywords[e]},get:function(e){return this.nodes[e]},getKeyword:function(e,t){return this.keywords[e].callback.call(this,t)},getKeywordData:function(e){return this.keywords[e]},contains:function(e){return void 0!==this.nodes[e]},containsKeyword:function(e){return void 0!==this.keywords[e]}},re=/^\s*([a-z_0-9]+)\s([a-z_0-9]+)\s*\((.*?)\)/i,ie=/[a-z_0-9]+/gi;function oe(e,t,n,r,i){this.isMethod=void 0===i,this.isInterface=!1,W.call(this,i),this.parse(e,t,n,r)}function ae(e,t,n,r,i){oe.call(this,e,i,r,n,t)}function se(e,t){W.call(this),this.setFunction(e,t)}oe.prototype=Object.create(W.prototype),oe.prototype.constructor=oe,oe.prototype.nodeType="Function",oe.prototype.useKeywords=!0,oe.prototype.getShared=function(){return!this.isMethod},oe.prototype.getType=function(e){return e.getTypeByFormat(this.type)},oe.prototype.getInputByName=function(e){for(var t=this.inputs.length;t--;)if(this.inputs[t].name===e)return this.inputs[t]},oe.prototype.getIncludeByName=function(e){for(var t=this.includes.length;t--;)if(this.includes[t].name===e)return this.includes[t]},oe.prototype.generate=function(e,t){for(var n=0,r=this.src,i=0;i<this.includes.length;i++)e.include(this.includes[i],this);for(var o in this.extensions)e.extensions[o]=!0;for(var a=[];s=ie.exec(this.src);)a.push(s);for(i=0;i<a.length;i++){var s,u=(s=a[i])[0],c=!this.isMethod||!this.getInputByName(u),l=u;if(this.keywords[u]||this.useKeywords&&c&&ne.containsKeyword(u)){var h=this.keywords[u];if(!h){var d=ne.getKeywordData(u);d.cache&&(h=e.keywords[u]),h=h||ne.getKeyword(u,e),d.cache&&(e.keywords[u]=h)}l=h.build(e)}u!==l&&(r=r.substring(0,s.index+n)+l+r.substring(s.index+u.length+n),n+=l.length-u.length),void 0===this.getIncludeByName(l)&&ne.contains(l)&&e.include(ne.get(l))}return"source"===t?r:this.isMethod?(this.isInterface||e.include(this,!1,r),this.name):e.format("( "+r+" )",this.getType(e),t)},oe.prototype.parse=function(e,t,n,r){if(this.src=e||"",this.includes=t||[],this.extensions=n||{},this.keywords=r||{},this.isMethod){var i=this.src.match(re);if(this.inputs=[],i&&4==i.length){this.type=i[1],this.name=i[2];var o=i[3].match(ie);if(o)for(var a=0;a<o.length;){var s,u,c=o[a++];"in"===c||"out"===c||"inout"===c?s=o[a++]:(s=c,c=""),u=o[a++],this.inputs.push({name:u,type:s,qualifier:c})}this.isInterface=-1===this.src.indexOf("{")}else this.type="",this.name=""}},oe.prototype.copy=function(e){return W.prototype.copy.call(this,e),this.isMethod=e.isMethod,this.useKeywords=e.useKeywords,this.parse(e.src,e.includes,e.extensions,e.keywords),void 0!==e.type&&(this.type=e.type),this},oe.prototype.toJSON=function(e){var t=this.getJSONNode(e);if(!t){for(var n in(t=this.createJSONNode(e)).src=this.src,t.isMethod=this.isMethod,t.useKeywords=this.useKeywords,this.isMethod||(t.type=this.type),t.extensions=JSON.parse(JSON.stringify(this.extensions)),t.keywords={},this.keywords)t.keywords[n]=this.keywords[n].toJSON(e).uuid;if(this.includes.length){t.includes=[];for(var r=0;r<this.includes.length;r++)t.includes.push(this.includes[r].toJSON(e).uuid)}}return t},ae.prototype=Object.create(oe.prototype),ae.prototype.constructor=ae,ae.prototype.nodeType="Expression",se.prototype=Object.create(W.prototype),se.prototype.constructor=se,se.prototype.nodeType="FunctionCall",se.prototype.setFunction=function(e,t){this.value=e,this.inputs=t||[]},se.prototype.getFunction=function(){return this.value},se.prototype.getType=function(e){return this.value.getType(e)},se.prototype.generate=function(e,t){for(var n=this.getType(e),r=this.value,i=r.build(e,t)+"( ",o=[],a=0;a<r.inputs.length;a++){var s=r.inputs[a],u=this.inputs[a]||this.inputs[s.name];o.push(u.build(e,e.getTypeByFormat(s.type)))}return i+=o.join(", ")+" )",e.format(i,n,t)},se.prototype.copy=function(e){for(var t in W.prototype.copy.call(this,e),e.inputs)this.inputs[t]=e.inputs[t];return this.value=e.value,this},se.prototype.toJSON=function(e){var t=this.getJSONNode(e);if(!t){var n=this.value;if((t=this.createJSONNode(e)).value=this.value.toJSON(e).uuid,n.inputs.length){t.inputs={};for(var r=0;r<n.inputs.length;r++){var i=n.inputs[r],o=this.inputs[r]||this.inputs[i.name];t.inputs[i.name]=o.toJSON(e).uuid}}}return t};var ue,ce,le,he,de,pe,fe,ve,me,ye,ge,xe,be,we,Te={elements:["x","y","z","w"],addShortcuts:function(){function e(e,t,n){return n?{get:function(){return this[e][t][n]},set:function(r){this[e][t][n]=r}}:{get:function(){return this[e][t]},set:function(n){this[e][t]=n}}}return function(t,n,r){for(var i={},o=0;o<r.length;++o){var a=r[o].split("."),s=a[0],u=a[1];i[s]=e(n,s,u)}Object.defineProperties(t,i)}}()};function Ee(e){this.time=void 0!==e?e:0,this.id=0}function _e(e){e=e||{},this.name=e.name,this.type=e.type,this.node=e.node,this.needsUpdate=e.needsUpdate}function Se(e,t){X.call(this,"v2"),this.value=e instanceof THREE.Vector2?e:new THREE.Vector2(e,t)}function Oe(e,t,n){X.call(this,"v3"),this.value=e instanceof THREE.Vector3?e:new THREE.Vector3(e,t,n)}function Re(e,t,n,r){X.call(this,"v4"),this.value=e instanceof THREE.Vector4?e:new THREE.Vector4(e,t,n,r)}function Ne(e){W.call(this,"v2",{shared:!1}),this.index=e||0}function Ce(e){X.call(this,"f"),this.value=e||0}function Me(e,t){W.call(this,"v4"),this.input=e,this.method=t||Me.LINEAR_TO_LINEAR}function De(e,t,n,r){X.call(this,"v4",{shared:!0}),this.value=e,this.uv=t||new Ne,this.bias=n,this.project=void 0!==r&&r}function Pe(e){W.call(this,"v3"),this.scope=e||Pe.LOCAL}function Le(e){W.call(this,"v3"),this.scope=e||Le.VIEW}function ke(e){W.call(this,"v3"),this.scope=e||ke.CUBE}function Ie(e,t,n){X.call(this,"v4",{shared:!0}),this.value=e,this.uv=t||new ke,this.bias=n}function Ae(e,t,n){W.call(this),this.a=e,this.b=t,this.op=n}function je(e,t,n,r){W.call(this),this.a=e,"string"!=typeof t?this.b=t:r=t,"string"!=typeof n?this.c=n:r=n,this.method=r}function He(e,t,n){W.call(this,"v4"),this.value=e,this.uv=t,this.bias=n}function Fe(e,t,n){W.call(this,"v4"),this.value=e,this.radianceNode=new He(this.value,t||new ke(ke.VECTOR),n),this.irradianceNode=new He(this.value,new Le(Le.WORLD),new Ce(1).setReadonly(!0))}Ee.prototype={constructor:Ee,update:function(e){return++this.id,this.time+=e,this.delta=e,this},setRenderer:function(e){return this.renderer=e,this},setRenderTexture:function(e){return this.renderTexture=e,this},updateNode:function(e){return e.frameId===this.id||(e.updateFrame(this),e.frameId=this.id),this}},Object.defineProperties(_e.prototype,{value:{get:function(){return this.node.value},set:function(e){this.node.value=e}}}),Se.prototype=Object.create(X.prototype),Se.prototype.constructor=Se,Se.prototype.nodeType="Vector2",Te.addShortcuts(Se.prototype,"value",["x","y"]),Se.prototype.generateReadonly=function(e,t,n,r){return e.format("vec2( "+this.x+", "+this.y+" )",r,t)},Se.prototype.copy=function(e){return X.prototype.copy.call(this,e),this.value.copy(e),this},Se.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).x=this.x,t.y=this.y,!0===this.readonly&&(t.readonly=!0)),t},Oe.prototype=Object.create(X.prototype),Oe.prototype.constructor=Oe,Oe.prototype.nodeType="Vector3",Te.addShortcuts(Oe.prototype,"value",["x","y","z"]),Oe.prototype.generateReadonly=function(e,t,n,r){return e.format("vec3( "+this.x+", "+this.y+", "+this.z+" )",r,t)},Oe.prototype.copy=function(e){return X.prototype.copy.call(this,e),this.value.copy(e),this},Oe.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).x=this.x,t.y=this.y,t.z=this.z,!0===this.readonly&&(t.readonly=!0)),t},Re.prototype=Object.create(X.prototype),Re.prototype.constructor=Re,Re.prototype.nodeType="Vector4",Te.addShortcuts(Re.prototype,"value",["x","y","z","w"]),Re.prototype.generateReadonly=function(e,t,n,r){return e.format("vec4( "+this.x+", "+this.y+", "+this.z+", "+this.w+" )",r,t)},Re.prototype.copy=function(e){return X.prototype.copy.call(this,e),this.value.copy(e),this},Re.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).x=this.x,t.y=this.y,t.z=this.z,t.w=this.w,!0===this.readonly&&(t.readonly=!0)),t},Ne.prototype=Object.create(W.prototype),Ne.prototype.constructor=Ne,Ne.prototype.nodeType="UV",Ne.prototype.generate=function(e,t){e.requires.uv[this.index]=!0;var n=this.index>0?this.index+1:"",r=e.isShader("vertex")?"uv"+n:"vUv"+n;return e.format(r,this.getType(e),t)},Ne.prototype.copy=function(e){return W.prototype.copy.call(this,e),this.index=e.index,this},Ne.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).index=this.index),t},ne.addKeyword("uv",(function(){return new Ne})),ne.addKeyword("uv2",(function(){return new Ne(1)})),Ce.prototype=Object.create(X.prototype),Ce.prototype.constructor=Ce,Ce.prototype.nodeType="Float",Ce.prototype.generateReadonly=function(e,t,n,r){return e.format(this.value+(this.value%1?"":".0"),r,t)},Ce.prototype.copy=function(e){return X.prototype.copy.call(this,e),this.value=e.value,this},Ce.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).value=this.value,!0===this.readonly&&(t.readonly=!0)),t},Me.Nodes=(ue=new oe(["vec4 LinearToLinear( in vec4 value ) {","\treturn value;","}"].join("\n")),ce=new oe(["vec4 GammaToLinear( in vec4 value, in float gammaFactor ) {","\treturn vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );","}"].join("\n")),le=new oe(["vec4 LinearToGamma( in vec4 value, in float gammaFactor ) {","\treturn vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );","}"].join("\n")),he=new oe(["vec4 sRGBToLinear( in vec4 value ) {","\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );","}"].join("\n")),de=new oe(["vec4 LinearTosRGB( in vec4 value ) {","\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );","}"].join("\n")),pe=new oe(["vec4 RGBEToLinear( in vec4 value ) {","\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );","}"].join("\n")),fe=new oe(["vec4 LinearToRGBE( in vec4 value ) {","\tfloat maxComponent = max( max( value.r, value.g ), value.b );","\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );","\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );","}"].join("\n")),ve=new oe(["vec3 RGBMToLinear( in vec4 value, in float maxRange ) {","\treturn vec4( value.xyz * value.w * maxRange, 1.0 );","}"].join("\n")),me=new oe(["vec3 LinearToRGBM( in vec4 value, in float maxRange ) {","\tfloat maxRGB = max( value.x, max( value.g, value.b ) );","\tfloat M      = clamp( maxRGB / maxRange, 0.0, 1.0 );","\tM            = ceil( M * 255.0 ) / 255.0;","\treturn vec4( value.rgb / ( M * maxRange ), M );","}"].join("\n")),ye=new oe(["vec3 RGBDToLinear( in vec4 value, in float maxRange ) {","\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );","}"].join("\n")),ge=new oe(["vec3 LinearToRGBD( in vec4 value, in float maxRange ) {","\tfloat maxRGB = max( value.x, max( value.g, value.b ) );","\tfloat D      = max( maxRange / maxRGB, 1.0 );","\tD            = clamp( floor( D ) / 255.0, 0.0, 1.0 );","\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );","}"].join("\n")),xe=new Z("const mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );"),be=new oe(["vec4 LinearToLogLuv( in vec4 value ) {","\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;","\tXp_Y_XYZp = max(Xp_Y_XYZp, vec3(1e-6, 1e-6, 1e-6));","\tvec4 vResult;","\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;","\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;","\tvResult.w = fract(Le);","\tvResult.z = (Le - (floor(vResult.w*255.0))/255.0)/255.0;","\treturn vResult;","}"].join("\n"),[xe]),we=new Z("const mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );"),{LinearToLinear:ue,GammaToLinear:ce,LinearToGamma:le,sRGBToLinear:he,LinearTosRGB:de,RGBEToLinear:pe,LinearToRGBE:fe,RGBMToLinear:ve,LinearToRGBM:me,RGBDToLinear:ye,LinearToRGBD:ge,cLogLuvM:xe,LinearToLogLuv:be,cLogLuvInverseM:we,LogLuvToLinear:new oe(["vec4 LogLuvToLinear( in vec4 value ) {","\tfloat Le = value.z * 255.0 + value.w;","\tvec3 Xp_Y_XYZp;","\tXp_Y_XYZp.y = exp2((Le - 127.0) / 2.0);","\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;","\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;","\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;","\treturn vec4( max(vRGB, 0.0), 1.0 );","}"].join("\n"),[we])}),Me.LINEAR_TO_LINEAR="LinearToLinear",Me.GAMMA_TO_LINEAR="GammaToLinear",Me.LINEAR_TO_GAMMA="LinearToGamma",Me.SRGB_TO_LINEAR="sRGBToLinear",Me.LINEAR_TO_SRGB="LinearTosRGB",Me.RGBE_TO_LINEAR="RGBEToLinear",Me.LINEAR_TO_RGBE="LinearToRGBE",Me.RGBM_TO_LINEAR="RGBMToLinear",Me.LINEAR_TO_RGBM="LinearToRGBM",Me.RGBD_TO_LINEAR="RGBDToLinear",Me.LINEAR_TO_RGBD="LinearToRGBD",Me.LINEAR_TO_LOG_LUV="LinearToLogLuv",Me.LOG_LUV_TO_LINEAR="LogLuvToLinear",Me.getEncodingComponents=function(e){switch(e){case THREE.LinearEncoding:return["Linear"];case THREE.sRGBEncoding:return["sRGB"];case THREE.RGBEEncoding:return["RGBE"];case THREE.RGBM7Encoding:return["RGBM",new Ce(7).setReadonly(!0)];case THREE.RGBM16Encoding:return["RGBM",new Ce(16).setReadonly(!0)];case THREE.RGBDEncoding:return["RGBD",new Ce(256).setReadonly(!0)];case THREE.GammaEncoding:return["Gamma",new ae("float( GAMMA_FACTOR )","f")]}},Me.prototype=Object.create(W.prototype),Me.prototype.constructor=Me,Me.prototype.nodeType="ColorSpace",Me.prototype.generate=function(e,t){var n=this.input.build(e,"v4"),r=this.getType(e),i=Me.Nodes[this.method],o=e.include(i);if(o===Me.LINEAR_TO_LINEAR)return e.format(n,r,t);if(2===i.inputs.length){var a=this.factor.build(e,"f");return e.format(o+"( "+n+", "+a+" )",r,t)}return e.format(o+"( "+n+" )",r,t)},Me.prototype.fromEncoding=function(e){var t=Me.getEncodingComponents(e);this.method="LinearTo"+t[0],this.factor=t[1]},Me.prototype.fromDecoding=function(e){var t=Me.getEncodingComponents(e);this.method=t[0]+"ToLinear",this.factor=t[1]},Me.prototype.copy=function(e){return W.prototype.copy.call(this,e),this.input=e.input,this.method=e.method,this},Me.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).input=this.input.toJSON(e).uuid,t.method=this.method),t},De.prototype=Object.create(X.prototype),De.prototype.constructor=De,De.prototype.nodeType="Texture",De.prototype.getTexture=function(e,t){return X.prototype.generate.call(this,e,t,this.value.uuid,"t")},De.prototype.generate=function(e,t){if("sampler2D"===t)return this.getTexture(e,t);var n,r,i=this.getTexture(e,t),o=this.uv.build(e,this.project?"v4":"v2"),a=this.bias?this.bias.build(e,"f"):void 0;void 0===a&&e.context.bias&&(a=e.context.bias.setTexture(this).build(e,"f")),n=this.project?"texture2DProj":a?"tex2DBias":"tex2D",r=a?n+"( "+i+", "+o+", "+a+" )":n+"( "+i+", "+o+" )";var s={include:e.isShader("vertex"),ignoreCache:!0},u=this.getType(e);return e.addContext(s),this.colorSpace=this.colorSpace||new Me(new ae("",u)),this.colorSpace.fromDecoding(e.getTextureEncodingFromMap(this.value)),this.colorSpace.input.parse(r),r=this.colorSpace.build(e,u),e.removeContext(),e.format(r,u,t)},De.prototype.copy=function(e){return X.prototype.copy.call(this,e),e.value&&(this.value=e.value),this.uv=e.uv,e.bias&&(this.bias=e.bias),void 0!==e.project&&(this.project=e.project),this},De.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||(t=this.createJSONNode(e),this.value&&(t.value=this.value.uuid),t.uv=this.uv.toJSON(e).uuid,t.project=this.project,this.bias&&(t.bias=this.bias.toJSON(e).uuid)),t},Pe.LOCAL="local",Pe.WORLD="world",Pe.VIEW="view",Pe.PROJECTION="projection",Pe.prototype=Object.create(W.prototype),Pe.prototype.constructor=Pe,Pe.prototype.nodeType="Position",Pe.prototype.getType=function(){switch(this.scope){case Pe.PROJECTION:return"v4"}return this.type},Pe.prototype.getShared=function(){switch(this.scope){case Pe.LOCAL:case Pe.WORLD:return!1}return!0},Pe.prototype.generate=function(e,t){var n;switch(this.scope){case Pe.LOCAL:e.isShader("vertex")?n="transformed":(e.requires.position=!0,n="vPosition");break;case Pe.WORLD:if(e.isShader("vertex"))return"( modelMatrix * vec4( transformed, 1.0 ) ).xyz";e.requires.worldPosition=!0,n="vWPosition";break;case Pe.VIEW:n=e.isShader("vertex")?"-mvPosition.xyz":"vViewPosition";break;case Pe.PROJECTION:n=e.isShader("vertex")?"( projectionMatrix * modelViewMatrix * vec4( position, 1.0 ) )":"vec4( 0.0 )"}return e.format(n,this.getType(e),t)},Pe.prototype.copy=function(e){return W.prototype.copy.call(this,e),this.scope=e.scope,this},Pe.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).scope=this.scope),t},ne.addKeyword("position",(function(){return new Pe})),ne.addKeyword("worldPosition",(function(){return new Pe(Pe.WORLD)})),ne.addKeyword("viewPosition",(function(){return new Pe(Pe.VIEW)})),Le.LOCAL="local",Le.WORLD="world",Le.VIEW="view",Le.prototype=Object.create(W.prototype),Le.prototype.constructor=Le,Le.prototype.nodeType="Normal",Le.prototype.getShared=function(){return this.scope===Le.WORLD},Le.prototype.build=function(e,t,n,r){var i=e.context[this.scope+"Normal"];return i?i.build(e,t,n,r):W.prototype.build.call(this,e,t,n)},Le.prototype.generate=function(e,t){var n;switch(this.scope){case Le.VIEW:n=e.isShader("vertex")?"transformedNormal":"geometryNormal";break;case Le.LOCAL:e.isShader("vertex")?n="objectNormal":(e.requires.normal=!0,n="vObjectNormal");break;case Le.WORLD:e.isShader("vertex")?n="inverseTransformDirection( transformedNormal, viewMatrix ).xyz":(e.requires.worldNormal=!0,n="vWNormal")}return e.format(n,this.getType(e),t)},Le.prototype.copy=function(e){return W.prototype.copy.call(this,e),this.scope=e.scope,this},Le.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).scope=this.scope),t},ne.addKeyword("viewNormal",(function(){return new Le(Le.VIEW)})),ne.addKeyword("localNormal",(function(){return new Le(Le.NORMAL)})),ne.addKeyword("worldNormal",(function(){return new Le(Le.WORLD)})),ke.CUBE="cube",ke.SPHERE="sphere",ke.VECTOR="vector",ke.prototype=Object.create(W.prototype),ke.prototype.constructor=ke,ke.prototype.nodeType="Reflect",ke.prototype.getUnique=function(e){return!e.context.viewNormal},ke.prototype.getType=function(){switch(this.scope){case ke.SPHERE:return"v2"}return this.type},ke.prototype.generate=function(e,t){var n=this.getUnique(e);if(e.isShader("fragment")){var r;switch(this.scope){case ke.VECTOR:var i=new Le(Le.VIEW),o=e.context.roughness,a=i.build(e,"v3"),s=new Pe(Pe.VIEW).build(e,"v3"),u=o?o.build(e,"f"):void 0,c="reflect( -normalize( ".concat(s," ), ").concat(a," )");u&&(c="normalize( mix( ".concat(c,", ").concat(a,", ").concat(u," * ").concat(u," ) )"));var l="inverseTransformDirection( ".concat(c,", viewMatrix )");n?(e.addNodeCode("vec3 reflectVec = ".concat(l,";")),r="reflectVec"):r=l;break;case ke.CUBE:l="vec3( -"+(h=new ke(ke.VECTOR).build(e,"v3"))+".x, "+h+".yz )";n?(e.addNodeCode("vec3 reflectCubeVec = ".concat(l,";")),r="reflectCubeVec"):r=l;break;case ke.SPHERE:var h;l="normalize( ( viewMatrix * vec4( "+(h=new ke(ke.VECTOR).build(e,"v3"))+", 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) ).xy * 0.5 + 0.5";n?(e.addNodeCode("vec2 reflectSphereVec = ".concat(l,";")),r="reflectSphereVec"):r=l}return e.format(r,this.getType(e),t)}return console.warn("THREE.ReflectNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.type,t)},ke.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).scope=this.scope),t},Ie.prototype=Object.create(X.prototype),Ie.prototype.constructor=Ie,Ie.prototype.nodeType="CubeTexture",Ie.prototype.getTexture=function(e,t){return X.prototype.generate.call(this,e,t,this.value.uuid,"tc")},Ie.prototype.generate=function(e,t){if("samplerCube"===t)return this.getTexture(e,t);var n,r=this.getTexture(e,t),i=this.uv.build(e,"v3"),o=this.bias?this.bias.build(e,"f"):void 0;void 0===o&&e.context.bias&&(o=e.context.bias.setTexture(this).build(e,"f")),n=o?"texCubeBias( "+r+", "+i+", "+o+" )":"texCube( "+r+", "+i+" )";var a={include:e.isShader("vertex"),ignoreCache:!0},s=this.getType(e);return e.addContext(a),this.colorSpace=this.colorSpace||new Me(new ae("",s)),this.colorSpace.fromDecoding(e.getTextureEncodingFromMap(this.value)),this.colorSpace.input.parse(n),n=this.colorSpace.build(e,s),e.removeContext(),e.format(n,s,t)},Ie.prototype.copy=function(e){return X.prototype.copy.call(this,e),e.value&&(this.value=e.value),this.uv=e.uv,e.bias&&(this.bias=e.bias),this},Ie.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).value=this.value.uuid,t.uv=this.uv.toJSON(e).uuid,this.bias&&(t.bias=this.bias.toJSON(e).uuid)),t},Ae.ADD="+",Ae.SUB="-",Ae.MUL="*",Ae.DIV="/",Ae.prototype=Object.create(W.prototype),Ae.prototype.constructor=Ae,Ae.prototype.nodeType="Operator",Ae.prototype.getType=function(e){var t=this.a.getType(e),n=this.b.getType(e);return e.isTypeMatrix(t)?"v4":e.getTypeLength(n)>e.getTypeLength(t)?n:t},Ae.prototype.generate=function(e,t){var n=this.getType(e),r=this.a.build(e,n),i=this.b.build(e,n);return e.format("( "+r+" "+this.op+" "+i+" )",n,t)},Ae.prototype.copy=function(e){return W.prototype.copy.call(this,e),this.a=e.a,this.b=e.b,this.op=e.op,this},Ae.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).a=this.a.toJSON(e).uuid,t.b=this.b.toJSON(e).uuid,t.op=this.op),t},je.RAD="radians",je.DEG="degrees",je.EXP="exp",je.EXP2="exp2",je.LOG="log",je.LOG2="log2",je.SQRT="sqrt",je.INV_SQRT="inversesqrt",je.FLOOR="floor",je.CEIL="ceil",je.NORMALIZE="normalize",je.FRACT="fract",je.SATURATE="saturate",je.SIN="sin",je.COS="cos",je.TAN="tan",je.ASIN="asin",je.ACOS="acos",je.ARCTAN="atan",je.ABS="abs",je.SIGN="sign",je.LENGTH="length",je.NEGATE="negate",je.INVERT="invert",je.MIN="min",je.MAX="max",je.MOD="mod",je.STEP="step",je.REFLECT="reflect",je.DISTANCE="distance",je.DOT="dot",je.CROSS="cross",je.POW="pow",je.MIX="mix",je.CLAMP="clamp",je.REFRACT="refract",je.SMOOTHSTEP="smoothstep",je.FACEFORWARD="faceforward",je.prototype=Object.create(W.prototype),je.prototype.constructor=je,je.prototype.nodeType="Math",je.prototype.getNumInputs=function(){switch(this.method){case je.MIX:case je.CLAMP:case je.REFRACT:case je.SMOOTHSTEP:case je.FACEFORWARD:return 3;case je.MIN:case je.MAX:case je.MOD:case je.STEP:case je.REFLECT:case je.DISTANCE:case je.DOT:case je.CROSS:case je.POW:return 2;default:return 1}},je.prototype.getInputType=function(e){var t=e.getTypeLength(this.a.getType(e)),n=this.b?e.getTypeLength(this.b.getType(e)):0,r=this.c?e.getTypeLength(this.c.getType(e)):0;return t>n&&t>r?this.a.getType(e):n>r?this.b.getType(e):this.c.getType(e)},je.prototype.getType=function(e){switch(this.method){case je.LENGTH:case je.DISTANCE:case je.DOT:return"f";case je.CROSS:return"v3"}return this.getInputType(e)},je.prototype.generate=function(e,t){var n,r,i,o=this.a?e.getTypeLength(this.a.getType(e)):0,a=this.b?e.getTypeLength(this.b.getType(e)):0,s=this.c?e.getTypeLength(this.c.getType(e)):0,u=this.getInputType(e),c=this.getType(e);switch(this.method){case je.NEGATE:return e.format("( -"+this.a.build(e,u)+" )",u,t);case je.INVERT:return e.format("( 1.0 - "+this.a.build(e,u)+" )",u,t);case je.CROSS:n=this.a.build(e,"v3"),r=this.b.build(e,"v3");break;case je.STEP:n=this.a.build(e,1===o?"f":u),r=this.b.build(e,u);break;case je.MIN:case je.MAX:case je.MOD:n=this.a.build(e,u),r=this.b.build(e,1===a?"f":u);break;case je.REFRACT:n=this.a.build(e,u),r=this.b.build(e,u),i=this.c.build(e,"f");break;case je.MIX:n=this.a.build(e,u),r=this.b.build(e,u),i=this.c.build(e,1===s?"f":u);break;default:n=this.a.build(e,u),this.b&&(r=this.b.build(e,u)),this.c&&(i=this.c.build(e,u))}var l=[];l.push(n),r&&l.push(r),i&&l.push(i);var h=this.getNumInputs(e);if(l.length!==h)throw Error('Arguments not match used in "'.concat(this.method,'". Require ').concat(h,", currently ").concat(l.length,"."));return e.format(this.method+"( "+l.join(", ")+" )",c,t)},je.prototype.copy=function(e){return W.prototype.copy.call(this,e),this.a=e.a,this.b=e.b,this.c=e.c,this.method=e.method,this},je.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).a=this.a.toJSON(e).uuid,this.b&&(t.b=this.b.toJSON(e).uuid),this.c&&(t.c=this.c.toJSON(e).uuid),t.method=this.method),t},He.Nodes=function(){var e=new ee("struct TextureCubeUVData {\n\t\t\tvec4 tl;\n\t\t\tvec4 tr;\n\t\t\tvec4 br;\n\t\t\tvec4 bl;\n\t\t\tvec2 f;\n\t\t}"),t=new Z("float cubeUV_maxMipLevel 8.0",!0),n=new Z("float cubeUV_minMipLevel 4.0",!0),r=new Z("float cubeUV_maxTileSize 256.0",!0),i=new Z("float cubeUV_minTileSize 16.0",!0),o=new oe("float getFace(vec3 direction) {\n\t\t\t\tvec3 absDirection = abs(direction);\n\t\t\t\tfloat face = -1.0;\n\t\t\t\tif (absDirection.x > absDirection.z) {\n\t\t\t\t\tif (absDirection.x > absDirection.y)\n\t\t\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\t\t\telse\n\t\t\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t\t\t} else {\n\t\t\t\t\tif (absDirection.z > absDirection.y)\n\t\t\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\t\t\telse\n\t\t\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t\t\t}\n\t\t\t\treturn face;\n\t\t}");o.useKeywords=!1;var a=new oe("vec2 getUV(vec3 direction, float face) {\n\t\t\t\tvec2 uv;\n\t\t\t\tif (face == 0.0) {\n\t\t\t\t\tuv = vec2(-direction.z, direction.y) / abs(direction.x);\n\t\t\t\t} else if (face == 1.0) {\n\t\t\t\t\tuv = vec2(direction.x, -direction.z) / abs(direction.y);\n\t\t\t\t} else if (face == 2.0) {\n\t\t\t\t\tuv = direction.xy / abs(direction.z);\n\t\t\t\t} else if (face == 3.0) {\n\t\t\t\t\tuv = vec2(direction.z, direction.y) / abs(direction.x);\n\t\t\t\t} else if (face == 4.0) {\n\t\t\t\t\tuv = direction.xz / abs(direction.y);\n\t\t\t\t} else {\n\t\t\t\t\tuv = vec2(-direction.x, direction.y) / abs(direction.z);\n\t\t\t\t}\n\t\t\t\treturn 0.5 * (uv + 1.0);\n\t\t}");a.useKeywords=!1;var s=new oe("TextureCubeUVData bilinearCubeUV(sampler2D envMap, vec3 direction, float mipInt) {\n\n\t\t\tfloat face = getFace(direction);\n\t\t\tfloat filterInt = max(cubeUV_minMipLevel - mipInt, 0.0);\n\t\t\tmipInt = max(mipInt, cubeUV_minMipLevel);\n\t\t\tfloat faceSize = exp2(mipInt);\n\n\t\t\tfloat texelSize = 1.0 / (3.0 * cubeUV_maxTileSize);\n\n\t\t\tvec2 uv = getUV(direction, face) * (faceSize - 1.0);\n\t\t\tvec2 f = fract(uv);\n\t\t\tuv += 0.5 - f;\n\t\t\tif (face > 2.0) {\n\t\t\t\tuv.y += faceSize;\n\t\t\t\tface -= 3.0;\n\t\t\t}\n\t\t\tuv.x += face * faceSize;\n\t\t\tif(mipInt < cubeUV_maxMipLevel){\n\t\t\t\tuv.y += 2.0 * cubeUV_maxTileSize;\n\t\t\t}\n\t\t\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\n\t\t\tuv.x += 3.0 * max(0.0, cubeUV_maxTileSize - 2.0 * faceSize);\n\t\t\tuv *= texelSize;\n \n\t\t\tvec4 tl = texture2D(envMap, uv);\n\t\t\tuv.x += texelSize;\n\t\t\tvec4 tr = texture2D(envMap, uv);\n\t\t\tuv.y += texelSize;\n\t\t\tvec4 br = texture2D(envMap, uv);\n\t\t\tuv.x -= texelSize;\n\t\t\tvec4 bl = texture2D(envMap, uv);\n\n\t\t\treturn TextureCubeUVData( tl, tr, br, bl, f );\n\t\t}",[e,o,a,t,n,r,i]);s.useKeywords=!1;var u=new Z("float r0 1.0",!0),c=new Z("float v0 0.339",!0),l=new Z("float m0 -2.0",!0);return{bilinearCubeUV:s,roughnessToMip:new oe("float roughnessToMip(float roughness) {\n\t\t\tfloat mip = 0.0;\n\t\t\tif (roughness >= r1) {\n\t\t\t\tmip = (r0 - roughness) * (m1 - m0) / (r0 - r1) + m0;\n\t\t\t} else if (roughness >= r4) {\n\t\t\t\tmip = (r1 - roughness) * (m4 - m1) / (r1 - r4) + m1;\n\t\t\t} else if (roughness >= r5) {\n\t\t\t\tmip = (r4 - roughness) * (m5 - m4) / (r4 - r5) + m4;\n\t\t\t} else if (roughness >= r6) {\n\t\t\t\tmip = (r5 - roughness) * (m6 - m5) / (r5 - r6) + m5;\n\t\t\t} else {\n\t\t\t\tmip = -2.0 * log2(1.16 * roughness);// 1.16 = 1.79^0.25\n\t\t\t}\n\t\t\treturn mip;\n\t\t}",[u,c,l,new Z("float r1 0.8",!0),new Z("float v1 0.276",!0),new Z("float m1 -1.0",!0),new Z("float r4 0.4",!0),new Z("float v4 0.046",!0),new Z("float m4 2.0",!0),new Z("float r5 0.305",!0),new Z("float v5 0.016",!0),new Z("float m5 3.0",!0),new Z("float r6 0.21",!0),new Z("float v6 0.0038",!0),new Z("float m6 4.0",!0)]),m0:l,cubeUV_maxMipLevel:t}}(),He.prototype=Object.create(W.prototype),He.prototype.constructor=He,He.prototype.nodeType="TextureCubeUV",He.prototype.bilinearCubeUV=function(e,t,n,r){var i=new se(He.Nodes.bilinearCubeUV,[t,n,r]);this.colorSpaceTL=this.colorSpaceTL||new Me(new ae("","v4")),this.colorSpaceTL.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceTL.input.parse(i.build(e)+".tl"),this.colorSpaceTR=this.colorSpaceTR||new Me(new ae("","v4")),this.colorSpaceTR.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceTR.input.parse(i.build(e)+".tr"),this.colorSpaceBL=this.colorSpaceBL||new Me(new ae("","v4")),this.colorSpaceBL.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceBL.input.parse(i.build(e)+".bl"),this.colorSpaceBR=this.colorSpaceBR||new Me(new ae("","v4")),this.colorSpaceBR.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceBR.input.parse(i.build(e)+".br");var o={include:e.isShader("vertex"),ignoreCache:!0};e.addContext(o),this.colorSpaceTLExp=new ae(this.colorSpaceTL.build(e,"v4"),"v4"),this.colorSpaceTRExp=new ae(this.colorSpaceTR.build(e,"v4"),"v4"),this.colorSpaceBLExp=new ae(this.colorSpaceBL.build(e,"v4"),"v4"),this.colorSpaceBRExp=new ae(this.colorSpaceBR.build(e,"v4"),"v4"),e.removeContext();var a=new ae("mix( mix( cubeUV_TL, cubeUV_TR, cubeUV.f.x ), mix( cubeUV_BL, cubeUV_BR, cubeUV.f.x ), cubeUV.f.y )","v4");return a.keywords.cubeUV_TL=this.colorSpaceTLExp,a.keywords.cubeUV_TR=this.colorSpaceTRExp,a.keywords.cubeUV_BL=this.colorSpaceBLExp,a.keywords.cubeUV_BR=this.colorSpaceBRExp,a.keywords.cubeUV=i,a},He.prototype.generate=function(e,t){if(e.isShader("fragment")){var n=this.uv,r=this.bias||e.context.roughness,i=new je(new se(He.Nodes.roughnessToMip,[r]),He.Nodes.m0,He.Nodes.cubeUV_maxMipLevel,je.CLAMP),o=new je(i,je.FLOOR),a=new je(i,je.FRACT),s=new je(this.bilinearCubeUV(e,this.value,n,o),this.bilinearCubeUV(e,this.value,n,new Ae(o,new Ce(1).setReadonly(!0),Ae.ADD)),a,je.MIX);return e.format(s.build(e),"v4",t)}return console.warn("THREE.TextureCubeUVNode is not compatible with "+e.shader+" shader."),e.format("vec4( 0.0 )",this.getType(e),t)},He.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).value=this.value.toJSON(e).uuid,t.uv=this.uv.toJSON(e).uuid,t.bias=this.bias.toJSON(e).uuid),t},Fe.prototype=Object.create(W.prototype),Fe.prototype.constructor=Fe,Fe.prototype.nodeType="TextureCube",Fe.prototype.generate=function(e,t){return e.isShader("fragment")?(e.require("irradiance"),e.context.bias&&e.context.bias.setTexture(this.value),("irradiance"===e.slot?this.irradianceNode:this.radianceNode).build(e,t)):(console.warn("THREE.TextureCubeNode is not compatible with "+e.shader+" shader."),e.format("vec4( 0.0 )",this.getType(e),t))},Fe.prototype.copy=function(e){return W.prototype.copy.call(this,e),this.value=e.value,this},Fe.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).value=this.value.toJSON(e).uuid),t};var ze=Te.elements,Ve=["float","vec2","vec3","vec4"],Be={float:"f",vec2:"v2",vec3:"v3",vec4:"v4",mat4:"v4",int:"i",bool:"b"},Je={t:"sampler2D",tc:"samplerCube",b:"bool",i:"int",f:"float",c:"vec3",v2:"vec2",v3:"vec3",v4:"vec4",m3:"mat3",m4:"mat4"};function Ue(){this.slots=[],this.caches=[],this.contexts=[],this.keywords={},this.nodeData={},this.requires={uv:[],color:[],lights:!1,fog:!1},this.includes={consts:[],functions:[],structs:[]},this.attributes={},this.prefixCode=["#ifdef TEXTURE_LOD_EXT","\t#define texCube(a, b) textureCube(a, b)","\t#define texCubeBias(a, b, c) textureCubeLodEXT(a, b, c)","\t#define tex2D(a, b) texture2D(a, b)","\t#define tex2DBias(a, b, c) texture2DLodEXT(a, b, c)","#else","\t#define texCube(a, b) textureCube(a, b)","\t#define texCubeBias(a, b, c) textureCube(a, b, c)","\t#define tex2D(a, b) texture2D(a, b)","\t#define tex2DBias(a, b, c) texture2D(a, b, c)","#endif","#include <packing>","#include <common>"].join("\n"),this.parsCode={vertex:"",fragment:""},this.code={vertex:"",fragment:""},this.nodeCode={vertex:"",fragment:""},this.resultCode={vertex:"",fragment:""},this.finalCode={vertex:"",fragment:""},this.inputs={uniforms:{list:[],vertex:[],fragment:[]},vars:{varying:[],vertex:[],fragment:[]}},this.defines={},this.uniforms={},this.extensions={},this.updaters=[],this.nodes=[],this.analyzing=!1}function Ge(e){X.call(this,"b"),this.value=Boolean(e)}function qe(e){X.call(this,"i"),this.value=Math.floor(e||0)}function We(e,t,n){X.call(this,"c"),this.value=e instanceof THREE.Color?e:new THREE.Color(e||0,t,n)}function Xe(e){X.call(this,"m3"),this.value=e||new THREE.Matrix3}function Ye(e){X.call(this,"m4"),this.value=e||new THREE.Matrix4}function Ze(e){De.call(this,void 0,e)}function Ke(e){W.call(this,"v4"),e&&this.setMirror(e)}function Qe(e,t,n){X.call(this,n),this.object=e,this.property=t}function $e(e){q.call(this,"v4"),this.value=e}function et(e,t){THREE.ShaderMaterial.call(this);var n=this;this.vertex=e||new $e(new Pe(Pe.PROJECTION)),this.fragment=t||new $e(new We(16711680)),this.updaters=[],this.onBeforeCompile=function(e,t){var n=t.properties.get(this);this.version!==n.__version&&(this.build({renderer:t}),e.uniforms=this.uniforms,e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader)},this.onBeforeCompile.toString=function(){return n.needsCompile}}function tt(e,t,n,r){r=r||{},this.input=n,this.clear=void 0===r.clear||r.clear,this.renderTarget=new THREE.WebGLRenderTarget(e,t,r),this.material=new et,this.camera=new THREE.OrthographicCamera(-1,1,1,-1,0,1),this.scene=new THREE.Scene,this.quad=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),this.material),this.quad.frustumCulled=!1,this.scene.add(this.quad),this.render=!0,De.call(this,this.renderTarget.texture)}Ue.prototype={constructor:Ue,build:function(e,t){this.buildShader("vertex",e),this.buildShader("fragment",t);for(var n=0;n<this.requires.uv.length;n++)if(this.requires.uv[n]){var r=n>0?n+1:"";this.addVaryCode("varying vec2 vUv"+r+";"),n>0&&this.addVertexParsCode("attribute vec2 uv"+r+";"),this.addVertexFinalCode("vUv"+r+" = uv"+r+";")}return this.requires.color[0]&&(this.addVaryCode("varying vec4 vColor;"),this.addVertexParsCode("attribute vec4 color;"),this.addVertexFinalCode("vColor = color;")),this.requires.color[1]&&(this.addVaryCode("varying vec4 vColor2;"),this.addVertexParsCode("attribute vec4 color2;"),this.addVertexFinalCode("vColor2 = color2;")),this.requires.position&&(this.addVaryCode("varying vec3 vPosition;"),this.addVertexFinalCode("vPosition = transformed;")),this.requires.worldPosition&&(this.addVaryCode("varying vec3 vWPosition;"),this.addVertexFinalCode("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;")),this.requires.normal&&(this.addVaryCode("varying vec3 vObjectNormal;"),this.addVertexFinalCode("vObjectNormal = normal;")),this.requires.worldNormal&&(this.addVaryCode("varying vec3 vWNormal;"),this.addVertexFinalCode("vWNormal = inverseTransformDirection( transformedNormal, viewMatrix ).xyz;")),this},buildShader:function(e,t){this.resultCode[e]=t.build(this.setShader(e),"v4")},setMaterial:function(e,t){return this.material=e,this.renderer=t,this.requires.lights=e.lights,this.requires.fog=e.fog,this.mergeDefines(e.defines),this},addFlow:function(e,t,n){return this.addSlot(e).addCache(t).addContext(n)},removeFlow:function(){return this.removeSlot().removeCache().removeContext()},addCache:function(e){return this.cache=e||"",this.caches.push(this.cache),this},removeCache:function(){return this.caches.pop(),this.cache=this.caches[this.caches.length-1]||"",this},addContext:function(e){return this.context=Object.assign({},this.context,e),this.context.extra=this.context.extra||{},this.contexts.push(this.context),this},removeContext:function(){return this.contexts.pop(),this.context=this.contexts[this.contexts.length-1]||{},this},addSlot:function(e){return this.slot=e||"",this.slots.push(this.slot),this},removeSlot:function(){return this.slots.pop(),this.slot=this.slots[this.slots.length-1]||"",this},addVertexCode:function(e){this.addCode(e,"vertex")},addFragmentCode:function(e){this.addCode(e,"fragment")},addCode:function(e,t){this.code[t||this.shader]+=e+"\n"},addVertexNodeCode:function(e){this.addNodeCode(e,"vertex")},addFragmentNodeCode:function(e){this.addNodeCode(e,"fragment")},addNodeCode:function(e,t){this.nodeCode[t||this.shader]+=e+"\n"},clearNodeCode:function(e){e=e||this.shader;var t=this.nodeCode[e];return this.nodeCode[e]="",t},clearVertexNodeCode:function(){return this.clearNodeCode("vertex")},clearFragmentNodeCode:function(){return this.clearNodeCode("fragment")},addVertexFinalCode:function(e){this.addFinalCode(e,"vertex")},addFragmentFinalCode:function(e){this.addFinalCode(e,"fragment")},addFinalCode:function(e,t){this.finalCode[t||this.shader]+=e+"\n"},addVertexParsCode:function(e){this.addParsCode(e,"vertex")},addFragmentParsCode:function(e){this.addParsCode(e,"fragment")},addParsCode:function(e,t){this.parsCode[t||this.shader]+=e+"\n"},addVaryCode:function(e){this.addVertexParsCode(e),this.addFragmentParsCode(e)},isCache:function(e){return-1!==this.caches.indexOf(e)},isSlot:function(e){return-1!==this.slots.indexOf(e)},define:function(e,t){this.defines[e]=void 0===t?1:t},require:function(e){this.requires[e]=!0},isDefined:function(e){return void 0!==this.defines[e]},getVar:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"varying",i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"V",o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"",a=this.getVars(r),s=a[e];if(!s){var u=a.length,c=n||"node"+i+u+(o?"_"+o:"");s={name:c,type:t},a.push(s),a[e]=s}return s},getTempVar:function(e,t,n,r){return this.getVar(e,t,n,this.shader,"T",r)},getAttribute:function(e,t){if(!this.attributes[e]){var n=this.getVar(e,t);this.addVertexParsCode("attribute "+t+" "+e+";"),this.addVertexFinalCode(n.name+" = "+e+";"),this.attributes[e]={varying:n,name:e,type:t}}return this.attributes[e]},getCode:function(e){return[this.prefixCode,this.parsCode[e],this.getVarListCode(this.getVars("varying"),"varying"),this.getVarListCode(this.inputs.uniforms[e],"uniform"),this.getIncludesCode("consts",e),this.getIncludesCode("structs",e),this.getIncludesCode("functions",e),"void main() {",this.getVarListCode(this.getVars(e)),this.code[e],this.resultCode[e],this.finalCode[e],"}"].join("\n")},getVarListCode:function(e,t){t=t||"";for(var n="",r=0,i=e.length;r<i;++r){var o=e[r],a=o.type,s=o.name,u=this.getFormatByType(a);if(void 0===u)throw new Error("Node pars "+u+" not found.");n+=t+" "+u+" "+s+";\n"}return n},getVars:function(e){return this.inputs.vars[e||this.shader]},getNodeData:function(e){var t=e.isNode?e.uuid:e;return this.nodeData[t]=this.nodeData[t]||{}},createUniform:function(e,t,n,r,i,o){var a=this.inputs.uniforms,s=a.list.length,u=new _e({type:t,name:r||"nodeU"+s+(o?"_"+o:""),node:n,needsUpdate:i});return a.list.push(u),a[e].push(u),a[e][u.name]=u,this.uniforms[u.name]=u,u},createVertexUniform:function(e,t,n,r,i){return this.createUniform("vertex",e,t,n,r,i)},createFragmentUniform:function(e,t,n,r,i){return this.createUniform("fragment",e,t,n,r,i)},include:function(e,t,n){var r;if(e="string"==typeof e?ne.get(e):e,!1===this.context.include)return e.name;e instanceof oe?r=this.includes.functions:e instanceof Z?r=this.includes.consts:e instanceof ee&&(r=this.includes.structs);var i=r[this.shader]=r[this.shader]||[];if(e){var o=i[e.name];if(o||(o=i[e.name]={node:e,deps:[]},i.push(o),o.src=e.build(this,"source")),e instanceof oe&&t&&i[t.name]&&-1==i[t.name].deps.indexOf(e)&&(i[t.name].deps.push(e),e.includes&&e.includes.length)){var a=0;do{this.include(e.includes[a++],t)}while(a<e.includes.length)}return n&&(o.src=n),e.name}throw new Error("Include not found.")},colorToVectorProperties:function(e){return e.replace("r","x").replace("g","y").replace("b","z").replace("a","w")},colorToVector:function(e){return e.replace(/c/g,"v3")},getIncludes:function(e,t){return this.includes[e][t||this.shader]},getIncludesCode:function(){function e(e,t){return e.deps.length-t.deps.length}return function(t,n){if(!(i=this.getIncludes(t,n)))return"";for(var r="",i=i.sort(e),o=0;o<i.length;o++)i[o].src&&(r+=i[o].src+"\n");return r}}(),getConstructorFromLength:function(e){return Ve[e-1]},isTypeMatrix:function(e){return/^m/.test(e)},getTypeLength:function(e){return"f"===e?1:parseInt(this.colorToVector(e).substr(1))},getTypeFromLength:function(e){return 1===e?"f":"v"+e},findNode:function(){for(var e=0;e<arguments.length;e++){var t=arguments[e];if(void 0!==t&&t.isNode)return t}},resolve:function(){for(var e=0;e<arguments.length;e++){var t=arguments[e];if(void 0!==t){if(t.isNode)return t;if(t.isTexture)switch(t.mapping){case THREE.CubeReflectionMapping:case THREE.CubeRefractionMapping:return new Ie(t);case THREE.CubeUVReflectionMapping:case THREE.CubeUVRefractionMapping:return new Fe(new De(t));default:return new De(t)}else{if(t.isVector2)return new Se(t);if(t.isVector3)return new Oe(t);if(t.isVector4)return new Re(t)}}}},format:function(e,t,n){switch(this.colorToVector(n+" <- "+t)){case"f <- v2":case"f <- v3":case"f <- v4":return e+".x";case"f <- i":case"f <- b":return"float( "+e+" )";case"v2 <- f":return"vec2( "+e+" )";case"v2 <- v3":case"v2 <- v4":return e+".xy";case"v2 <- i":case"v2 <- b":return"vec2( float( "+e+" ) )";case"v3 <- f":return"vec3( "+e+" )";case"v3 <- v2":return"vec3( "+e+", 0.0 )";case"v3 <- v4":return e+".xyz";case"v3 <- i":case"v3 <- b":return"vec2( float( "+e+" ) )";case"v4 <- f":return"vec4( "+e+" )";case"v4 <- v2":return"vec4( "+e+", 0.0, 1.0 )";case"v4 <- v3":return"vec4( "+e+", 1.0 )";case"v4 <- i":case"v4 <- b":return"vec4( float( "+e+" ) )";case"i <- f":case"i <- b":return"int( "+e+" )";case"i <- v2":case"i <- v3":case"i <- v4":return"int( "+e+".x )";case"b <- f":return"( "+e+" != 0.0 )";case"b <- v2":return"( "+e+" != vec2( 0.0 ) )";case"b <- v3":return"( "+e+" != vec3( 0.0 ) )";case"b <- v4":return"( "+e+" != vec4( 0.0 ) )";case"b <- i":return"( "+e+" != 0 )"}return e},getTypeByFormat:function(e){return Be[e]||e},getFormatByType:function(e){return Je[e]||e},getUuid:function(e,t){return(t=void 0===t||t)&&this.cache&&(e=this.cache+"-"+e),e},getElementByIndex:function(e){return ze[e]},getIndexByElement:function(e){return ze.indexOf(e)},isShader:function(e){return this.shader===e},setShader:function(e){return this.shader=e,this},mergeDefines:function(e){for(var t in e)this.defines[t]=e[t];return this.defines},mergeUniform:function(e){for(var t in e)this.uniforms[t]=e[t];return this.uniforms},getTextureEncodingFromMap:function(e){var t;return e?e.isTexture?t=e.encoding:e.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),t=e.texture.encoding):t=THREE.LinearEncoding,t===THREE.LinearEncoding&&this.context.gamma&&(t=THREE.GammaEncoding),t}},Ge.prototype=Object.create(X.prototype),Ge.prototype.constructor=Ge,Ge.prototype.nodeType="Bool",Ge.prototype.generateReadonly=function(e,t,n,r){return e.format(this.value,r,t)},Ge.prototype.copy=function(e){return X.prototype.copy.call(this,e),this.value=e.value,this},Ge.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).value=this.value,!0===this.readonly&&(t.readonly=!0)),t},qe.prototype=Object.create(X.prototype),qe.prototype.constructor=qe,qe.prototype.nodeType="Int",qe.prototype.generateReadonly=function(e,t,n,r){return e.format(this.value,r,t)},qe.prototype.copy=function(e){return X.prototype.copy.call(this,e),this.value=e.value,this},qe.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).value=this.value,!0===this.readonly&&(t.readonly=!0)),t},We.prototype=Object.create(X.prototype),We.prototype.constructor=We,We.prototype.nodeType="Color",Te.addShortcuts(We.prototype,"value",["r","g","b"]),We.prototype.generateReadonly=function(e,t,n,r){return e.format("vec3( "+this.r+", "+this.g+", "+this.b+" )",r,t)},We.prototype.copy=function(e){return X.prototype.copy.call(this,e),this.value.copy(e),this},We.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).r=this.r,t.g=this.g,t.b=this.b,!0===this.readonly&&(t.readonly=!0)),t},Xe.prototype=Object.create(X.prototype),Xe.prototype.constructor=Xe,Xe.prototype.nodeType="Matrix3",Object.defineProperties(Xe.prototype,{elements:{set:function(e){this.value.elements=e},get:function(){return this.value.elements}}}),Xe.prototype.generateReadonly=function(e,t,n,r){return e.format("mat3( "+this.value.elements.join(", ")+" )",r,t)},Xe.prototype.copy=function(e){return X.prototype.copy.call(this,e),this.value.fromArray(e.elements),this},Xe.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).elements=this.value.elements.concat()),t},Ye.prototype=Object.create(X.prototype),Ye.prototype.constructor=Ye,Ye.prototype.nodeType="Matrix4",Object.defineProperties(Ye.prototype,{elements:{set:function(e){this.value.elements=e},get:function(){return this.value.elements}}}),Ye.prototype.generateReadonly=function(e,t,n,r){return e.format("mat4( "+this.value.elements.join(", ")+" )",r,t)},Ye.prototype.copy=function(e){return X.prototype.copy.call(this,e),this.scope.value.fromArray(e.elements),this},Ye.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).elements=this.value.elements.concat()),t},Ze.prototype=Object.create(De.prototype),Ze.prototype.constructor=Ze,Ze.prototype.nodeType="Screen",Ze.prototype.getUnique=function(){return!0},Ze.prototype.getTexture=function(e,t){return X.prototype.generate.call(this,e,t,this.getUuid(),"t","renderTexture")},Ke.prototype=Object.create(W.prototype),Ke.prototype.constructor=Ke,Ke.prototype.nodeType="Reflector",Ke.prototype.setMirror=function(e){this.mirror=e,this.textureMatrix=new Ye(this.mirror.material.uniforms.textureMatrix.value),this.localPosition=new Pe(Pe.LOCAL),this.uv=new Ae(this.textureMatrix,this.localPosition,Ae.MUL),this.uvResult=new Ae(null,this.uv,Ae.ADD),this.texture=new De(this.mirror.material.uniforms.tDiffuse.value,this.uv,null,!0)},Ke.prototype.generate=function(e,t){return e.isShader("fragment")?(this.uvResult.a=this.offset,this.texture.uv=this.offset?this.uvResult:this.uv,"sampler2D"===t?this.texture.build(e,t):e.format(this.texture.build(e,this.type),this.type,t)):(console.warn("THREE.ReflectorNode is not compatible with "+e.shader+" shader."),e.format("vec4( 0.0 )",this.type,t))},Ke.prototype.copy=function(e){return X.prototype.copy.call(this,e),this.scope.mirror=e.mirror,this},Ke.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).mirror=this.mirror.uuid,this.offset&&(t.offset=this.offset.toJSON(e).uuid)),t},Qe.prototype=Object.create(X.prototype),Qe.prototype.constructor=Qe,Qe.prototype.nodeType="Property",Object.defineProperties(Qe.prototype,{value:{get:function(){return this.object[this.property]},set:function(e){this.object[this.property]=e}}}),Qe.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).value=this.value,t.property=this.property),t},$e.prototype=Object.create(q.prototype),$e.prototype.constructor=$e,$e.prototype.nodeType="Raw",$e.prototype.generate=function(e){var t=this.value.analyzeAndFlow(e,this.type),n=t.code+"\n";return e.isShader("vertex")?n+="gl_Position = "+t.result+";":n+="gl_FragColor = "+t.result+";",n},$e.prototype.copy=function(e){return q.prototype.copy.call(this,e),this.value=e.value,this},$e.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).value=this.value.toJSON(e).uuid),t},et.prototype=Object.create(THREE.ShaderMaterial.prototype),et.prototype.constructor=et,et.prototype.type="NodeMaterial",et.prototype.isNodeMaterial=!0,Object.defineProperties(et.prototype,{properties:{get:function(){return this.fragment.properties}},needsUpdate:{set:function(e){!0===e&&this.version++,this.needsCompile=e},get:function(){return this.needsCompile}}}),et.prototype.updateFrame=function(e){for(var t=0;t<this.updaters.length;++t)e.updateNode(this.updaters[t])},et.prototype.build=function(e){var t=(e=e||{}).builder||new Ue;return t.setMaterial(this,e.renderer),t.build(this.vertex,this.fragment),this.vertexShader=t.getCode("vertex"),this.fragmentShader=t.getCode("fragment"),this.defines=t.defines,this.uniforms=t.uniforms,this.extensions=t.extensions,this.updaters=t.updaters,this.fog=t.requires.fog,this.lights=t.requires.lights,this.transparent=t.requires.transparent||this.blending>THREE.NormalBlending,this},et.prototype.copy=function(e){var t=this.uuid;for(var n in e)this[n]=e[n];return this.uuid=t,void 0!==e.userData&&(this.userData=JSON.parse(JSON.stringify(e.userData))),this},et.prototype.toJSON=function(e){if((void 0===e||"string"==typeof e)&&(e={nodes:{}}),e&&!e.materials&&(e.materials={}),!e.materials[this.uuid]){var t={};t.uuid=this.uuid,t.type=this.type,e.materials[t.uuid]=t,""!==this.name&&(t.name=this.name),void 0!==this.size&&(t.size=this.size),void 0!==this.sizeAttenuation&&(t.sizeAttenuation=this.sizeAttenuation),this.blending!==THREE.NormalBlending&&(t.blending=this.blending),!0===this.flatShading&&(t.flatShading=this.flatShading),this.side!==THREE.FrontSide&&(t.side=this.side),this.vertexColors!==THREE.NoColors&&(t.vertexColors=this.vertexColors),this.depthFunc!==THREE.LessEqualDepth&&(t.depthFunc=this.depthFunc),!1===this.depthTest&&(t.depthTest=this.depthTest),!1===this.depthWrite&&(t.depthWrite=this.depthWrite),1!==this.linewidth&&(t.linewidth=this.linewidth),void 0!==this.dashSize&&(t.dashSize=this.dashSize),void 0!==this.gapSize&&(t.gapSize=this.gapSize),void 0!==this.scale&&(t.scale=this.scale),!0===this.dithering&&(t.dithering=!0),!0===this.wireframe&&(t.wireframe=this.wireframe),this.wireframeLinewidth>1&&(t.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(t.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(t.wireframeLinejoin=this.wireframeLinejoin),this.alphaTest>0&&(t.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(t.premultipliedAlpha=this.premultipliedAlpha),!0===this.morphTargets&&(t.morphTargets=!0),!0===this.skinning&&(t.skinning=!0),!1===this.visible&&(t.visible=!1),"{}"!==JSON.stringify(this.userData)&&(t.userData=this.userData),t.fog=this.fog,t.lights=this.lights,t.vertex=this.vertex.toJSON(e).uuid,t.fragment=this.fragment.toJSON(e).uuid}return e.material=this.uuid,e},tt.prototype=Object.create(De.prototype),tt.prototype.constructor=tt,tt.prototype.nodeType="RTT",tt.prototype.build=function(e,t,n){var r=new Ue;return r.nodes=e.nodes,r.updaters=e.updaters,this.material.fragment.value=this.input,this.material.build({builder:r}),De.prototype.build.call(this,e,t,n)},tt.prototype.updateFramesaveTo=function(e){if(this.saveTo.render=!1,this.saveTo!==this.saveToCurrent){this.saveToMaterial&&this.saveToMaterial.dispose();var t=new et;t.fragment.value=this,t.build();var n=new THREE.Scene,r=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),t);r.frustumCulled=!1,n.add(r),this.saveToScene=n,this.saveToMaterial=t}this.saveToCurrent=this.saveTo,e.renderer.setRenderTarget(this.saveTo.renderTarget),this.saveTo.clear&&e.renderer.clear(),e.renderer.render(this.saveToScene,this.camera)},tt.prototype.updateFrame=function(e){e.renderer?(this.saveTo&&!1===this.saveTo.render&&this.updateFramesaveTo(e),this.render&&(this.material.uniforms.renderTexture&&(this.material.uniforms.renderTexture.value=e.renderTexture),e.renderer.setRenderTarget(this.renderTarget),this.clear&&e.renderer.clear(),e.renderer.render(this.scene,this.camera)),this.saveTo&&!0===this.saveTo.render&&this.updateFramesaveTo(e)):console.warn("RTTNode need a renderer in NodeFrame")},tt.prototype.copy=function(e){return De.prototype.copy.call(this,e),this.saveTo=e.saveTo,this},tt.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||(t=De.prototype.toJSON.call(this,e),this.saveTo&&(t.saveTo=this.saveTo.toJSON(e).uuid)),t};var nt,rt=["color","color2"],it=["vColor","vColor2"];function ot(e){W.call(this,"v4",{shared:!1}),this.index=e||0}function at(e,t){W.call(this,"v3"),this.setScope(e||at.POSITION),this.setCamera(t)}function st(e){W.call(this,"v3",{shared:!1}),this.scope=e||st.TOTAL}function ut(){Se.call(this),this.size=new THREE.Vector2}function ct(e){W.call(this,"v2"),this.resolution=e||new ut}function lt(e,t,n,r,i){W.call(this),this.a=e,this.b=t,this.op=n,this.ifNode=r,this.elseNode=i}function ht(e){W.call(this,"f"),this.uv=e||new Ne}function dt(e){W.call(this,"f"),this.uv=e||new Ne}function pt(e,t){W.call(this,"v3"),this.value=e,this.scale=t||new Se(1,1)}function ft(e,t){W.call(this,"v3"),this.value=e,this.scale=t||new Ce(1),this.toNormalMap=!1}function vt(e,t){q.call(this),this.code=e,this.value=t}ot.prototype=Object.create(W.prototype),ot.prototype.constructor=ot,ot.prototype.nodeType="Colors",ot.prototype.generate=function(e,t){e.requires.color[this.index]=!0;var n=e.isShader("vertex")?rt[this.index]:it[this.index];return e.format(n,this.getType(e),t)},ot.prototype.copy=function(e){return W.prototype.copy.call(this,e),this.index=e.index,this},ot.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).index=this.index),t},at.Nodes={depthColor:new oe(["float depthColor( float mNear, float mFar ) {","\t#ifdef USE_LOGDEPTHBUF_EXT","\t\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;","\t#else","\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;","\t#endif","\treturn 1.0 - smoothstep( mNear, mFar, depth );","}"].join("\n"))},at.POSITION="position",at.DEPTH="depth",at.TO_VERTEX="toVertex",at.prototype=Object.create(W.prototype),at.prototype.constructor=at,at.prototype.nodeType="Camera",at.prototype.setCamera=function(e){this.camera=e,this.updateFrame=void 0!==e?this.onUpdateFrame:void 0},at.prototype.setScope=function(e){switch(this.scope){case at.DEPTH:delete this.near,delete this.far}switch(this.scope=e,e){case at.DEPTH:var t=this.camera;this.near=new Ce(t?t.near:1),this.far=new Ce(t?t.far:1200)}},at.prototype.getType=function(){switch(this.scope){case at.DEPTH:return"f"}return this.type},at.prototype.getUnique=function(){switch(this.scope){case at.DEPTH:case at.TO_VERTEX:return!0}return!1},at.prototype.getShared=function(){switch(this.scope){case at.POSITION:return!1}return!0},at.prototype.generate=function(e,t){var n;switch(this.scope){case at.POSITION:n="cameraPosition";break;case at.DEPTH:n=e.include(at.Nodes.depthColor)+"( "+this.near.build(e,"f")+", "+this.far.build(e,"f")+" )";break;case at.TO_VERTEX:n="normalize( "+new Pe(Pe.WORLD).build(e,"v3")+" - cameraPosition )"}return e.format(n,this.getType(e),t)},at.prototype.onUpdateFrame=function(){switch(this.scope){case at.DEPTH:var e=this.camera;this.near.value=e.near,this.far.value=e.far}},at.prototype.copy=function(e){switch(W.prototype.copy.call(this,e),this.setScope(e.scope),e.camera&&this.setCamera(e.camera),e.scope){case at.DEPTH:this.near.number=e.near,this.far.number=e.far}return this},at.prototype.toJSON=function(e){var t=this.getJSONNode(e);if(!t)switch((t=this.createJSONNode(e)).scope=this.scope,this.camera&&(t.camera=this.camera.uuid),this.scope){case at.DEPTH:t.near=this.near.value,t.far=this.far.value}return t},st.TOTAL="total",st.prototype=Object.create(W.prototype),st.prototype.constructor=st,st.prototype.nodeType="Light",st.prototype.generate=function(e,t){return e.isCache("light")?e.format("reflectedLight.directDiffuse",this.type,t):(console.warn('THREE.LightNode is only compatible in "light" channel.'),e.format("vec3( 0.0 )",this.type,t))},st.prototype.copy=function(e){return W.prototype.copy.call(this,e),this.scope=e.scope,this},st.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).scope=this.scope),t},ut.prototype=Object.create(Se.prototype),ut.prototype.constructor=ut,ut.prototype.nodeType="Resolution",ut.prototype.updateFrame=function(e){if(e.renderer){e.renderer.getSize(this.size);var t=e.renderer.getPixelRatio();this.x=this.size.width*t,this.y=this.size.height*t}else console.warn("ResolutionNode need a renderer in NodeFrame")},ut.prototype.copy=function(e){return Se.prototype.copy.call(this,e),this.renderer=e.renderer,this},ut.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).renderer=this.renderer.uuid),t},ct.prototype=Object.create(W.prototype),ct.prototype.constructor=ct,ct.prototype.nodeType="ScreenUV",ct.prototype.generate=function(e,t){var n;return e.isShader("fragment")?n="( gl_FragCoord.xy / "+this.resolution.build(e,"v2")+")":(console.warn("THREE.ScreenUVNode is not compatible with "+e.shader+" shader."),n="vec2( 0.0 )"),e.format(n,this.getType(e),t)},ct.prototype.copy=function(e){return W.prototype.copy.call(this,e),this.resolution=e.resolution,this},ct.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).resolution=this.resolution.toJSON(e).uuid),t},lt.EQUAL="==",lt.NOT_EQUAL="!=",lt.GREATER=">",lt.GREATER_EQUAL=">=",lt.LESS="<",lt.LESS_EQUAL="<=",lt.prototype=Object.create(W.prototype),lt.prototype.constructor=lt,lt.prototype.nodeType="Cond",lt.prototype.getType=function(e){if(this.ifNode){var t=this.ifNode.getType(e),n=this.elseNode.getType(e);return e.getTypeLength(n)>e.getTypeLength(t)?n:t}return"b"},lt.prototype.getCondType=function(e){return e.getTypeLength(this.b.getType(e))>e.getTypeLength(this.a.getType(e))?this.b.getType(e):this.a.getType(e)},lt.prototype.generate=function(e,t){var n,r=this.getType(e),i=this.getCondType(e),o=this.a.build(e,i),a=this.b.build(e,i);if(this.ifNode){var s=this.ifNode.build(e,r),u=this.elseNode.build(e,r);n="( "+[o,this.op,a,"?",s,":",u].join(" ")+" )"}else n="( "+o+" "+this.op+" "+a+" )";return e.format(n,this.getType(e),t)},lt.prototype.copy=function(e){return W.prototype.copy.call(this,e),this.a=e.a,this.b=e.b,this.op=e.op,this.ifNode=e.ifNode,this.elseNode=e.elseNode,this},lt.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).a=this.a.toJSON(e).uuid,t.b=this.b.toJSON(e).uuid,t.op=this.op,t.ifNode&&(t.ifNode=this.ifNode.toJSON(e).uuid),t.elseNode&&(t.elseNode=this.elseNode.toJSON(e).uuid)),t},ht.prototype=Object.create(W.prototype),ht.prototype.constructor=ht,ht.prototype.nodeType="Noise",ht.Nodes={snoise:new oe(["float snoise(vec2 co) {","\treturn fract( sin( dot( co.xy, vec2( 12.9898, 78.233 ) ) ) * 43758.5453 );","}"].join("\n"))},ht.prototype.generate=function(e,t){var n=e.include(ht.Nodes.snoise);return e.format(n+"( "+this.uv.build(e,"v2")+" )",this.getType(e),t)},ht.prototype.copy=function(e){return W.prototype.copy.call(this,e),this.uv=e.uv,this},ht.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).uv=this.uv.toJSON(e).uuid),t},dt.prototype=Object.create(W.prototype),dt.prototype.constructor=dt,dt.prototype.nodeType="Noise",dt.Nodes={checker:new oe(["float checker( vec2 uv ) {","\tfloat cx = floor( uv.x );","\tfloat cy = floor( uv.y ); ","\tfloat result = mod( cx + cy, 2.0 );","\treturn sign( result );","}"].join("\n"))},dt.prototype.generate=function(e,t){var n=e.include(dt.Nodes.checker);return e.format(n+"( "+this.uv.build(e,"v2")+" )",this.getType(e),t)},dt.prototype.copy=function(e){return W.prototype.copy.call(this,e),this.uv=e.uv,this},dt.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).uv=this.uv.toJSON(e).uuid),t},pt.Nodes={perturbNormal2Arb:new oe("vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 map, vec2 vUv, vec2 normalScale ) {\n\n\t\t// Workaround for Adreno 3XX dFd*( vec3 ) bug. See #9988\n\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\n\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s ); // we do not care about the magnitude\n\n\t\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n\t\tvec3 N = normalize( surf_norm );\n\n\t\tvec3 mapN = map * 2.0 - 1.0;\n\n\t\tmapN.xy *= normalScale;\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\t// Workaround for Adreno GPUs gl_FrontFacing bug. See #15850 and #10331\n\n\t\t\tif ( dot( cross( S, T ), N ) < 0.0 ) mapN.xy *= - 1.0;\n\n\t\t#else\n\n\t\t\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\n\t\t#endif\n\n\t\tmat3 tsn = mat3( S, T, N );\n\t\treturn normalize( tsn * mapN );\n\n\t}",null,{derivatives:!0})},pt.prototype=Object.create(W.prototype),pt.prototype.constructor=pt,pt.prototype.nodeType="NormalMap",pt.prototype.generate=function(e,t){if(e.isShader("fragment")){var n=e.include(pt.Nodes.perturbNormal2Arb);this.normal=this.normal||new Le,this.position=this.position||new Pe(Pe.VIEW),this.uv=this.uv||new Ne;var r=this.scale.build(e,"v2");return e.material.side===THREE.BackSide&&(r="-"+r),e.format(n+"( -"+this.position.build(e,"v3")+", "+this.normal.build(e,"v3")+", "+this.value.build(e,"v3")+", "+this.uv.build(e,"v2")+", "+r+" )",this.getType(e),t)}return console.warn("THREE.NormalMapNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)},pt.prototype.copy=function(e){return W.prototype.copy.call(this,e),this.value=e.value,this.scale=e.scale,this},pt.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).value=this.value.toJSON(e).uuid,t.scale=this.scale.toJSON(e).uuid),t},ft.Nodes={dHdxy_fwd:nt=new oe(["vec2 dHdxy_fwd( sampler2D bumpMap, vec2 vUv, float bumpScale ) {","\tvec2 dSTdx = dFdx( vUv );","\tvec2 dSTdy = dFdy( vUv );","\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;","\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;","\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;","\treturn vec2( dBx, dBy );","}"].join("\n"),null,{derivatives:!0}),perturbNormalArb:new oe(["vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {","\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );","\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );","\tvec3 vN = surf_norm;","\tvec3 R1 = cross( vSigmaY, vN );","\tvec3 R2 = cross( vN, vSigmaX );","\tfloat fDet = dot( vSigmaX, R1 );","\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );","\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );","\treturn normalize( abs( fDet ) * surf_norm - vGrad );","}"].join("\n"),[nt],{derivatives:!0}),bumpToNormal:new oe(["vec3 bumpToNormal( sampler2D bumpMap, vec2 uv, float scale ) {","\tvec2 dSTdx = dFdx( uv );","\tvec2 dSTdy = dFdy( uv );","\tfloat Hll = texture2D( bumpMap, uv ).x;","\tfloat dBx = texture2D( bumpMap, uv + dSTdx ).x - Hll;","\tfloat dBy = texture2D( bumpMap, uv + dSTdy ).x - Hll;","\treturn vec3( .5 - ( dBx * scale ), .5 - ( dBy * scale ), 1.0 );","}"].join("\n"),null,{derivatives:!0})},ft.prototype=Object.create(W.prototype),ft.prototype.constructor=ft,ft.prototype.nodeType="BumpMap",ft.prototype.generate=function(e,t){if(e.isShader("fragment")){if(this.toNormalMap){var n=e.include(ft.Nodes.bumpToNormal);return e.format(n+"( "+this.value.build(e,"sampler2D")+", "+this.value.uv.build(e,"v2")+", "+this.scale.build(e,"f")+" )",this.getType(e),t)}var r=e.include(ft.Nodes.dHdxy_fwd),i=e.include(ft.Nodes.perturbNormalArb);this.normal=this.normal||new Le,this.position=this.position||new Pe(Pe.VIEW);var o=r+"( "+this.value.build(e,"sampler2D")+", "+this.value.uv.build(e,"v2")+", "+this.scale.build(e,"f")+" )";return e.format(i+"( -"+this.position.build(e,"v3")+", "+this.normal.build(e,"v3")+", "+o+" )",this.getType(e),t)}return console.warn("THREE.BumpMapNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)},ft.prototype.copy=function(e){return W.prototype.copy.call(this,e),this.value=e.value,this.scale=e.scale,this},ft.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).value=this.value.toJSON(e).uuid,t.scale=this.scale.toJSON(e).uuid),t},vt.prototype=Object.create(q.prototype),vt.prototype.constructor=vt,vt.prototype.nodeType="Bypass",vt.prototype.getType=function(e){return this.value?this.value.getType(e):e.isShader("fragment")?"f":"void"},vt.prototype.generate=function(e,t){var n=this.code.build(e,t)+";";return e.addNodeCode(n),e.isShader("vertex")?this.value?this.value.build(e,t):void 0:this.value?this.value.build(e,t):e.format("0.0","f",t)},vt.prototype.copy=function(e){return q.prototype.copy.call(this,e),this.code=e.code,this.value=e.value,this},vt.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).code=this.code.toJSON(e).uuid,this.value&&(t.value=this.value.toJSON(e).uuid)),t};var mt,yt=Te.elements;function gt(e,t,n,r){W.call(this,"f"),this.x=e,this.y=t,this.z=n,this.w=r}function xt(e,t){q.call(this),this.node=e,this.components=t||"x"}function bt(e,t,n){Ce.call(this),this.scale=void 0!==e?e:1,this.scope=t||bt.GLOBAL,this.timeScale=void 0!==n?n:void 0!==e}function wt(e,t){Oe.call(this),this.params={},this.velocity=new THREE.Vector3,this.setTarget(e),this.setParams(t)}function Tt(e,t){ae.call(this,"( uvTransform * vec3( uvNode, 1 ) ).xy","vec2"),this.uv=e||new Ne,this.position=t||new Xe}function Et(e){Ce.call(this),this.texture=e,this.maxMIPLevel=0}function _t(e,t){W.call(this,"f"),this.roughness=e,this.texture=t,this.maxMIPLevel=void 0}function St(e){W.call(this),this.slots=e||{}}function Ot(e,t,n,r){W.call(this,"v4"),this.value=e,this.uv=t||new Ne,this.radius=n||new Se(1,1),this.size=r,this.blurX=!0,this.blurY=!0,this.horizontal=new Ce(1/64),this.vertical=new Ce(1/64)}function Rt(e){W.call(this,"f"),this.rgb=e}function Nt(e,t,n){W.call(this,"v3"),this.rgb=e,this.adjustment=t,this.method=n||Nt.SATURATION}function Ct(){q.call(this),this.color=new We(15658734),this.spherical=!0}function Mt(){q.call(this),this.color=new We(15658734),this.specular=new We(1118481),this.shininess=new Ce(30)}function Dt(){q.call(this),this.color=new We(16777215),this.roughness=new Ce(1),this.metalness=new Ce(0)}function Pt(){Dt.call(this),this.properties={color:new THREE.Color(16777215),roughness:.5,metalness:.5,normalScale:new THREE.Vector2(1,1)},this.inputs={color:new Qe(this.properties,"color","c"),roughness:new Qe(this.properties,"roughness","f"),metalness:new Qe(this.properties,"metalness","f"),normalScale:new Qe(this.properties,"normalScale","v2")}}function Lt(){var e=new Ct;et.call(this,e,e),this.type="SpriteNodeMaterial"}function kt(){var e=new Mt;et.call(this,e,e),this.type="PhongNodeMaterial"}function It(){var e=new Dt;et.call(this,e,e),this.type="StandardNodeMaterial"}function At(){var e=new Pt;et.call(this,e,e),this.type="MeshStandardNodeMaterial"}function jt(e,t){if(void 0===t){var n={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,stencilBuffer:!1},r=e.getDrawingBufferSize(new THREE.Vector2);t=new THREE.WebGLRenderTarget(r.width,r.height,n)}this.renderer=e,this.renderTarget=t,this.output=new Ze,this.material=new et,this.camera=new THREE.OrthographicCamera(-1,1,1,-1,0,1),this.scene=new THREE.Scene,this.quad=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),this.material),this.quad.frustumCulled=!1,this.scene.add(this.quad),this.needsUpdate=!0}gt.prototype=Object.create(W.prototype),gt.prototype.constructor=gt,gt.prototype.nodeType="Join",gt.prototype.getNumElements=function(){for(var e=yt.length;e--;)if(void 0!==this[yt[e]]){++e;break}return Math.max(e,2)},gt.prototype.getType=function(e){return e.getTypeFromLength(this.getNumElements())},gt.prototype.generate=function(e,t){for(var n=this.getType(e),r=this.getNumElements(),i=[],o=0;o<r;o++){var a=this[yt[o]];i.push(a?a.build(e,"f"):"0.0")}var s=(r>1?e.getConstructorFromLength(r):"")+"( "+i.join(", ")+" )";return e.format(s,n,t)},gt.prototype.copy=function(e){for(var t in W.prototype.copy.call(this,e),e.inputs)this[t]=e.inputs[t];return this},gt.prototype.toJSON=function(e){var t=this.getJSONNode(e);if(!t){(t=this.createJSONNode(e)).inputs={};for(var n=this.getNumElements(),r=0;r<n;r++){var i=this[yt[r]];i&&(t.inputs[yt[r]]=i.toJSON(e).uuid)}}return t},xt.prototype=Object.create(q.prototype),xt.prototype.constructor=xt,xt.prototype.nodeType="Switch",xt.prototype.getType=function(e){return e.getTypeFromLength(this.components.length)},xt.prototype.generate=function(e,t){var n=this.node.getType(e),r=this.node.build(e,n),i=e.getTypeLength(n)-1;if(i>0){var o,a=0,s=e.colorToVectorProperties(this.components),u=s.length;for(o=0;o<u;o++)a=Math.max(a,e.getIndexByElement(s.charAt(o)));for(a>i&&(a=i),r+=".",o=0;o<u;o++){var c=e.getIndexByElement(s.charAt(o));c>a&&(c=a),r+=e.getElementByIndex(c)}return e.format(r,this.getType(e),t)}return e.format(r,n,t)},xt.prototype.copy=function(e){return q.prototype.copy.call(this,e),this.node=e.node,this.components=e.components,this},xt.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).node=this.node.toJSON(e).uuid,t.components=this.components),t},bt.GLOBAL="global",bt.LOCAL="local",bt.DELTA="delta",bt.prototype=Object.create(Ce.prototype),bt.prototype.constructor=bt,bt.prototype.nodeType="Timer",bt.prototype.getReadonly=function(){return!1},bt.prototype.getUnique=function(){return this.timeScale&&(this.scope===bt.GLOBAL||this.scope===bt.DELTA)},bt.prototype.updateFrame=function(e){var t=this.timeScale?this.scale:1;switch(this.scope){case bt.LOCAL:this.value+=e.delta*t;break;case bt.DELTA:this.value=e.delta*t;break;default:this.value=e.time*t}},bt.prototype.copy=function(e){return Ce.prototype.copy.call(this,e),this.scope=e.scope,this.scale=e.scale,this.timeScale=e.timeScale,this},bt.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).scope=this.scope,t.scale=this.scale,t.timeScale=this.timeScale),t},ne.addKeyword("time",(function(){return new bt})),wt.prototype=Object.create(Oe.prototype),wt.prototype.constructor=wt,wt.prototype.nodeType="Velocity",wt.prototype.getReadonly=function(){return!1},wt.prototype.setParams=function(e){switch(this.params.type){case"elastic":delete this.moment,delete this.speed,delete this.springVelocity,delete this.lastVelocity}switch(this.params=e||{},this.params.type){case"elastic":this.moment=new THREE.Vector3,this.speed=new THREE.Vector3,this.springVelocity=new THREE.Vector3,this.lastVelocity=new THREE.Vector3}},wt.prototype.setTarget=function(e){this.target&&(delete this.position,delete this.oldPosition),this.target=e,e&&(this.position=e.getWorldPosition(this.position||new THREE.Vector3),this.oldPosition=this.position.clone())},wt.prototype.updateFrameVelocity=function(){this.target&&(this.position=this.target.getWorldPosition(this.position||new THREE.Vector3),this.velocity.subVectors(this.position,this.oldPosition),this.oldPosition.copy(this.position))},wt.prototype.updateFrame=function(e){switch(this.updateFrameVelocity(e),this.params.type){case"elastic":var t=e.delta*(this.params.fps||60),n=Math.pow(this.params.spring,t),r=Math.pow(this.params.damping,t);this.velocity.multiplyScalar(Math.exp(-this.params.damping*t)),this.velocity.add(this.springVelocity),this.velocity.add(this.speed.multiplyScalar(r).multiplyScalar(1-n)),this.speed.subVectors(this.velocity,this.lastVelocity),this.springVelocity.add(this.speed),this.springVelocity.multiplyScalar(n),this.moment.add(this.springVelocity),this.moment.multiplyScalar(r),this.lastVelocity.copy(this.velocity),this.value.copy(this.moment);break;default:this.value.copy(this.velocity)}},wt.prototype.copy=function(e){return Oe.prototype.copy.call(this,e),e.target&&this.setTarget(e.target),this.setParams(e.params),this},wt.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||(t=this.createJSONNode(e),this.target&&(t.target=this.target.uuid),t.params=JSON.parse(JSON.stringify(this.params))),t},Tt.prototype=Object.create(ae.prototype),Tt.prototype.constructor=Tt,Tt.prototype.nodeType="UVTransform",Tt.prototype.generate=function(e,t){return this.keywords.uvNode=this.uv,this.keywords.uvTransform=this.position,ae.prototype.generate.call(this,e,t)},Tt.prototype.setUvTransform=function(e,t,n,r,i,o,a){o=void 0!==o?o:.5,a=void 0!==a?a:.5,this.position.value.setUvTransform(e,t,n,r,i,o,a)},Tt.prototype.copy=function(e){return ae.prototype.copy.call(this,e),this.uv=e.uv,this.position=e.position,this},Tt.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).uv=this.uv.toJSON(e).uuid,t.position=this.position.toJSON(e).uuid),t},Et.prototype=Object.create(Ce.prototype),Et.prototype.constructor=Et,Et.prototype.nodeType="MaxMIPLevel",Object.defineProperties(Et.prototype,{value:{get:function(){if(0===this.maxMIPLevel){var e=this.texture.value.image;Array.isArray(e)&&(e=e[0]),this.maxMIPLevel=void 0!==e?Math.log(Math.max(e.width,e.height))*Math.LOG2E:0}return this.maxMIPLevel},set:function(){}}}),Et.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).texture=this.texture.uuid),t},_t.Nodes={getSpecularMIPLevel:new oe(["float getSpecularMIPLevel( const in float roughness, const in float maxMIPLevelScalar ) {","\tfloat sigma = PI * roughness * roughness / ( 1.0 + roughness );","\tfloat desiredMIPLevel = maxMIPLevelScalar + log2( sigma );","\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );","}"].join("\n"))},_t.prototype=Object.create(W.prototype),_t.prototype.constructor=_t,_t.prototype.nodeType="SpecularMIPLevel",_t.prototype.setTexture=function(e){return this.texture=e,this},_t.prototype.generate=function(e,t){if(e.isShader("fragment")){this.maxMIPLevel=this.maxMIPLevel||new Et,this.maxMIPLevel.texture=this.texture;var n=e.include(_t.Nodes.getSpecularMIPLevel);return e.format(n+"( "+this.roughness.build(e,"f")+", "+this.maxMIPLevel.build(e,"f")+" )",this.type,t)}return console.warn("THREE.SpecularMIPLevelNode is not compatible with "+e.shader+" shader."),e.format("0.0",this.type,t)},_t.prototype.copy=function(e){return W.prototype.copy.call(this,e),this.texture=e.texture,this.roughness=e.roughness,this},_t.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).texture=this.texture,t.roughness=this.roughness),t},St.prototype=Object.create(W.prototype),St.prototype.constructor=St,St.prototype.nodeType="SubSlot",St.prototype.getType=function(e,t){return t},St.prototype.generate=function(e,t){return this.slots[e.slot]?this.slots[e.slot].build(e,t):e.format("0.0","f",t)},St.prototype.copy=function(e){for(var t in W.prototype.copy.call(this,e),e.slots)this.slots[t]=e.slots[t];return this},St.prototype.toJSON=function(e){var t=this.getJSONNode(e);if(!t)for(var n in(t=this.createJSONNode(e)).slots={},this.slots){var r=this.slots[n];r&&(t.slots[n]=r.toJSON(e).uuid)}return t},Ot.Nodes={blurX:new oe(["vec4 blurX( sampler2D texture, vec2 uv, float s ) {","\tvec4 sum = vec4( 0.0 );","\tsum += texture2D( texture, vec2( uv.x - 4.0 * s, uv.y ) ) * 0.051;","\tsum += texture2D( texture, vec2( uv.x - 3.0 * s, uv.y ) ) * 0.0918;","\tsum += texture2D( texture, vec2( uv.x - 2.0 * s, uv.y ) ) * 0.12245;","\tsum += texture2D( texture, vec2( uv.x - 1.0 * s, uv.y ) ) * 0.1531;","\tsum += texture2D( texture, vec2( uv.x, uv.y ) ) * 0.1633;","\tsum += texture2D( texture, vec2( uv.x + 1.0 * s, uv.y ) ) * 0.1531;","\tsum += texture2D( texture, vec2( uv.x + 2.0 * s, uv.y ) ) * 0.12245;","\tsum += texture2D( texture, vec2( uv.x + 3.0 * s, uv.y ) ) * 0.0918;","\tsum += texture2D( texture, vec2( uv.x + 4.0 * s, uv.y ) ) * 0.051;","\treturn sum * .667;","}"].join("\n")),blurY:new oe(["vec4 blurY( sampler2D texture, vec2 uv, float s ) {","\tvec4 sum = vec4( 0.0 );","\tsum += texture2D( texture, vec2( uv.x, uv.y - 4.0 * s ) ) * 0.051;","\tsum += texture2D( texture, vec2( uv.x, uv.y - 3.0 * s ) ) * 0.0918;","\tsum += texture2D( texture, vec2( uv.x, uv.y - 2.0 * s ) ) * 0.12245;","\tsum += texture2D( texture, vec2( uv.x, uv.y - 1.0 * s ) ) * 0.1531;","\tsum += texture2D( texture, vec2( uv.x, uv.y ) ) * 0.1633;","\tsum += texture2D( texture, vec2( uv.x, uv.y + 1.0 * s ) ) * 0.1531;","\tsum += texture2D( texture, vec2( uv.x, uv.y + 2.0 * s ) ) * 0.12245;","\tsum += texture2D( texture, vec2( uv.x, uv.y + 3.0 * s ) ) * 0.0918;","\tsum += texture2D( texture, vec2( uv.x, uv.y + 4.0 * s ) ) * 0.051;","\treturn sum * .667;","}"].join("\n"))},Ot.prototype=Object.create(W.prototype),Ot.prototype.constructor=Ot,Ot.prototype.nodeType="Blur",Ot.prototype.updateFrame=function(){if(this.size)this.horizontal.value=this.radius.x/this.size.x,this.vertical.value=this.radius.y/this.size.y;else if(this.value.value&&this.value.value.image){var e=this.value.value.image;this.horizontal.value=this.radius.x/e.width,this.vertical.value=this.radius.y/e.height}},Ot.prototype.generate=function(e,t){if(e.isShader("fragment")){var n,r=[],i=e.include(Ot.Nodes.blurX),o=e.include(Ot.Nodes.blurY);return this.blurX&&r.push(i+"( "+this.value.build(e,"sampler2D")+", "+this.uv.build(e,"v2")+", "+this.horizontal.build(e,"f")+" )"),this.blurY&&r.push(o+"( "+this.value.build(e,"sampler2D")+", "+this.uv.build(e,"v2")+", "+this.vertical.build(e,"f")+" )"),n=2==r.length?"( "+r.join(" + ")+" / 2.0 )":r.length?"( "+r[0]+" )":"vec4( 0.0 )",e.format(n,this.getType(e),t)}return console.warn("THREE.BlurNode is not compatible with "+e.shader+" shader."),e.format("vec4( 0.0 )",this.getType(e),t)},Ot.prototype.copy=function(e){return W.prototype.copy.call(this,e),this.value=e.value,this.uv=e.uv,this.radius=e.radius,void 0!==e.size&&(this.size=new THREE.Vector2(e.size.x,e.size.y)),this.blurX=e.blurX,this.blurY=e.blurY,this},Ot.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).value=this.value.toJSON(e).uuid,t.uv=this.uv.toJSON(e).uuid,t.radius=this.radius.toJSON(e).uuid,this.size&&(t.size={x:this.size.x,y:this.size.y}),t.blurX=this.blurX,t.blurY=this.blurY),t},Rt.Nodes={LUMA:mt=new Z("vec3 LUMA vec3( 0.2125, 0.7154, 0.0721 )"),luminance:new oe(["float luminance( vec3 rgb ) {","\treturn dot( rgb, LUMA );","}"].join("\n"),[mt])},Rt.prototype=Object.create(W.prototype),Rt.prototype.constructor=Rt,Rt.prototype.nodeType="Luminance",Rt.prototype.generate=function(e,t){var n=e.include(Rt.Nodes.luminance);return e.format(n+"( "+this.rgb.build(e,"v3")+" )",this.getType(e),t)},Rt.prototype.copy=function(e){return W.prototype.copy.call(this,e),this.rgb=e.rgb,this},Rt.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).rgb=this.rgb.toJSON(e).uuid),t},Nt.Nodes={hue:new oe(["vec3 hue(vec3 rgb, float adjustment) {","\tconst mat3 RGBtoYIQ = mat3(0.299, 0.587, 0.114, 0.595716, -0.274453, -0.321263, 0.211456, -0.522591, 0.311135);","\tconst mat3 YIQtoRGB = mat3(1.0, 0.9563, 0.6210, 1.0, -0.2721, -0.6474, 1.0, -1.107, 1.7046);","\tvec3 yiq = RGBtoYIQ * rgb;","\tfloat hue = atan(yiq.z, yiq.y) + adjustment;","\tfloat chroma = sqrt(yiq.z * yiq.z + yiq.y * yiq.y);","\treturn YIQtoRGB * vec3(yiq.x, chroma * cos(hue), chroma * sin(hue));","}"].join("\n")),saturation:new oe(["vec3 saturation(vec3 rgb, float adjustment) {","\tvec3 intensity = vec3( luminance( rgb ) );","\treturn mix( intensity, rgb, adjustment );","}"].join("\n"),[Rt.Nodes.luminance]),vibrance:new oe(["vec3 vibrance(vec3 rgb, float adjustment) {","\tfloat average = (rgb.r + rgb.g + rgb.b) / 3.0;","\tfloat mx = max(rgb.r, max(rgb.g, rgb.b));","\tfloat amt = (mx - average) * (-3.0 * adjustment);","\treturn mix(rgb.rgb, vec3(mx), amt);","}"].join("\n"))},Nt.SATURATION="saturation",Nt.HUE="hue",Nt.VIBRANCE="vibrance",Nt.BRIGHTNESS="brightness",Nt.CONTRAST="contrast",Nt.prototype=Object.create(W.prototype),Nt.prototype.constructor=Nt,Nt.prototype.nodeType="ColorAdjustment",Nt.prototype.generate=function(e,t){var n=this.rgb.build(e,"v3"),r=this.adjustment.build(e,"f");switch(this.method){case Nt.BRIGHTNESS:return e.format("( "+n+" + "+r+" )",this.getType(e),t);case Nt.CONTRAST:return e.format("( "+n+" * "+r+" )",this.getType(e),t)}var i=e.include(Nt.Nodes[this.method]);return e.format(i+"( "+n+", "+r+" )",this.getType(e),t)},Nt.prototype.copy=function(e){return W.prototype.copy.call(this,e),this.rgb=e.rgb,this.adjustment=e.adjustment,this.method=e.method,this},Nt.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).rgb=this.rgb.toJSON(e).uuid,t.adjustment=this.adjustment.toJSON(e).uuid,t.method=this.method),t},Ct.prototype=Object.create(q.prototype),Ct.prototype.constructor=Ct,Ct.prototype.nodeType="Sprite",Ct.prototype.build=function(e){if(e.define("SPRITE"),e.requires.lights=!1,e.requires.transparent=void 0!==this.alpha,e.isShader("vertex")){var t=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform(THREE.UniformsUtils.merge([THREE.UniformsLib.fog])),e.addParsCode(["#include <fog_pars_vertex>","#include <logdepthbuf_pars_vertex>","#include <clipping_planes_pars_vertex>"].join("\n")),o=["#include <clipping_planes_fragment>","#include <begin_vertex>"],t&&o.push(t.code,t.result?"transformed = "+t.result+";":""),o.push("#include <project_vertex>","#include <fog_vertex>","mat4 modelViewMtx = modelViewMatrix;","mat4 modelMtx = modelMatrix;","modelMtx[3][0] = 0.0;","modelMtx[3][1] = 0.0;","modelMtx[3][2] = 0.0;"),this.spherical||o.push("modelMtx[1][1] = 1.0;"),o.push("modelViewMtx[0][0] = 1.0;","modelViewMtx[0][1] = 0.0;","modelViewMtx[0][2] = 0.0;"),this.spherical&&o.push("modelViewMtx[1][0] = 0.0;","modelViewMtx[1][1] = 1.0;","modelViewMtx[1][2] = 0.0;"),o.push("modelViewMtx[2][0] = 0.0;","modelViewMtx[2][1] = 0.0;","modelViewMtx[2][2] = 1.0;","gl_Position = projectionMatrix * modelViewMtx * modelMtx * vec4( transformed, 1.0 );","#include <logdepthbuf_vertex>","#include <clipping_planes_vertex>","#include <fog_vertex>")}else{e.addParsCode(["#include <fog_pars_fragment>","#include <logdepthbuf_pars_fragment>","#include <clipping_planes_pars_fragment>"].join("\n")),e.addCode(["#include <clipping_planes_fragment>","#include <logdepthbuf_fragment>"].join("\n")),this.mask&&this.mask.analyze(e),this.alpha&&this.alpha.analyze(e),this.color.analyze(e,{slot:"color"});var n=this.mask?this.mask.flow(e,"b"):void 0,r=this.alpha?this.alpha.flow(e,"f"):void 0,i=this.color.flow(e,"c",{slot:"color"}),o=[];n&&o.push(n.code,"if ( ! "+n.result+" ) discard;"),r?o.push(r.code,"#ifdef ALPHATEST","if ( "+r.result+" <= ALPHATEST ) discard;","#endif",i.code,"gl_FragColor = vec4( "+i.result+", "+r.result+" );"):o.push(i.code,"gl_FragColor = vec4( "+i.result+", 1.0 );"),o.push("#include <tonemapping_fragment>","#include <encodings_fragment>","#include <fog_fragment>")}return o.join("\n")},Ct.prototype.copy=function(e){return q.prototype.copy.call(this,e),e.position&&(this.position=e.position),this.color=e.color,void 0!==e.spherical&&(this.spherical=e.spherical),e.mask&&(this.mask=e.mask),e.alpha&&(this.alpha=e.alpha),this},Ct.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||(t=this.createJSONNode(e),this.position&&(t.position=this.position.toJSON(e).uuid),t.color=this.color.toJSON(e).uuid,!1===this.spherical&&(t.spherical=!1),this.mask&&(t.mask=this.mask.toJSON(e).uuid),this.alpha&&(t.alpha=this.alpha.toJSON(e).uuid)),t},Mt.prototype=Object.create(q.prototype),Mt.prototype.constructor=Mt,Mt.prototype.nodeType="Phong",Mt.prototype.build=function(e){var t;if(e.define("PHONG"),e.requires.lights=!0,e.isShader("vertex")){var n=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform(THREE.UniformsUtils.merge([THREE.UniformsLib.fog,THREE.UniformsLib.lights])),e.addParsCode(["varying vec3 vViewPosition;","#ifndef FLAT_SHADED","\tvarying vec3 vNormal;","#endif","#include <fog_pars_vertex>","#include <morphtarget_pars_vertex>","#include <skinning_pars_vertex>","#include <shadowmap_pars_vertex>","#include <logdepthbuf_pars_vertex>","#include <clipping_planes_pars_vertex>"].join("\n"));var r=["#include <beginnormal_vertex>","#include <morphnormal_vertex>","#include <skinbase_vertex>","#include <skinnormal_vertex>","#include <defaultnormal_vertex>","#ifndef FLAT_SHADED","\tvNormal = normalize( transformedNormal );","#endif","#include <begin_vertex>"];n&&r.push(n.code,n.result?"transformed = "+n.result+";":""),r.push("\t#include <morphtarget_vertex>","\t#include <skinning_vertex>","\t#include <project_vertex>","\t#include <fog_vertex>","\t#include <logdepthbuf_vertex>","\t#include <clipping_planes_vertex>","\tvViewPosition = - mvPosition.xyz;","\t#include <worldpos_vertex>","\t#include <shadowmap_vertex>","\t#include <fog_vertex>"),t=r.join("\n")}else{this.mask&&this.mask.analyze(e),this.color.analyze(e,{slot:"color"}),this.specular.analyze(e),this.shininess.analyze(e),this.alpha&&this.alpha.analyze(e),this.normal&&this.normal.analyze(e),this.light&&this.light.analyze(e,{cache:"light"}),this.ao&&this.ao.analyze(e),this.ambient&&this.ambient.analyze(e),this.shadow&&this.shadow.analyze(e),this.emissive&&this.emissive.analyze(e,{slot:"emissive"}),this.environment&&this.environment.analyze(e,{slot:"environment"}),this.environmentAlpha&&this.environment&&this.environmentAlpha.analyze(e);var i=this.mask?this.mask.flow(e,"b"):void 0,o=this.color.flow(e,"c",{slot:"color"}),a=this.specular.flow(e,"c"),s=this.shininess.flow(e,"f"),u=this.alpha?this.alpha.flow(e,"f"):void 0,c=this.normal?this.normal.flow(e,"v3"):void 0,l=this.light?this.light.flow(e,"v3",{cache:"light"}):void 0,h=this.ao?this.ao.flow(e,"f"):void 0,d=this.ambient?this.ambient.flow(e,"c"):void 0,p=this.shadow?this.shadow.flow(e,"c"):void 0,f=this.emissive?this.emissive.flow(e,"c",{slot:"emissive"}):void 0,v=this.environment?this.environment.flow(e,"c",{slot:"environment"}):void 0,m=this.environmentAlpha&&this.environment?this.environmentAlpha.flow(e,"f"):void 0;e.requires.transparent=void 0!==u,e.addParsCode(["#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_phong_pars_fragment>","#include <shadowmap_pars_fragment>","#include <logdepthbuf_pars_fragment>"].join("\n"));r=["#include <normal_fragment_begin>","\tBlinnPhongMaterial material;"];i&&r.push(i.code,"if ( ! "+i.result+" ) discard;"),r.push(o.code,"\tvec3 diffuseColor = "+o.result+";","\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );","#include <logdepthbuf_fragment>",a.code,"\tvec3 specular = "+a.result+";",s.code,"\tfloat shininess = max( 0.0001, "+s.result+" );","\tfloat specularStrength = 1.0;"),u&&r.push(u.code,"#ifdef ALPHATEST","if ( "+u.result+" <= ALPHATEST ) discard;","#endif"),c&&r.push(c.code,"normal = "+c.result+";"),r.push("material.diffuseColor = "+(l?"vec3( 1.0 )":"diffuseColor")+";"),r.push("material.specularColor = specular;","material.specularShininess = shininess;","material.specularStrength = specularStrength;","#include <lights_fragment_begin>","#include <lights_fragment_end>"),l&&(r.push(l.code,"reflectedLight.directDiffuse = "+l.result+";"),r.push("reflectedLight.directDiffuse *= diffuseColor;","reflectedLight.indirectDiffuse *= diffuseColor;")),h&&r.push(h.code,"reflectedLight.indirectDiffuse *= "+h.result+";"),d&&r.push(d.code,"reflectedLight.indirectDiffuse += "+d.result+";"),p&&r.push(p.code,"reflectedLight.directDiffuse *= "+p.result+";","reflectedLight.directSpecular *= "+p.result+";"),f&&r.push(f.code,"reflectedLight.directDiffuse += "+f.result+";"),r.push("vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular;"),v&&(r.push(v.code),m?r.push(m.code,"outgoingLight = mix( outgoingLight, "+v.result+", "+m.result+" );"):r.push("outgoingLight = "+v.result+";")),u?r.push("gl_FragColor = vec4( outgoingLight, "+u.result+" );"):r.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),r.push("#include <tonemapping_fragment>","#include <encodings_fragment>","#include <fog_fragment>","#include <premultiplied_alpha_fragment>"),t=r.join("\n")}return t},Mt.prototype.copy=function(e){return q.prototype.copy.call(this,e),e.position&&(this.position=e.position),this.color=e.color,this.specular=e.specular,this.shininess=e.shininess,e.mask&&(this.mask=e.mask),e.alpha&&(this.alpha=e.alpha),e.normal&&(this.normal=e.normal),e.light&&(this.light=e.light),e.shadow&&(this.shadow=e.shadow),e.ao&&(this.ao=e.ao),e.emissive&&(this.emissive=e.emissive),e.ambient&&(this.ambient=e.ambient),e.environment&&(this.environment=e.environment),e.environmentAlpha&&(this.environmentAlpha=e.environmentAlpha),this},Mt.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||(t=this.createJSONNode(e),this.position&&(t.position=this.position.toJSON(e).uuid),t.color=this.color.toJSON(e).uuid,t.specular=this.specular.toJSON(e).uuid,t.shininess=this.shininess.toJSON(e).uuid,this.mask&&(t.mask=this.mask.toJSON(e).uuid),this.alpha&&(t.alpha=this.alpha.toJSON(e).uuid),this.normal&&(t.normal=this.normal.toJSON(e).uuid),this.light&&(t.light=this.light.toJSON(e).uuid),this.ao&&(t.ao=this.ao.toJSON(e).uuid),this.ambient&&(t.ambient=this.ambient.toJSON(e).uuid),this.shadow&&(t.shadow=this.shadow.toJSON(e).uuid),this.emissive&&(t.emissive=this.emissive.toJSON(e).uuid),this.environment&&(t.environment=this.environment.toJSON(e).uuid),this.environmentAlpha&&(t.environmentAlpha=this.environmentAlpha.toJSON(e).uuid)),t},Dt.prototype=Object.create(q.prototype),Dt.prototype.constructor=Dt,Dt.prototype.nodeType="Standard",Dt.prototype.build=function(e){var t;e.define("STANDARD");var n=this.clearcoat||this.clearcoatRoughness||this.clearCoatNormal;if(n&&e.define("CLEARCOAT"),e.requires.lights=!0,e.extensions.derivatives=!0,e.extensions.shaderTextureLOD=!0,e.isShader("vertex")){var r=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform(THREE.UniformsUtils.merge([THREE.UniformsLib.fog,THREE.UniformsLib.lights])),THREE.UniformsLib.LTC_1&&(e.uniforms.ltc_1={value:void 0},e.uniforms.ltc_2={value:void 0}),e.addParsCode(["varying vec3 vViewPosition;","#ifndef FLAT_SHADED","\tvarying vec3 vNormal;","#endif","#include <fog_pars_vertex>","#include <morphtarget_pars_vertex>","#include <skinning_pars_vertex>","#include <shadowmap_pars_vertex>","#include <logdepthbuf_pars_vertex>","#include <clipping_planes_pars_vertex>"].join("\n"));var i=["#include <beginnormal_vertex>","#include <morphnormal_vertex>","#include <skinbase_vertex>","#include <skinnormal_vertex>","#include <defaultnormal_vertex>","#ifndef FLAT_SHADED","\tvNormal = normalize( transformedNormal );","#endif","#include <begin_vertex>"];r&&i.push(r.code,r.result?"transformed = "+r.result+";":""),i.push("#include <morphtarget_vertex>","#include <skinning_vertex>","#include <project_vertex>","#include <fog_vertex>","#include <logdepthbuf_vertex>","#include <clipping_planes_vertex>","\tvViewPosition = - mvPosition.xyz;","#include <worldpos_vertex>","#include <shadowmap_vertex>"),t=i.join("\n")}else{var o=new ae("material.specularRoughness","f"),a=new ae("material.clearcoatRoughness","f"),s={roughness:o,bias:new _t(o),viewNormal:new ae("normal","v3"),worldNormal:new ae("inverseTransformDirection( geometry.normal, viewMatrix )","v3"),gamma:!0},u={gamma:!0},c={roughness:a,bias:new _t(a),viewNormal:new ae("clearcoatNormal","v3"),worldNormal:new ae("inverseTransformDirection( geometry.clearcoatNormal, viewMatrix )","v3"),gamma:!0};this.mask&&this.mask.analyze(e),this.color.analyze(e,{slot:"color",context:u}),this.roughness.analyze(e),this.metalness.analyze(e),this.alpha&&this.alpha.analyze(e),this.normal&&this.normal.analyze(e),this.clearcoat&&this.clearcoat.analyze(e),this.clearcoatRoughness&&this.clearcoatRoughness.analyze(e),this.clearcoatNormal&&this.clearcoatNormal.analyze(e),this.reflectivity&&this.reflectivity.analyze(e),this.light&&this.light.analyze(e,{cache:"light"}),this.ao&&this.ao.analyze(e),this.ambient&&this.ambient.analyze(e),this.shadow&&this.shadow.analyze(e),this.emissive&&this.emissive.analyze(e,{slot:"emissive"}),this.environment&&(this.environment.analyze(e,{cache:"radiance",context:s,slot:"radiance"}),e.requires.irradiance&&this.environment.analyze(e,{cache:"irradiance",context:s,slot:"irradiance"})),this.sheen&&this.sheen.analyze(e);var l,h=this.mask?this.mask.flow(e,"b"):void 0,d=this.color.flow(e,"c",{slot:"color",context:u}),p=this.roughness.flow(e,"f"),f=this.metalness.flow(e,"f"),v=this.alpha?this.alpha.flow(e,"f"):void 0,m=this.normal?this.normal.flow(e,"v3"):void 0,y=this.clearcoat?this.clearcoat.flow(e,"f"):void 0,g=(a=this.clearcoatRoughness?this.clearcoatRoughness.flow(e,"f"):void 0,this.clearcoatNormal?this.clearcoatNormal.flow(e,"v3"):void 0),x=this.reflectivity?this.reflectivity.flow(e,"f"):void 0,b=this.light?this.light.flow(e,"v3",{cache:"light"}):void 0,w=this.ao?this.ao.flow(e,"f"):void 0,T=this.ambient?this.ambient.flow(e,"c"):void 0,E=this.shadow?this.shadow.flow(e,"c"):void 0,_=this.emissive?this.emissive.flow(e,"c",{slot:"emissive"}):void 0;this.environment&&(l={radiance:this.environment.flow(e,"c",{cache:"radiance",context:s,slot:"radiance"})},e.requires.irradiance&&(l.irradiance=this.environment.flow(e,"c",{cache:"irradiance",context:s,slot:"irradiance"})));var S=n&&l?this.environment.flow(e,"c",{cache:"clearcoat",context:c,slot:"environment"}):void 0,O=this.sheen?this.sheen.flow(e,"c"):void 0;e.requires.transparent=void 0!==v,e.addParsCode(["varying vec3 vViewPosition;","#ifndef FLAT_SHADED","\tvarying vec3 vNormal;","#endif","#include <dithering_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_physical_pars_fragment>","#include <shadowmap_pars_fragment>","#include <logdepthbuf_pars_fragment>"].join("\n"));i=["#include <clipping_planes_fragment>","\t#include <normal_fragment_begin>","\t#include <clearcoat_normal_fragment_begin>","\tPhysicalMaterial material;","\tmaterial.diffuseColor = vec3( 1.0 );"];h&&i.push(h.code,"if ( ! "+h.result+" ) discard;"),i.push(d.code,"\tvec3 diffuseColor = "+d.result+";","\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );","#include <logdepthbuf_fragment>",p.code,"\tfloat roughnessFactor = "+p.result+";",f.code,"\tfloat metalnessFactor = "+f.result+";"),v&&i.push(v.code,"#ifdef ALPHATEST","\tif ( "+v.result+" <= ALPHATEST ) discard;","#endif"),m&&i.push(m.code,"normal = "+m.result+";"),g&&i.push(g.code,"clearcoatNormal = "+g.result+";"),i.push("vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );"),i.push("material.diffuseColor = "+(b?"vec3( 1.0 )":"diffuseColor * ( 1.0 - metalnessFactor )")+";","material.specularRoughness = max( roughnessFactor, 0.0525 );","material.specularRoughness += geometryRoughness;","material.specularRoughness = min( material.specularRoughness, 1.0 );","material.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );"),y?i.push(y.code,"material.clearcoat = saturate( "+y.result+" );"):n&&i.push("material.clearcoat = 0.0;"),a?i.push(a.code,"material.clearcoatRoughness = max( "+a.result+", 0.0525 );","material.clearcoatRoughness += geometryRoughness;","material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );"):n&&i.push("material.clearcoatRoughness = 0.0;"),O&&i.push("material.sheenColor = "+O.result+";"),x?i.push(x.code,"material.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( "+x.result+" ) ), diffuseColor, metalnessFactor );"):i.push("material.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor, metalnessFactor );"),i.push("#include <lights_fragment_begin>"),b&&(i.push(b.code,"reflectedLight.directDiffuse = "+b.result+";"),i.push("diffuseColor *= 1.0 - metalnessFactor;","reflectedLight.directDiffuse *= diffuseColor;","reflectedLight.indirectDiffuse *= diffuseColor;")),w&&i.push(w.code,"reflectedLight.indirectDiffuse *= "+w.result+";","float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );","reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, "+w.result+", material.specularRoughness );"),T&&i.push(T.code,"reflectedLight.indirectDiffuse += "+T.result+";"),E&&i.push(E.code,"reflectedLight.directDiffuse *= "+E.result+";","reflectedLight.directSpecular *= "+E.result+";"),_&&i.push(_.code,"reflectedLight.directDiffuse += "+_.result+";"),l&&(i.push(l.radiance.code),e.requires.irradiance&&i.push(l.irradiance.code),S&&i.push(S.code,"clearcoatRadiance += "+S.result+";"),i.push("radiance += "+l.radiance.result+";"),e.requires.irradiance&&i.push("iblIrradiance += PI * "+l.irradiance.result+";")),i.push("#include <lights_fragment_end>"),i.push("vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular;"),v?i.push("gl_FragColor = vec4( outgoingLight, "+v.result+" );"):i.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),i.push("#include <tonemapping_fragment>","#include <encodings_fragment>","#include <fog_fragment>","#include <premultiplied_alpha_fragment>","#include <dithering_fragment>"),t=i.join("\n")}return t},Dt.prototype.copy=function(e){return q.prototype.copy.call(this,e),e.position&&(this.position=e.position),this.color=e.color,this.roughness=e.roughness,this.metalness=e.metalness,e.mask&&(this.mask=e.mask),e.alpha&&(this.alpha=e.alpha),e.normal&&(this.normal=e.normal),e.clearcoat&&(this.clearcoat=e.clearcoat),e.clearcoatRoughness&&(this.clearcoatRoughness=e.clearcoatRoughness),e.clearcoatNormal&&(this.clearcoatNormal=e.clearcoatNormal),e.reflectivity&&(this.reflectivity=e.reflectivity),e.light&&(this.light=e.light),e.shadow&&(this.shadow=e.shadow),e.ao&&(this.ao=e.ao),e.emissive&&(this.emissive=e.emissive),e.ambient&&(this.ambient=e.ambient),e.environment&&(this.environment=e.environment),e.sheen&&(this.sheen=e.sheen),this},Dt.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||(t=this.createJSONNode(e),this.position&&(t.position=this.position.toJSON(e).uuid),t.color=this.color.toJSON(e).uuid,t.roughness=this.roughness.toJSON(e).uuid,t.metalness=this.metalness.toJSON(e).uuid,this.mask&&(t.mask=this.mask.toJSON(e).uuid),this.alpha&&(t.alpha=this.alpha.toJSON(e).uuid),this.normal&&(t.normal=this.normal.toJSON(e).uuid),this.clearcoat&&(t.clearcoat=this.clearcoat.toJSON(e).uuid),this.clearcoatRoughness&&(t.clearcoatRoughness=this.clearcoatRoughness.toJSON(e).uuid),this.clearcoatNormal&&(t.clearcoatNormal=this.clearcoatNormal.toJSON(e).uuid),this.reflectivity&&(t.reflectivity=this.reflectivity.toJSON(e).uuid),this.light&&(t.light=this.light.toJSON(e).uuid),this.shadow&&(t.shadow=this.shadow.toJSON(e).uuid),this.ao&&(t.ao=this.ao.toJSON(e).uuid),this.emissive&&(t.emissive=this.emissive.toJSON(e).uuid),this.ambient&&(t.ambient=this.ambient.toJSON(e).uuid),this.environment&&(t.environment=this.environment.toJSON(e).uuid),this.sheen&&(t.sheen=this.sheen.toJSON(e).uuid)),t},Pt.prototype=Object.create(Dt.prototype),Pt.prototype.constructor=Pt,Pt.prototype.nodeType="MeshStandard",Pt.prototype.build=function(e){var t=this.properties,n=this.inputs;if(e.isShader("fragment")){var r=e.findNode(t.color,n.color),i=e.resolve(t.map);this.color=i?new Ae(r,i,Ae.MUL):r;var o=e.findNode(t.roughness,n.roughness),a=e.resolve(t.roughnessMap);this.roughness=a?new Ae(o,new xt(a,"g"),Ae.MUL):o;var s=e.findNode(t.metalness,n.metalness),u=e.resolve(t.metalnessMap);this.metalness=u?new Ae(s,new xt(u,"b"),Ae.MUL):s,t.normalMap?(this.normal=new pt(e.resolve(t.normalMap)),this.normal.scale=e.findNode(t.normalScale,n.normalScale)):this.normal=void 0,this.environment=e.resolve(t.envMap)}return Dt.prototype.build.call(this,e)},Pt.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||(t=this.createJSONNode(e),console.warn(".toJSON not implemented in",this)),t},Lt.prototype=Object.create(et.prototype),Lt.prototype.constructor=Lt,Te.addShortcuts(Lt.prototype,"fragment",["color","alpha","mask","position","spherical"]),kt.prototype=Object.create(et.prototype),kt.prototype.constructor=kt,Te.addShortcuts(kt.prototype,"fragment",["color","alpha","specular","shininess","normal","emissive","ambient","light","shadow","ao","environment","environmentAlpha","mask","position"]),It.prototype=Object.create(et.prototype),It.prototype.constructor=It,Te.addShortcuts(It.prototype,"fragment",["color","alpha","roughness","metalness","reflectivity","clearcoat","clearcoatRoughness","clearcoatNormal","normal","emissive","ambient","light","shadow","ao","environment","mask","position","sheen"]),At.prototype=Object.create(et.prototype),At.prototype.constructor=At,Te.addShortcuts(At.prototype,"properties",["color","roughness","metalness","map","normalMap","normalScale","metalnessMap","roughnessMap","envMap"]),jt.prototype={constructor:jt,render:function(e,t,n){this.needsUpdate&&(this.material.dispose(),this.material.fragment.value=this.output,this.material.build(),this.material.uniforms.renderTexture&&(this.material.uniforms.renderTexture.value=this.renderTarget.texture),this.needsUpdate=!1),n.setRenderer(this.renderer).setRenderTexture(this.renderTarget.texture),this.renderer.setRenderTarget(this.renderTarget),this.renderer.render(e,t),n.updateNode(this.material),this.renderer.setRenderTarget(null),this.renderer.render(this.scene,this.camera)},setPixelRatio:function(e){this.renderer.setPixelRatio(e);var t=this.renderer.getSize(new THREE.Vector2);this.setSize(t.width,t.height)},setSize:function(e,t){var n=this.renderer.getPixelRatio();this.renderTarget.setSize(e*n,t*n),this.renderer.setSize(e,t)},copy:function(e){return this.output=e.output,this},toJSON:function(e){if((void 0===e||"string"==typeof e)&&(e={nodes:{}}),e&&!e.post&&(e.post={}),!e.post[this.uuid]){var t={};t.uuid=this.uuid,t.type="NodePostProcessing",e.post[this.uuid]=t,""!==this.name&&(t.name=this.name),"{}"!==JSON.stringify(this.userData)&&(t.userData=this.userData),t.output=this.output.toJSON(e).uuid}return e.post=this.uuid,e}};var Ht=new WeakMap,Ft=new WeakMap,zt=function(){function e(){a()(this,e),Ht.set(this,{writable:!0,value:new I.Listener}),Ft.set(this,{writable:!0,value:null}),this.id="",this.config=null,this.eventArr=[],this.threshold=1,this.isRayRecur=!0,this.isCtrUpdate=!0,this.isHindrance=!1,this._postfix="compEft_",this._TWEEN=I.TWEEN,this.tweenTims=800,this._setting={checkList:{},callback:{}}}return u()(e,[{key:"bind",value:function(e,t){return l()(this,Ht).bind(e,t)}},{key:"unbind",value:function(e,t){return l()(this,Ht).unbind(e,t)}},{key:"_triggerOutEvent",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return(t=l()(this,Ht)).trigger.apply(t,[e,this].concat(r))}},{key:"_handleEventFn",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i=this[e].apply(this,n);I.isArray(i)&&this._triggerOutEvent.apply(this,[e].concat(S()(i)))}},{key:"disposeBase",value:function(){I._disposeDiff(),I.disposeObj(this.scene),l()(this,Ht)&&l()(this,Ht).destroy(),this.eventArr.splice(0,this.eventArr.length),this._TWEEN=null,G()(this,Ft,null),G()(this,Ht,null),this.config=null,this.scene=null,this.group=null,this.camera=null,this.controls=null,this.directLight=null}},{key:"setCameraParams",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.target;this.camera&&e.position&&(e.fov&&(this.camera.fov=e.fov),this.camera.position.copy(e.position),t&&this.camera.lookAt(t.x,t.y,t.z),this.camera.userData.target=t,this.camera.updateProjectionMatrix()),this.controls&&t&&(this.controls.target.copy(t),this.controls.update())}},{key:"getCameraParams",value:function(){return{fov:this.camera?this.camera.fov:null,position:this.camera?this.camera.position.clone():null,target:this.controls?this.controls.target.clone():null}}},{key:"setControls",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e&&(t.target&&e.target.copy(t.target),I.setObjParams(e,t.params),e.update(),e.enabled=this.GId?this.config.isViewport:this.isViewport)}},{key:"restoreCamra",value:function(e){var t=[e.controls.target,e.camera.position,e.config],n=t[0],r=t[1],i=t[2],o=[i.controls.target,i.camera.position],a=o[0],s=o[1];n.equals(a)||this.setTestTween(n,a),r.equals(a)||this.setTestTween(r,s)}},{key:"setTestTween",value:function(e,t,n){var r=this;new this._TWEEN.Tween(e).to(t,this.tweenTims).easing(this._TWEEN.Easing.Quadratic.InOut).start().onComplete((function(){I.exeFunction(n,r)}))}},{key:"setOption",value:function(e,t){this.beforeOption(e),t?this.compEftInit&&this.compEftInit():this.contrastedOpt(e,this._setting.checkList,l()(this,Ft)),this.afterOption(e)}},{key:"setConfigProxy",value:function(e){this.handleSetting(e.checkList,e.callback)}},{key:"handleSetting",value:function(e,t){var n=this,r={};return I.loopObject(e,(function(i){var o=e[i];"object"===d()(o)?r[i]=n.handleSetting(o,t):Object.prototype.hasOwnProperty.call(t,o)&&(r[i]=t[o])})),r}},{key:"contrastedOpt",value:function(e,t,n){var r=this;n&&I.loopObject(e,(function(i){var o=[e[i],t[i]],a=o[0],s=o[1];"object"===d()(s)?r.contrastedOpt(a,s,n[i]):n[i]=a}))}},{key:"typeConfig",value:function(e,t,n,r){var i=[I.extend(!0,{},t),I.extend(!0,{},n)],o=i[0],a=i[1];this.setDefaultConfig(o,a),this.config=I.extend(!0,{},o,e),r||(this.config=I.extend(!0,{},a,this.config)),this.id=this.config.id||I.creatId(this.config.type||this.config.name)}},{key:"setDefaultConfig",value:function(){}},{key:"loadBgTxue",value:function(e){var t=[e.bgPath||"",e.background],n=t[0],r=t[1];if(r){var i=[r.shpereSky,r.cubSky],o=i[0],a=i[1];o&&(this.bgTxue.shpereSky=I.txueLoader.load(n+o),this.bgTxue.shpereSky.isSphereTexture=!0),a&&(this.bgTxue.cubSky=(new THREE.CubeTextureLoader).load([n+a.px,n+a.nx,n+a.py,n+a.ny,n+a.pz,n+a.nz]))}}},{key:"creatCamera",value:function(e,t,n){var r;if(e.isOrth){var i=e.ratio*t*.5,o=e.ratio*n*.5;r=new THREE.OrthographicCamera(-i,i,o,-o,e.near,e.far)}else r=new THREE.PerspectiveCamera(e.fov,t/n,e.near,e.far);return r.position.copy(e.position),r}},{key:"setLight",value:function(e,t){t.Ambient&&e.add(new THREE.AmbientLight(t.Ambient.color,t.Ambient.strength));var n=[t.hemisphere,t.directional],r=n[0],i=n[1];if(t.isHemisphere&&r){var o=new THREE.HemisphereLight(r.color,r.groundColor,r.strength);o.position.set(r.position[0],r.position[2],r.position[1]),e.add(o)}if(t.isDirectional&&i){var a=new THREE.DirectionalLight(i.color,i.strength);if(a.position.set(i.position[0],i.position[2],i.position[1]),a.castShadow=this.config.shadow,this.directLight=a,a.castShadow){var s=i.mapSize||1024;a.shadow.mapSize.width=s,a.shadow.mapSize.height=s;var u=i.boxSize||5e3;a.shadow.camera.left=-u,a.shadow.camera.right=u,a.shadow.camera.top=u,a.shadow.camera.bottom=-u,a.shadow.camera.far=1e4,a.shadow.bias=-1e-4}if(i.lightHelper){var c=new THREE.DirectionalLightHelper(a,10);e.add(c)}e.add(a)}}},{key:"mirrorSubface",value:function(e,t){var n=new Ee,r=new De(this.getTxue(t.norDecal)),i=new De(this.getTxue(t.colDecal)),o=new xt(new De(this.getTxue(t.alpDecal)),"w"),a=new THREE.ReflectorRTT(e.clone(),{clipBias:.003,textureWidth:this.width,textureHeight:this.height}),s=[new Ke(a),new xt(r,"xy")],u=s[0],c=s[2],l=new Ae(void 0===c?new je(s[1],je.INVERT):c,new Ce(.4),Ae.SUB),h=new Ot(u);u.offset=new Ae(l,new Ce(6),Ae.MUL),h.size=new THREE.Vector2(this.width,this.height),h.uv=new ae("projCoord.xyz / projCoord.q","vec3"),h.uv.keywords.projCoord=new Ae(u.offset,u.uv,Ae.ADD),h.radius.x=h.radius.y=t.mirBlur;var d=new kt;return d.color=i,d.environment=h,d.alpha=new Ae(o,new Ce(0),Ae.MUL),d.environmentAlpha=new Ce(t.mirRatio),a.name="mirrorSubface",a._isMirrorSubface=!0,a.add(new THREE.Mesh(e,d)),a.position.y=t.offsetY||0,t.isRoateX&&a.rotateX(.5*-Math.PI),a.userData.amtFun=function(e){n.update(e).updateNode(d)},a.userData.Tween={obj:d.alpha.b,end:{value:t.opacity},time:1e3*t.subfaceLoadTime},a}},{key:"subfaseAmt",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.subface,n=t;if(n&&n.userData.Tween){var r=[n.userData.Tween,this.tweenTims],i=r[0],o=r[1];this.tweenTims=i.time,this.setTestTween(i.obj,i.end,(function(){e.tweenTims=o}))}}},{key:"beforeInit",value:function(){}},{key:"afterInit",value:function(){}},{key:"beforeDispose",value:function(){}},{key:"afterDispose",value:function(){}},{key:"beforeAdd",value:function(){}},{key:"afterAdd",value:function(){}},{key:"beforeRemove",value:function(){}},{key:"afterRemove",value:function(){}},{key:"beforeOption",value:function(){}},{key:"afterOption",value:function(){}},{key:"beforeData",value:function(){}},{key:"afterData",value:function(){}},{key:"beforeHandle",value:function(){}},{key:"afterHandle",value:function(){}},{key:"onError",value:function(){}},{key:"onWheel",value:function(){return[]}},{key:"onKeyup",value:function(){return[]}},{key:"onKeydown",value:function(){return[]}},{key:"onMouseOut",value:function(){return[]}},{key:"onMouseIn",value:function(){return[]}},{key:"onMouseUp",value:function(){return[]}},{key:"onMouseDown",value:function(){return[]}},{key:"onClick",value:function(){return[]}},{key:"onDblClick",value:function(){return[]}}]),e}(),Vt=function(){function e(t){var n=this;a()(this,e);var r=0,i=0;this.GLRender=t,this.isInitEvent=!0,this.dblclickDelay=200,this.eventDom=null,this._ItdMesh=null,this._Mouse=null,this._Raycaster=null,this._Intersects=null,this._CurrentID=null;var o=function(e){n._isIntercept()||n.setEvent(e,"onWheel")},s=function(e){n._isIntercept()||n.setEvent(e,"onKeyup")},u=function(e){n._isIntercept()||n.setEvent(e,"onKeydown")},c=function(e){e.preventDefault(),n._isIntercept(e,"onMouseUp")||(clearTimeout(i),i=setTimeout((function(){n.setEvent(e,"onMouseUp"),n.setEvent(e,"onClick")}),n.dblclickDelay))},l=function(e){n._isIntercept()||n.setMouseOut(e,!0)},h=function(e){if(e.preventDefault(),!n._isIntercept(e,"onMouseIn"))if(n.getIntersects(e),n._Intersects&&n._Intersects.length){var t=n._Intersects[0].object;t!==n._ItdMesh&&n.setMouseOut(e,!1),n.setMouseIn(e,t)}else n.setMouseOut(e,!0)},d=function(e){e.preventDefault(),n._isIntercept(e,"onMouseDown")||(clearTimeout(r),r=setTimeout((function(){n.getIntersects(e),n.setEvent(e,"onMouseDown")}),n.dblclickDelay))},p=function(e){e.preventDefault(),n._isIntercept()||(clearTimeout(r),clearTimeout(i),n.getIntersects(e),n.setEvent(e,"onDblClick"),n.setEvent(e,"onMouseUp"))};this.handleEvent=function(e,t){e&&(e["".concat(t,"EventListener")]("wheel",o,!1),document["".concat(t,"EventListener")]("keyup",s,!1),document["".concat(t,"EventListener")]("keydown",u,!1),e["".concat(t,"EventListener")]("mouseup",c,!1),e["".concat(t,"EventListener")]("mouseout",l,!1),e["".concat(t,"EventListener")]("mousemove",h,!1),e["".concat(t,"EventListener")]("mousedown",d,!1),e["".concat(t,"EventListener")]("dblclick",p,!1),clearTimeout(r))}}return u()(e,[{key:"init",value:function(e){this.isInitEvent=e,e&&(this._Mouse=new THREE.Vector2,this._Mouse2=new THREE.Vector2,this._Raycaster=new THREE.Raycaster,this.eventDom=this.GLRender.container,this.handleEvent(this.eventDom,"add"))}},{key:"dispose",value:function(e){this._ItdMesh=null,e||(this._Mouse=null,this._Raycaster=null,this._Intersects=null,this._CurrentID=null,this.handleEvent(this.eventDom,"remove"),this.eventDom=null,this.GLRender=null)}},{key:"setMouseOut",value:function(e,t){var n=this.handleInOut(!1,t);this._ItdMesh&&(this.handoutEvent(e,"onMouseOut",n,t),this._ItdMesh=null)}},{key:"setMouseIn",value:function(e,t){this._ItdMesh=t;var n=this.handleInOut(!0);this.handoutEvent(e,"onMouseIn",n)}},{key:"handleInOut",value:function(e,t){var n=this._ItdMesh?this._ItdMesh.userData.ceId:this._CurrentID,r=this.GLRender.subCompEffects[n];return r?(e?this.eventDom.style.cursor="pointer":t&&(this.eventDom.style.cursor="auto"),r):null}},{key:"setEvent",value:function(e,t){var n=this.GLRender.subCompEffects[this._CurrentID];this.handoutEvent(e,t,n)}},{key:"handoutEvent",value:function(e,t,n,r){this.GLRender._handleEventFn(t,e,this._Intersects,n,r),!n||n.stopEvents||this.GLRender.isSelectionBox||I.exeFunction(n._handleEventFn,n,t,e,this._Intersects,r)}},{key:"getIntersects",value:function(e){this._Intersects=this.getIntersectMeshs(e);for(var t=!1,n=0;n<this._Intersects.length;n++)void 0!==this._Intersects[n].object._isSprite&&(t=!0,n=this._Intersects.lengthl);t&&(this._Intersects=this._Intersects.filter((function(e){return void 0!==e.object._isSprite})));for(var r=this._Intersects.length-1;r>=0;r--)this._Intersects[r].object._unEvent&&this._Intersects.splice(r,1);!this.GLRender.isSciType&&this._Intersects.length&&(this._CurrentID=this._Intersects[0].object.userData.ceId)}},{key:"getIntersectMeshs",value:function(e,t){var n=[this.GLRender,void 0!==e.offsetX?"offset":"layer"],r=n[0],i=n[1];return this._Mouse2.set(e["".concat(i,"X")],e["".concat(i,"Y")]),this._Mouse.x=e["".concat(i,"X")]/r.width*2-1,this._Mouse.y=-e["".concat(i,"Y")]/r.height*2+1,r.threshold&&(this._Raycaster.params.Points.threshold=r.threshold),this._Raycaster.setFromCamera(this._Mouse,r.camera),this._Raycaster.intersectObjects(t||r.eventArr,r.isRayRecur)}},{key:"_getTopComponent",value:function(e){this._CurrentID=null;var t=[e.target.id,this.GLRender._postfix.length],n=t[0],r=t[1];if(n.slice(0,r)!==this.GLRender._postfix)return null;this._CurrentID=n.slice(r);var i=this.GLRender.subCompEffects[this._CurrentID];return i&&i._base&&i._base.animatFactory&&i._base.animatFactory.onMouseHover&&i._base.animatFactory.onMouseHover(),i}},{key:"_isIntercept",value:function(e,t){if(this.GLRender.isSelectionBox)return e&&t&&this.setEvent(e,t),!0;var n=this.GLRender.config,r=n.isShow,i=n.isViewport;return!(r&&i)}}]),e}(),Bt={camera:{fov:45,near:.1,far:1e4,position:{x:-140,y:171,z:295},ratio:1,isOrth:!1},controls:{target:{x:150,y:32,z:-379},params:{enablePan:!0,enableZoom:!0,enableRotate:!0,enableDamping:!0,dampingFactor:.08,panSpeed:.5,zoomSpeed:.1,rotateSpeed:.08,minDistance:2,maxDistance:2096,minPolarAngle:-1/0,maxPolarAngle:1/0,minAzimuthAngle:-1/0,maxAzimuthAngle:1/0}},light:{isHemisphere:!0,isDirectional:!0,Ambient:{color:"#FFFFFF",strength:1},hemisphere:{color:"#FBFEFF",groundColor:"#FFFEFB",strength:.5,position:[0,0,128]},directional:{color:"#FFFFFF",strength:.8,position:[5,7,10],mapSize:1024,boxSize:4096,lightHelper:!1}},composer:{isAntialias:!1,isOutline:!1,outlineColor:"#BF4E00",outlineStrength:2,outlineGlow:1}},Jt={cts:"",id:"",shadow:!0,isShow:!0,isViewport:!0,background:{color:"#ffffff",opacity:0}},Ut={type:"",id:"",isMercator:!1,dataTans:"plane",basic:{longLat:{vScale:4e4,center:[104.08195,30.64615]},plane:{vScale:1,center:[0,0]}},gridHelper:!1,renderOrder:1};function Gt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=J()(e);if(t){var i=J()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return V()(this,n)}}var qt={SubfaceVShader:["\n        attribute vec2 uv2;\n        varying vec4 vUv;\n        void main() {\n            vUv = vec4(uv2, uv);\n            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n        }"].join("\n"),SubfaceFShader:["\n        uniform float u_time;\n        uniform sampler2D u_txue;\n        uniform sampler2D u_txue_bk;\n\n        varying vec4 vUv;\n        void main() {\n            vec4 txue = texture2D(u_txue, vUv.xy);\n            vec4 txue_bk = texture2D(u_txue_bk, vUv.zw);\n            gl_FragColor = txue * txue_bk * vec4(vec3(1.0), u_time);\n        }"].join("\n")},Wt=function(e){F()(n,e);var t=Gt(n);function n(){var e;return a()(this,n),(e=t.call(this)).name="",e.isEditor=!1,e.isDfEvent=!0,e.GId="",e.width=0,e.height=0,e.frameLimit=.1,e.devicePixelRatio=1,e.clock=null,e.renderer=null,e.container=null,e.composer=null,e.isComposer=!1,e.subAnimateArr=[],e.subCompEffects={},e.subCompEffectArr=[],e.subEventEffects=[],e.isInit=!1,e._Events=new Vt(j()(e)),e.isShift=!1,e.isCtrl=!1,e.isDown=!1,e.isStart=!1,e.allSelected=null,e.isSelectionBox=!1,e}return u()(n,[{key:"init",value:function(e){if(this.parentCont=this.parseCts(e.cts),window._isSupportWebGL&&null!==this.parentCont)try{this.beforeInit(e),this.typeConfig(e,Jt,Bt),this.GId=I.creatId(this.parentCont.id),this.container=this.creatContainer(this.GId),this.parentCont.innerHTML="",this.parentCont.appendChild(this.container),this.initiate(),this.isInit=!0,this.renderers(),this.afterInit(this.config)}catch(e){this.onError({errorType:1,describe:"Initialization Error!"})}else this.onError({errorType:2,describe:"Not Support WebGL!"})}},{key:"addCompEft",value:function(e){this.beforeAdd(e),I.exeFunction(e.install,e,this),this.subCompEffects[e.id]=e,this.subCompEffectArr.push(e),this.updateEventArr(e),e.isHindrance&&this.subEventEffects.push(e.id),e.group.name+=e.id,this.scene.add(e.group),this.onAnimate(e.animate),this.afterAdd(e)}},{key:"removeCompEft",value:function(e,t){this.beforeRemove(e),this._Events.dispose(!0),delete this.subCompEffects[e.id],I.removeArrItem(this.subCompEffectArr,e),this.removeEventArr(e.id),this.subEventEffects=this.subEventEffects.filter((function(t){return t!==e.id})),this.scene.remove(e.group),this.unAnimate(e.animate),t&&e.dispose(),this.afterRemove()}},{key:"removeAll",value:function(e){var t=this;I.loopObject(this.subCompEffects,(function(n){t.removeCompEft(t.subCompEffects[n],e)}))}},{key:"updateEventArr",value:function(e){var t=[e.id,e.eventArr],n=t[0],r=t[1];this.removeEventArr(n);for(var i=0;i<r.length;i++)r[i].traverse((function(e){e.userData.ceId=n})),this.eventArr.push(r[i])}},{key:"removeEventArr",value:function(e){for(var t=this.eventArr.length-1;t>=0;t--)this.eventArr[t].userData.ceId===e&&this.eventArr.splice(t,1)}},{key:"dispose",value:function(){this.isInit&&this.testing()&&(this.beforeDispose(this),this.isInit=!1)}},{key:"setRenderSize",value:function(e,t){var n=this.getWH(e,t),r=n.nw,i=n.nh;n.rs&&(this.isInit&&(this.renderer.setSize(r,i),this.composer&&this.composer.setSize(r,i)),this.camera&&(this.camera.aspect=r/i,this.camera.updateProjectionMatrix()))}},{key:"onAnimate",value:function(e){I.isFunction(e)&&this.subAnimateArr.push(e)}},{key:"unAnimate",value:function(e){I.removeArrItem(this.subAnimateArr,e)}},{key:"setDefaultConfig",value:function(e){I.copy(e,{isEditor:!1,isDfEvent:!0,subface:{isCreat:!1,offset:[100,100],colDecal:null,alpDecal:null,offsetY:0,opacity:1,isRoateX:!0,subfaceLoadTime:1,txueRpt:[1,1],isMirror:!1,norDecal:null,mirBlur:2.6,mirRatio:.85}})}},{key:"initiate",value:function(){this.getWH(),this.clock=new THREE.Clock,this._Events.init(this.config.isViewport);var e=[this.config.background],t=e[0],n=e[1],r=void 0===n?I.getColorArr(t.color):n;this.renderer=new THREE.WebGLRenderer({antialias:!0,alpha:!0}),this.renderer.shadowMap.enabled=this.config.shadow,this.renderer.setPixelRatio(this.devicePixelRatio),this.renderer.setClearColor(r[0],t.opacity),this.renderer.setSize(this.width,this.height),this.container.appendChild(this.renderer.domElement),this.scene=new THREE.Scene,this.camera=this.creatCamera(this.config.camera,this.width,this.height),this.controls=new THREE.OrbitControls(this.camera,this.container),this.setControls(this.controls,this.config.controls),this.camera.userData.target=this.controls.target.clone(),this.setLight(this.scene,this.config.light),this._effectComposer(),this.setConfigProxy(this._setting),this.isEditor=this.config.isEditor,this.isDfEvent=this.config.isDfEvent,this.subface=this.creatSubface(this.config.subface),this.subface&&this.scene.add(this.subface),this.addWatermark(this.scene)}},{key:"addWatermark",value:function(e){var t=new THREE.PlaneGeometry(2,2),n=new THREE.ShaderMaterial({uniforms:{map:{value:(new THREE.TextureLoader).load("texture/shuiyin.png")},iResolution:{value:new THREE.Vector2(window.innerWidth,window.innerHeight)},iSize:{value:new THREE.Vector2(300,300)}},transparent:!0,depthWrite:!1,vertexShader:"\n            varying vec3 vPosition;\n            varying vec2 vUv;\n            void main() { \n                vUv = uv; \n                vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n                gl_Position = vec4(position, 1.0);\n            }",fragmentShader:"\n            varying vec2 vUv;\n            uniform vec2 iResolution;\n            uniform vec2 iSize;\n            uniform sampler2D map;\n            void main() {\n                float x = mod(gl_FragCoord.x, iSize.x);\n                float y = mod(gl_FragCoord.y, iSize.y);\n                vec2 uv = vec2(x / iSize.x, y / iSize.y); \n                vec4 col = texture2D(map, uv);\n                if (col.r >= 0.01) {\n                    col.a *= 1.4;\n                    gl_FragColor = col;\n                } else {\n                    discard;\n                }\n            }\n            "});this.mark=new THREE.Mesh(t,n),this.mark.renderOrder=1e3,e.add(this.mark)}},{key:"switchCtr",value:function(e){this.controls.enabled=e}},{key:"onKeyup",value:function(e){"Shift"===e.key&&(this.isShift=!1),"Control"===e.key&&(this.isCtrl=!1)}},{key:"onKeydown",value:function(e){"Shift"===e.key&&(this.isShift=!0),"Control"===e.key&&(this.isCtrl=!0)}},{key:"onMouseIn",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return[e].concat(n)}},{key:"onMouseUp",value:function(e){this.isDown=!1;for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return[e].concat(n)}},{key:"onMouseDown",value:function(e){var t=this;this.subEventEffects.forEach((function(n){var r=t.subCompEffects[n];r.onMouseDown&&r.onMouseDown(e)}));for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return this.isCtrl?(this.isDown=!0,[e].concat(r)):[e].concat(r)}},{key:"onDblClick",value:function(e,t,n){return!this.isDfEvent||n&&"BaseMap"===n.type||this.restoreCamra(this),[e]}},{key:"animation",value:function(e){for(var t=0;t<this.subAnimateArr.length;t++)this.subAnimateArr[t](e,this.clock);this.mark&&this.mark.position.copy(this.controls.target)}},{key:"renderers",value:function(){var e=this,t=0;!function n(){if(e.isInit){t=window.requestAnimationFrame(n);var r=e.clock.getDelta();if(r>e.frameLimit)return;e.animation(r),e._TWEEN&&e._TWEEN.update(),e.config.isShow&&(e.isCtrUpdate&&e.controls.enableDamping&&e.controls.update(),e.composer?e.composer.render():e.renderer.render(e.scene,e.camera))}else window.cancelAnimationFrame(t),e._disposeRender()}()}},{key:"_disposeRender",value:function(){this._TWEEN.removeAll(),this.renderer.dispose(),this.renderer.forceContextLoss(),this.renderer.domElement=null,this.composer&&(this.outlinePass=null,I.disposeArr(this.composer.passes),I.disposeArr(this.composer)),I.disposeArr(this.subCompEffects),this._Events.dispose(),this.container.remove(),this._disposeValue(),this.afterDispose()}},{key:"_disposeValue",value:function(){this.clock=null,this.renderer=null,this.subAnimateArr.splice(0,this.subAnimateArr.length),this.subCompEffectArr.splice(0,this.subCompEffectArr.length),this._Events=null,this.container=null,this.parentCont=null,this.disposeBase()}},{key:"testing",value:function(){return this.renderer instanceof THREE.WebGLRenderer}},{key:"getWH",value:function(e,t){var n=[I.toNum(e,this.container.offsetWidth),I.toNum(t,this.container.offsetHeight)],r=n[0],i=n[1],o=n[2],a=void 0===o?!(this.width===r&&this.height===i):o;return this.width=r,this.height=i,{nw:r,nh:i,rs:a}}},{key:"parseCts",value:function(e){if("object"!==d()(e))return document.getElementById(e);var t=I.isDomElement(e)?e:e[0];return t=I.isDomElement(t)?t:null}},{key:"creatContainer",value:function(e){var t=[document.createElement("div"),"width: 100%; height: 100%; overflow: hidden; position: relative !important;"],n=t[0],r=t[1];return n.id=e,n.style=r,n}},{key:"_effectComposer",value:function(){var e=this.config.composer;if(this.isComposer=e.isOutline,this.isComposer){var t=new THREE.RenderPass(this.scene,this.camera);this.composer=new THREE.EffectComposer(this.renderer),this.composer.setSize(this.width,this.height),this.composer.addPass(t);var n=new THREE.OutlinePass(new THREE.Vector2(this.width,this.height),this.scene,this.camera);if(n.visibleEdgeColor.set(e.outlineColor),n.edgeStrength=e.outlineStrength,n.edgeGlow=e.outlineGlow,this.outlinePass=n,this.composer.addPass(n),e.isAntialias){var r=new THREE.ShaderPass(THREE.FXAAShader);r.uniforms.resolution.value.set(1/this.width,1/this.height),this.composer.addPass(r)}}}},{key:"getImage",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:288,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:185;this.renderer.render(this.scene,this.camera);var r=I.canvasToImg(this.renderer.domElement,t,n,e);return r}},{key:"getTxue",value:function(e){return this.Txues?this.Txues.getTxue(e):null}},{key:"creatSubface",value:function(e){if(!e.isCreat)return null;var t=this.subfaceGeo(I.wh,e),n=e.isMirror?this.mirrorSubface(t,e):this.commonSubface(t,e);return this.onAnimate(n.userData.amtFun),n}},{key:"subfaceGeo",value:function(e,t){var n=.5*-e,r=.5*e,i=t.offset,o=t.txueRpt,a=n-i[0],s=r+i[0],u=n-i[1],c=r+i[1],l=isNaN(o[0])?1:o[0],h=isNaN(o[1])?1:o[1],d=[I.geo.buf(),[0,2,1,2,3,1],[0,1,1,1,0,0,1,0],[0,h,l,h,0,0,l,0],[0,0,1,0,0,1,0,0,1,0,0,1],[a,c,0,s,c,0,a,u,0,s,u,0]],p=d[0],f=d[1],v=d[2],m=d[3],y=d[4],g=d[5];return p.setIndex(f),p.setAttribute("uv",new THREE.Float32BufferAttribute(v,2)),p.setAttribute("uv2",new THREE.Float32BufferAttribute(m,2)),p.setAttribute("position",new THREE.Float32BufferAttribute(g,3)),t.isMirror&&p.setAttribute("normal",new THREE.Float32BufferAttribute(y,3)),p}},{key:"commonSubface",value:function(e,t){var n=new THREE.Mesh(e,I.mtl.shader({uniforms:{u_time:{value:0},u_txue:{value:this.getTxue(t.colDecal)},u_txue_bk:{value:this.getTxue(t.alpDecal)}},transparent:!0,polygonOffset:!0,polygonOffsetUnits:3,polygonOffsetFactor:.6,vertexShader:qt.SubfaceVShader,fragmentShader:qt.SubfaceFShader}));return n.renderOrder=0,n.name="commonSubface",n._isCommonSubface=!0,n.rotateX(.5*-Math.PI),n.position.y=t.offsetY||0,n.userData.amtFun=null,n.userData.Tween={obj:n.material.uniforms.u_time,end:{value:t.opacity},time:1e3*t.subfaceLoadTime},n}}]),n}(zt),Xt=function(){function e(){a()(this,e),this.Txues={},this.txueArr=[]}return u()(e,[{key:"init",value:function(e){var t=this;I.disposeArr(this.Txues),e.forEach((function(e){t.loadTexture(e)}))}},{key:"getTxue",value:function(e){if(!e)return null;var t=this.Txues[e]?this.Txues[e]:null;return t&&t._use++,t}},{key:"removeTxue",value:function(e){var t=this.Txues[e]?this.Txues[e]:null;t&&t._use--,t&&t._use<=0&&(t.dispose(),delete this.Txues[e])}},{key:"setTxue",value:function(e){return this.loadTexture(e),this.Txues["".concat(e.id)]}},{key:"dispose",value:function(){I.disposeArr(this.Txues),this.Txues=null}},{key:"loadTexture",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(e.isUpdate||void 0===this.Txues["".concat(e.id)]){this.txueArr.push(e);var t=/\.(png|jpe?g)(\?.*)?$/.test(e.url),n=t?I.txueLoader.load(e.url):null;n&&e.isRepeat&&(n.wrapS=THREE.RepeatWrapping,n.wrapT=THREE.RepeatWrapping),n&&e.repeat&&(n.repeat=new THREE.Vector2(e.repeat.x,e.repeat.y)),n&&(n._use=1),this.Txues["".concat(e.id)]=n}}},{key:"loadHdr",value:function(e,t){var n=this;return new Promise((function(r,i){try{var o=new THREE.PMREMGenerator(t);o.compileEquirectangularShader(),n.rgbeLoader=new THREE.RGBELoader,n.rgbeLoader.setDataType(THREE.UnsignedByteType).load(e,(function(e){var t=o.fromEquirectangular(e).texture;r(t),e.dispose(),o.dispose(),o=null}))}catch(e){i(e)}}))}},{key:"loadCubeSky",value:function(e){var t=new THREE.CubeTextureLoader;return new Promise((function(n,r){try{var i=t.load(e);i.encoding=THREE.sRGBEncoding,n(i)}catch(e){r(e)}}))}}]),e}();function Yt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=J()(e);if(t){var i=J()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return V()(this,n)}}var Zt=function(e){F()(n,e);var t=Yt(n);function n(){var e;return a()(this,n),(e=t.call(this)).isShow=!0,e.isAnimate=!0,e.stopEvents=!1,e.inAmtOpts=null,e.isViewport=!0,e}return u()(n,[{key:"init",value:function(e){this.beforeInit(e),this.typeConfig(e,Ut,Bt,!0),this.typeInitiate(),this.afterInit(this.config)}},{key:"setData",value:function(){}},{key:"show",value:function(){this.isShow=!0}},{key:"hide",value:function(){this.isShow=!1}},{key:"animate",value:function(){}},{key:"dispose",value:function(){this.beforeDispose(this),this.inAmtOpts=null,this.renderers=null,I.disposeObj(this.group),this.controlDom&&(this.controlDom.remove(),this.controlDom=null),this.disposeCompEft(),this.disposeBase(),this.afterDispose()}},{key:"disposeCompEft",value:function(){}},{key:"typeInitiate",value:function(){this.config.gridHelper&&(this.GridHelper=new THREE.GridHelper(400,16,1333901,4802889)),this.group=new THREE.Group,this.GridHelper&&this.group.add(this.GridHelper),this.setConfigProxy(this._setting),this.compEftInit()}},{key:"setGridHelper",value:function(e){this.GridHelper&&(this.GridHelper.visible=!!e)}},{key:"compEftInit",value:function(){}},{key:"ajaxQuer",value:function(e,t){if(e){var n=new XMLHttpRequest;n.open("GET",e,!0),n.onreadystatechange=function(){(4===n.readyState&&200===n.status||304===n.status)&&t.call(this,n.responseText)},n.send()}}},{key:"getPathInfo",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=[I.geoEtds],o=i[0],a=i[1],s=void 0===a?o.flatten(e):a;return t&&(s.indices=o.triangulate(s.vertices,s.holes)),n&&(s.beveling=o.offsetPolygon2(s.vertices,s.holes,r)),s}},{key:"sideIndices",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,i=n+t*r;e.push(i+r,i,i+1,i+1,i+r+1,i+r)}},{key:"handleVec3",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.config,n=[t.isMercator,t.dataTans,t.basic],r=n[0],i=n[1],o=n[2],a=n[3],s=void 0===a?o[i].vScale:a,u=n[4],c=void 0===u?o[i].center:u;if(r&&"longLat"===i){var l=I.getMercator(),h=l.mx,d=l.my;e[0]=h,e[1]=d}var p=(e[0]-c[0])*s,f=(e[1]-c[1])*s,v=(e[2]-(c[2]||0))*s;return{vx:p,vy:f,vz:v}}},{key:"pushColor",value:function(e){for(var t=0,n=arguments.length<=1?0:arguments.length-1;t<n;t++){var r=t+1<1||arguments.length<=t+1?void 0:arguments[t+1];e.push(r[0].r,r[0].g,r[0].b,r[1])}return e}},{key:"handleColor",value:function(e){var t=[];return e.forEach((function(e){if(I.isArray(e)){var n=[];e.forEach((function(e){n.push(I.getColorArr(e))})),t.push(n)}else t.push(I.getColorArr(e))})),t}},{key:"nodeAmtFunc",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"_transTimes",i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"_perTimes",o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"uTime";t[r]+=e,t.material.uniforms[o].value=t[r]/t[i],t[r]<t[i]||(t[r]-=t[i],I.exeFunction(n,this))}}]),n}(zt),Kt={createChassis:function(e){var t=e.radius,n=void 0===t?100:t,r=e.position,i=void 0===r?new THREE.Vector3:r,o=e.gradient,a=void 0===o?["rgba(0,0,0,1)","rgba(0,0,0,0.8)"]:o,s=new THREE.CircleBufferGeometry(n,32),u=new THREE.MeshPhysicalMaterial({color:16777215,side:THREE.DoubleSide,transparent:!0});u.onBeforeCompile=function(e){var t=I.getColorArr(a[0]),r=I.getColorArr(a[1]);e.uniforms.uColor1={value:t[0]},e.uniforms.uColor2={value:r[0]},e.uniforms.uOpacity1={value:t[1]},e.uniforms.uOpacity2={value:r[1]},e.uniforms.uRadius={value:n};e.fragmentShader=e.fragmentShader.replace("void main() {","\nuniform vec3 uColor1;\nuniform vec3 uColor2;\nuniform float uRadius;\nuniform float uOpacity1;\nuniform float uOpacity2;\nvarying vec3 vPosition;\n\nvoid main() {\n    float _i = 1.0 - distance(vec2(.0, .0), vec2(vPosition.x, vPosition.y)) / uRadius;\n\n    float baseOpacity = uOpacity1;\n    if (_i <= 0.4) {\n        baseOpacity = mix(uOpacity2, uOpacity1, _i * 2.5);\n    }\n    vec3 baseColor = mix(uColor2, uColor1, _i);\n    "),e.fragmentShader=e.fragmentShader.replace("gl_FragColor = vec4( outgoingLight, diffuseColor.a );","gl_FragColor = vec4(baseColor, baseOpacity );");e.vertexShader=e.vertexShader.replace("void main() {","varying vec3 vPosition;\nvoid main() {\nvPosition = position;")};var c=new THREE.Mesh(s,u);return c.rotation.x=-Math.PI/2,c.position.copy(i),c.renderOrder=2,c},effectDiffusion:function(e,t){var n=t.center,r=t.color,i=t.radius,o=t.range,a=t.time,s=t.speed;e.onBeforeCompile=function(t){e.shader=t,t.uniforms.uCenter={value:n},t.uniforms.uColor={value:r},t.uniforms.uRadius={value:i},t.uniforms.uRange={value:o},t.uniforms.uSpeed={value:s},t.uniforms.time=a;t.fragmentShader=t.fragmentShader.replace("void main() {","\nuniform vec3 uCenter;\nuniform vec3 uColor;\n\nuniform float uRadius;\nuniform float uRange;\nuniform float uSpeed;\nuniform float time;\n\nvarying vec3 vPosition;\n\nfloat distanceTo(vec2 src, vec2 dst) {\n    float dx = src.x - dst.x;\n    float dy = src.y - dst.y;\n    float dv = dx * dx + dy * dy;\n    return sqrt(dv);\n}\n\nvoid main() {\n    \n    "),t.fragmentShader=t.fragmentShader.replace("gl_FragColor = vec4( outgoingLight, diffuseColor.a );","\n            float index = mod(time * uSpeed, 1.0);\n            float len = distanceTo(vec2(.0, .0), vPosition.xy);\n\n            float lenIndex = len / uRadius;\n            if (lenIndex < index && lenIndex + uRange > index) {\n                float i = (lenIndex + uRange - index) / uRange;\n                i = sin(i * PI);\n                outgoingLight = mix(outgoingLight, uColor, i);\n            }\n            gl_FragColor = vec4(outgoingLight, diffuseColor.a );");t.vertexShader=t.vertexShader.replace("void main() {","varying vec3 vPosition;\nvoid main() {\n    "),t.vertexShader=t.vertexShader.replace("#include <project_vertex>","\nvec4 mvPosition = vec4( transformed, 1.0 );\n\n#ifdef USE_INSTANCING\n\n    mvPosition = instanceMatrix * mvPosition;\n\n#endif\nvPosition = mvPosition.xyz;\nmvPosition = modelViewMatrix * mvPosition;\n\ngl_Position = projectionMatrix * mvPosition;\n")}},effectRiseLine:function(e,t){var n=t.gap,r=void 0===n?20:n,i=t.color,o=t.speed,a=t.time,s=t.width,u=t.opacity;e.color.copy(i),e.onBeforeCompile=function(t){e.shader=t,t.uniforms.uGap={value:r},t.uniforms.uColor={value:i},t.uniforms.uSpeed={value:o},t.uniforms.uWidth={value:s},t.uniforms.uOpacity={value:u},t.uniforms.time=a;t.fragmentShader=t.fragmentShader.replace("void main() {","\nuniform vec3 uColor;\n\nuniform float uGap;\nuniform float uSpeed;\nuniform float uWidth;\nuniform float uOpacity;\nuniform float time;\n\nvarying vec3 vPosition;\n\nfloat distanceTo(vec2 src, vec2 dst) {\n    float dx = src.x - dst.x;\n    float dy = src.y - dst.y;\n    float dv = dx * dx + dy * dy;\n    return sqrt(dv);\n}\n\nvoid main() {\n    \n    "),t.fragmentShader=t.fragmentShader.replace("gl_FragColor = vec4( outgoingLight, diffuseColor.a );","\n            float iTime = time * uSpeed;\n            float showRange = mod(vPosition.z - iTime, uGap);\n            if (showRange < 1.0 && vPosition.z < iTime) {\n                diffuseColor.a = uOpacity * sin((1.0 - showRange) * PI);\n            } else {\n                diffuseColor.a = 0.0;\n            }\n            gl_FragColor = vec4(outgoingLight, diffuseColor.a );");t.vertexShader=t.vertexShader.replace("void main() {","varying vec3 vPosition;\nvoid main() {\n    "),t.vertexShader=t.vertexShader.replace("#include <project_vertex>","\nvec4 mvPosition = vec4( transformed, 1.0 );\n\n#ifdef USE_INSTANCING\n\n    mvPosition = instanceMatrix * mvPosition;\n\n#endif\nvPosition = mvPosition.xyz;\nmvPosition = modelViewMatrix * mvPosition;\n\ngl_Position = projectionMatrix * mvPosition;\n")}},effectWaterial:function(e,t){var n=t.speed,r=t.time;e.onBeforeCompile=function(e){e.uniforms.time=r,e.uniforms.uSpeed={value:n};e.fragmentShader=e.fragmentShader.replace("#include <map_fragment>","\n            \n            #ifdef USE_MAP \n                \n                vec4 texelColor = texture2D( map, vUv + dudv * 0.015 );\n            \n                texelColor = mapTexelToLinear( texelColor );\n                diffuseColor *= texelColor;\n            \n            #endif\n            "),e.fragmentShader=e.fragmentShader.replace("void main() {","\nuniform float time;\nuniform float uSpeed;\n\n            const float hardness = 0.1;\n            const int iterations = 4;\n            const float speed = 1.5;\n            const float intensity = 1.0;\n\n            #define COMPLEX\n            #define HASHSCALE4 vec4(1031, .1030, .0973, .1099)\n            vec4 hash43(vec3 p)\n{\n    vec4 p4 = fract(vec4(p.xyzx)  * HASHSCALE4);\n    p4 += dot(p4, p4.wzxy+19.19);\n    return fract((p4.xxyz+p4.yzzw)*p4.zywx);\n}\n\nfloat drip(vec2 uv, vec2 pos, float age, float scale, float cells) {\n    vec2 vD = vec2 (uv - pos);\n    float fD = sqrt(dot (vD, vD)) * 2.0 * (cells/16.0);\n    float fDa = 10.0 * fD;\n    float freq = 300.0 * scale;\n    return    max (0.0, 1.0 - fDa*fDa)\n            * sin ((fD*freq - age*40.0*(scale*2.0-1.0))*hardness);\n}\n\n// Based on texture bombing: http://http.developer.nvidia.com/GPUGems/gpugems_ch20.html\nfloat drops(vec2 uv, float cells) {\n    float height = 0.0;\n    vec2 cell = floor(uv * cells);\n    for(int iter=0; iter<iterations; iter++) {\n        for(int i = -1; i <= 1; i++) {\n          for(int j = -1; j <= 1; j++) {\n            vec2 cell_t = cell + vec2(i, j);\n            vec2 uv_t = uv;\n #ifdef TILED\n              // could be simplified...\n              if (cell_t.x<0.0) {\n                  cell_t.x += cells;\n                  uv_t.x += 1.0;\n              } else if (cell_t.x>cells-1.0) {\n                  cell_t.x -= cells;\n                  uv_t.x -= 1.0;\n              }\n              \n              if (cell_t.y<0.0) {\n                  cell_t.y += cells;\n                  uv_t.y += 1.0;\n              } else if (cell_t.y>cells-1.0) {\n                  cell_t.y -= cells;\n                  uv_t.y -= 1.0;\n              }\n #endif\n            vec4 rnd_t = hash43(vec3(cell_t, float(iter)));\n            vec2 pos_t = (cell_t+rnd_t.xy)/cells;\n            float age_t = (time * speed + rnd_t.z);\n            float scale_t = rnd_t.w;\n            height += drip(uv_t, pos_t, age_t, scale_t, cells);\n          }\n        }\n    }\n    return height;\n}\n\nfloat heightmap(vec2 uv) {\n    float height = 0.0;\n #ifdef COMPLEX\n    height += drops(uv, 32.0);\n    height += drops(uv, 16.0);\n    height += drops(uv, 8.0);\n    height += drops(uv, 4.0);\n    height += drops(uv, 2.0);\n    height /= 8.0;\n #else\n    height += drops(uv, 8.0);\n    height += drops(uv, 4.0);\n    height /= 5.0;\n #endif\n    return height * intensity;\n}\n\nvec2 dudvmap(vec2 uv) {\n    const float eps = 0.01;\n    vec2 offset = vec2(eps, 0.0);\n    return vec2(\n        heightmap(uv+offset.xy) - heightmap(uv-offset.xy),\n        heightmap(uv+offset.yx) - heightmap(uv-offset.yx)\n    );\n}\n\n            void main() {\n                vec2 _uv = vUv; \n\n                float height = heightmap(_uv);\n\n                vec2 dudv = dudvmap(_uv) * uSpeed;\n            "),e.fragmentShader=e.fragmentShader.replace("#include <normal_fragment_maps>","\n\n#ifdef OBJECTSPACE_NORMALMAP\n\n    normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0; // overrides both flatShading and attribute normals\n\n    #ifdef FLIP_SIDED\n\n        normal = - normal;\n\n    #endif\n\n    #ifdef DOUBLE_SIDED\n\n        normal = normal * faceDirection;\n\n    #endif\n\n    normal = normalize( normalMatrix * normal );\n\n#elif defined( TANGENTSPACE_NORMALMAP )\n\n    vec3 mapN = texture2D( normalMap, vUv + dudv * 0.01 ).xyz * 2.0 - 1.0;\n    mapN.xy *= normalScale;\n\n    #ifdef USE_TANGENT\n\n        normal = normalize( vTBN * mapN );\n\n    #else\n\n        normal = perturbNormal2Arb( -vViewPosition, normal, mapN, faceDirection );\n\n    #endif\n\n#elif defined( USE_BUMPMAP )\n\n    normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd(), faceDirection );\n\n#endif\n"),e.vertexShader="\n            #define STANDARD\n            \n            varying vec3 vViewPosition;\n            \n            #ifndef FLAT_SHADED\n            \n                varying vec3 vNormal;\n            \n                #ifdef USE_TANGENT\n            \n                    varying vec3 vTangent;\n                    varying vec3 vBitangent;\n            \n                #endif\n            \n            #endif\n            \n            #ifdef USE_TRANSMISSION\n            \n                varying vec4 vWorldPosition;\n            \n            #endif\n            \n            #include <common>\n\n            varying vec2 vUv;\n            varying vec2 tUv;\n            uniform mat3 uvTransform;\n\n            #include <uv2_pars_vertex>\n            #include <displacementmap_pars_vertex>\n            #include <color_pars_vertex>\n            #include <fog_pars_vertex>\n            #include <morphtarget_pars_vertex>\n            #include <skinning_pars_vertex>\n            #include <shadowmap_pars_vertex>\n            #include <logdepthbuf_pars_vertex>\n            #include <clipping_planes_pars_vertex>\n            \n            void main() {\n            \n                vUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n                #include <uv2_vertex>\n                #include <color_vertex>\n            \n                #include <beginnormal_vertex>\n                #include <morphnormal_vertex>\n                #include <skinbase_vertex>\n                #include <skinnormal_vertex>\n                #include <defaultnormal_vertex>\n            \n            #ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\n            \n                vNormal = normalize( transformedNormal );\n            \n                #ifdef USE_TANGENT\n            \n                    vTangent = normalize( transformedTangent );\n                    vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n            \n                #endif\n            \n            #endif\n            \n                #include <begin_vertex>\n                #include <morphtarget_vertex>\n                #include <skinning_vertex>\n                #include <displacementmap_vertex>\n                #include <project_vertex>\n                #include <logdepthbuf_vertex>\n                #include <clipping_planes_vertex>\n            \n                vViewPosition = - mvPosition.xyz;\n            \n                #include <worldpos_vertex>\n                #include <shadowmap_vertex>\n                #include <fog_vertex>\n            \n            #ifdef USE_TRANSMISSION\n            \n                vWorldPosition = worldPosition;\n            \n            #endif\n            }\n            "}},replaceWater:function(e,t){var n=new THREE.Water(e.geometry,{textureWidth:512,textureHeight:512,waterNormals:t.waterNormals,sunDirection:new THREE.Vector3,sunColor:16777215,waterColor:3558189,distortionScale:20,fog:!1});return n.position.copy(e.position),n.rotation.copy(e.rotation),n.scale.copy(e.scale),n}};function Qt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function $t(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Qt(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Qt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function en(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=J()(e);if(t){var i=J()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return V()(this,n)}}var tn=function(e){F()(n,e);var t=en(n);function n(e){var r,o=e.options,s=e.render;a()(this,n),r=t.call(this),i()(j()(r),"animate",(function(e){r.time.value+=e,r.animateMeshs.forEach((function(t){var n=t.mesh,r=t.option.rotation;r&&I.eachObject(r,(function(t,r){n.rotation[r]+=t*e}))})),r.animateMpas.forEach((function(t){I.eachObject(t.uv,(function(n,r){t.texture&&(t.texture.offset[r]+=n*e)}))})),r.animateTime.forEach((function(t){t.uniforms.time.value+=e*(t._speed||1)}))}));var u=o.created,c=o.mounted,l=o.loadEnd;return r.modelLoader=new THREE.FBXLoader,r.render=s,r.animateMeshs=[],r.animateMpas=[],r.animateTime=[],r.time={value:0},r.options=$t({},o),r.init(o.config),u&&u(r.group),r.effectInit().then((function(){c&&c(r.group),l&&l()})),r}return u()(n,[{key:"effectInit",value:function(){var e=this,t=this.config,n=t.model,r=t.order,i=t.chassis;return this.createChassis(i),new Promise((function(t){if(r)e.loadOrderModel(n,(function(){t()}));else{var i=0;n.forEach((function(r){e.loadModel(r).then((function(o){e.addModel(o,r),++i===n.length&&t()}))}))}})).catch((function(e){console.error(e)}))}},{key:"addModel",value:function(e,t){var n=this;this.options.update&&this.options.update(e);var r=t.material,i=t.mesh,o=t.replaceMaterial,a=t.animate,s=t.bake,u=r.map((function(e){return e.name})),c=i.map((function(e){return e.name})),l=a.map((function(e){return e.name})),h=s.map((function(e){return e.name}));e.traverse((function(e){var t=["bumpMap","alphaMap","normalMap","map","displacementMap","envMap","roughnessMap","lightMap"];I.eachMaterial(e.material,(function(i,a){var s=i,c=u.indexOf(i.name);if(o&&THREE[o]&&(i.dispose(),s=new THREE[o]({name:i.name,fog:i.fog,color:i.color,transparent:i.transparent,opacity:i.opacity,depthWrite:i.depthWrite,depthTest:i.depthTest,depthFunc:i.depthFunc,colorWrite:i.colorWrite,blending:i.blending,side:2,aoMapIntensity:i.aoMapIntensity,map:i.map,alphaMap:i.alphaMap,bumpMap:i.bumpMap,reflectivity:i.reflectivity,vertexColors:i.vertexColors,userData:i.userData,shadowSide:i.shadowSide}),Array.isArray(e.material)?e.material[a]=s:e.material=s),-1!==c){var l=r[c];for(var h in l)"name"!==h&&(t.includes(h)?s[h]=n.render.Txues.getTxue(l[h]):"animate"!==h&&(s[h]=l[h]));l.animate&&I.eachObject(l.animate,(function(e,t){n.animateMpas.push({texture:s[t],uv:e})}))}}));var d=h.indexOf(e.name);if(-1!==d){var p=s[d];I.eachMaterial(e.material,(function(e){e.onBeforeCompile=function(t){e._shader=t;var r="",i="",o="outgoingLight",a="",s="";for(var u in p)"name"!==u&&(t.uniforms["uMap".concat(u)]={value:n.render.Txues.getTxue(p[u])},a+="attribute vec2 ".concat(u,";"),r+="varying vec2 v".concat(u,";"),s+="v".concat(u," = ").concat(u,";"),i+="uniform sampler2D uMap".concat(u,";"),o+="* vec3(texture2D(uMap".concat(u,", v").concat(u,").rgb)"));var c="".concat(r,"\n").concat(i,"\nvoid main() {"),l="gl_FragColor = vec4(".concat(o,", diffuseColor.a);");t.fragmentShader=t.fragmentShader.replace("void main() {",c),t.fragmentShader=t.fragmentShader.replace("gl_FragColor = vec4( outgoingLight, diffuseColor.a );",l);var h="".concat(r,"\n").concat(a,"\nvoid main() {\n").concat(s);t.vertexShader=t.vertexShader.replace("void main() {",h)}}))}var f=c.indexOf(e.name);if(-1!==f){var v=i[f];I.eachObject(v,(function(t,r){if("effects"===r){var i={time:n.time},o="";switch(e.geometry.computeBoundingSphere(),e.geometry.computeBoundingBox(),t.name){case"diffusion":var a=t.speed,s=void 0===a?1:a,u=t.radius,c=void 0===u?"auto":u,l=t.center,h=t.range,d=void 0===h?.1:h,p=t.color;i.center=l,i.color=p||new THREE.Color,i.radius="auto"===c?e.geometry.boundingSphere.radius:c,i.range=d,i.speed=s,o="effectDiffusion";break;case"riseLine":var f=t.speed,v=void 0===f?1:f,m=t.color,y=t.gap,g=t.width,x=t.opacity;i.speed=v,i.color=m,i.gap=y,i.opacity=x,i.minHeight=g,o="effectRiseLine";break;case"water":var b=t.speed,w=void 0===b?1:b;i.speed=w,o="effectWaterial"}I.eachMaterial(e.material,(function(e){Kt[o]&&Kt[o](e,i)}))}else if("replace"===r){var T=null;switch(t.name){case"water":(T=Kt.replaceWater(e,{waterNormals:n.render.Txues.getTxue("waternormals"),map:n.render.Txues.getTxue("watert")})).material._speed=t.speed||1,n.animateTime.push(T.material)}T&&(e.parent.add(T),I.disposeObj(e))}else e[r]=t}))}var m=l.indexOf(e.name);-1!==m&&n.animateMeshs.push({option:$t({},a[m]),mesh:e})})),this.group.add(e)}},{key:"setModel",value:function(e,t){if(void 0===e)return!1;for(var n=e.split("."),r=this,i=0;i<n.length;i++){var o=n[i];i===n.length-1&&r?r[o]=t:r=r[o]}return r=null,!1}},{key:"getModel",value:function(e){return this.group.getObjectByName(e)}},{key:"setMaterialValues",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.group.traverse((function(n){I.eachMaterial(n.material,(function(n){n.name===e&&n.setValues(t)}))}))}},{key:"loadOrderModel",value:function(e,t){var n=this;if(0===e.length)return!1;var r=e.shift();return this.loadModel(r).then((function(i){0!==e.length?n.loadOrderModel(e,t):t&&t("end"),n.addModel(i,r)})),!0}},{key:"loadModel",value:function(e){var t=this;return new Promise((function(n,r){try{t.modelLoader.load(e.url,(function(e){n(e)}))}catch(e){r(e)}})).catch((function(e){console.error(e)}))}},{key:"createChassis",value:function(e){var t=Kt.createChassis(e);this.group.add(t)}},{key:"setVisible",value:function(e){this.group.traverse((function(t){I.eachMaterial(t.material,(function(t){t.visible=e}))}))}},{key:"dispose",value:function(){this.options=null,this.modelLoader=null,this.animateMeshs=null,this.animateMpas=null,this.options.destroyed&&this.options.destroyed()}}]),n}(Zt),nn={Linear:{None:function(e){return e}},Quadratic:{In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)}},Cubic:{In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)}},Quartic:{In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)}},Quintic:{In:function(e){return e*e*e*e*e},Out:function(e){return--e*e*e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}},Sinusoidal:{In:function(e){return 1-Math.cos(e*Math.PI/2)},Out:function(e){return Math.sin(e*Math.PI/2)},InOut:function(e){return.5*(1-Math.cos(Math.PI*e))}},Exponential:{In:function(e){return 0===e?0:Math.pow(1024,e-1)},Out:function(e){return 1===e?1:1-Math.pow(2,-10*e)},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(2-Math.pow(2,-10*(e-1)))}},Circular:{In:function(e){return 1-Math.sqrt(1-e*e)},Out:function(e){return Math.sqrt(1- --e*e)},InOut:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}},Elastic:{In:function(e){return 0===e?0:1===e?1:-Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)},Out:function(e){return 0===e?0:1===e?1:Math.pow(2,-10*e)*Math.sin(5*(e-.1)*Math.PI)+1},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?-.5*Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI):.5*Math.pow(2,-10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)+1}},Back:{In:function(e){var t=1.70158;return e*e*((t+1)*e-t)},Out:function(e){var t=1.70158;return--e*e*((t+1)*e+t)+1},InOut:function(e){var t=2.5949095;return(e*=2)<1?e*e*((t+1)*e-t)*.5:.5*((e-=2)*e*((t+1)*e+t)+2)}},Bounce:{In:function(e){return 1-Easing.Bounce.Out(1-e)},Out:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},InOut:function(e){return e<.5?.5*Easing.Bounce.In(2*e):.5*Easing.Bounce.Out(2*e-1)+.5}}};function rn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=J()(e);if(t){var i=J()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return V()(this,n)}}var on=function(e){F()(n,e);var t=rn(n);function n(e){var r,o=e.options,s=e.render;return a()(this,n),r=t.call(this),i()(j()(r),"animate",(function(e){if(r.cohesionConfig.state){r.cohesionConfig.time+=e;var t=r.cohesionConfig,n=t.time,i=t.total;n>=i&&(r.cohesionConfig.state=!1,r.cohesionConfig.time=i);var o=r.getEasing("Quartic.InOut")(n/i);o>1&&(o=1);var a=r.cohesionConfig,s=a.source,u=a.target;return r.render.camera.position.copy(u.camera.clone().lerp(s.camera,o)),r.render.controls.target.copy(u.target.clone().lerp(s.target,o)),!1}for(var c=r.aniatePath.length,l=function(t){var n=r.aniatePath[t],i=n.pause&&r.pauseConfig.state;if(!n.state||i)return"continue";n.cTime+=1e3*e,n.index=n.cTime/n.time,n.index>1&&(n.index=1);var o=n.index*n.length;n.data.forEach((function(e,t){if(e.length>o&&o>n.data[t-1].length){var i=n.data[t-1],a=e.length-i.length,s=o-i.length,u=r.getEasing(e.easing)(s/a);if("none"===e.type){var c=(i._camera||i.camera).clone().lerp(e.camera,u),l=i.target.clone().lerp(e.target,u);r.updateCamera(c,l)}else{var h=new THREE.Vector2(e.camera.x,e.camera.z),d=new THREE.Vector2(e.target.x,e.target.z),p=THREE.MathUtils.lerp(e.angle[0],e.angle[1],u);h.rotateAround(d,p);var f=new THREE.Vector3(h.x,e.camera.y,h.y);e._camera=f,r.updateCamera(f,e.target)}}})),n.index>=1&&(n.loop?r.start(n.id,n.cohesion):(r.eftEnd&&r.eftEnd(),r.cohesionConfig.state=!1,r.pauseConfig.state=!1,r.pauseConfig.currentPause=!1,n.callback&&n.callback(),n.state=!1))},h=0;h<c;h++)l(h);return r.pauseConfig.state&&(r.pauseConfig.time+=e,r.pauseConfig.time>=r.pauseConfig.total&&(r.pauseConfig.state=!1,r.cohesionConfig.time=0,r.cohesionConfig.state=!0,r.cohesionConfig.target={camera:r.render.camera.position.clone(),target:r.render.controls.target.clone()})),!1})),r.render=s,r.init(o.config),r.aniatePath=[],r.isHindrance=!0,r.pauseConfig={currentPause:!1,state:!1,total:4,time:0},r.cohesionConfig={state:!1,total:4,time:0,source:null,target:null},r.eftEnd=o.eftEnd||null,o.created&&o.created(),r.effectInit().then((function(){r.aniatePath=r.handlePaths(o.config.data),o.mounted()&&o.mounted(r.group),o.loadEnd&&o.loadEnd()})),r}return u()(n,[{key:"effectInit",value:function(){var e=this;return new Promise((function(t,n){try{e.baseInit(),t()}catch(e){n(e)}})).catch((function(){}))}},{key:"start",value:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return new Promise((function(r,i){try{t.pauseConfig.currentPause=!1,t.aniatePath.forEach((function(i,o){if(e===i.id){i.cohesion&&(t.aniatePath[o]=t.handlePath(i));var a=t.aniatePath[o];a.state=n,a.cTime=0,a.index=0,t.pauseConfig.currentPause=a.pause,a.callback=function(){r(a)}}else i.state=!1}))}catch(e){i(e)}}))}},{key:"baseInit",value:function(){}},{key:"handlePaths",value:function(e){var t=this;return e.map((function(e){return t.handlePath(e)}))}},{key:"handlePath",value:function(e){var t=this,n=e.id,r=e.time,i=e.data,o=e.cohesion,a=void 0===o||o,s=e.loop,u=void 0!==s&&s,c=e.pause,l=void 0!==c&&c,h=e.callback,d=0;if(a){var p=this.getCameraData(),f=p.camera,v=p.target;i[0].cohesion?(i[0].camera=f,i[0].target=v):i.unshift({camera:f,target:v,cohesion:a})}return i.forEach((function(n,r){var o=n.type,a=void 0===o?"none":o,s=n.speed,u=void 0===s?1:s;if("none"===a){var c=n.camera,l=n.target;n.camera=new THREE.Vector3(c.x,c.y,c.z),n.target=new THREE.Vector3(l.x,l.y,l.z),0!==r&&(d+=i[r-1].camera.distanceTo(n.camera)/(u||1))}else if("spin"===a){var h=n.angle,p=void 0===h?[0,Math.PI]:h,f=t.getCaneraIng(i[r-1]),v=n.target||t.getTargetIng(i[r-1]),m=new THREE.Vector2(f.x,f.z),y=new THREE.Vector2(v.x,v.z);n.camera=f,n.target=v;var g=m.distanceTo(y);d+=(p[1]-p[0])*(2*g)/u}n.type=a,n.length=d,n.easing=n.easing||e.easing})),{id:n,cTime:0,cohesion:a,time:r,data:i,index:0,start:!1,length:d,loop:u,pause:l,callback:h}}},{key:"updateCamera",value:function(e,t){this.render.camera.position.copy(e),this.render.controls.target.copy(t)}},{key:"getCaneraIng",value:function(e){return e&&e.camera?e.camera:this.render.camera.position.clone()}},{key:"getTargetIng",value:function(e){return e&&e.target?e.target:this.render.controls.target.clone()}},{key:"getCameraData",value:function(){var e=this.render.camera.position,t=this.render.controls.target;return I.getCameraData(e,t)}},{key:"getEasing",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Linear.None";if(!e)return nn.Linear.None;for(var t=e.split("."),n=nn,r=nn.Linear.None,i=0;i<t.length;i++){var o=t[i];i===t.length-1&&n?r=n[o]:n=n[o]}return n=null,r}},{key:"onMouseDown",value:function(e){this.pauseConfig.currentPause&&(this.pauseConfig.state||(this.cohesionConfig.source={camera:this.render.camera.position.clone(),target:this.render.controls.target.clone()}),this.pauseConfig.state=!0,this.pauseConfig.time=0)}},{key:"eftEnd",value:function(){}},{key:"dispose",value:function(){this.aniatePath=[]}}]),n}(Zt);function an(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=J()(e);if(t){var i=J()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return V()(this,n)}}var sn=function(){function e(){a()(this,e),this.canvas=document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),this.context=this.canvas.getContext("2d"),this.image=new Image,this.onLoad=function(){},this.beforeScreenCut=function(){},this.screenCut=function(){},this.beforeDestroy=function(){},this.destroyed=function(){}}return u()(e,[{key:"drawDom",value:function(e,t,n){if(e){t&&(e=e.cloneNode(!0)),this.beforeScreenCut(e,this),this.screenCut('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" width="'+(n&&n.width||e.offsetWidth)+'" height="'+(n&&n.height||e.offsetHeight)+'"><foreignObject x="0" y="0" width="100%" height="100%">'+(new XMLSerializer).serializeToString(e).replace(/#/g,"%23").replace(/\n/g,"%0A")+"</foreignObject></svg>"),this.beforeDestroy(e,this);var r=this.destroyed;this.destroy(),r.call(this,e,this)}}},{key:"drawImg",value:function(e){var t=e.width,n=e.height;this.canvas.width=t,this.canvas.height=n,this.context.clearRect(0,0,t,n),this.context.drawImage(e,0,0),this.beforeScreenCut(e,this),this.screenCut(this.canvas.toDataURL("image/png"),this),this.beforeDestroy(e,this);var r=this.destroyed;this.destroy(),r.call(this,e,this)}},{key:"destroy",value:function(){for(var e in delete this.image.onload,this)delete this[e]}}]),e}();var un=function(e,t,n){return new(function(r){F()(o,r);var i=an(o);function o(){var r;return a()(this,o),(r=i.call(this)).screenCut=t,r.drawDom(e,!1,n),r}return o}(sn))};function cn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ln(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?cn(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):cn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function hn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=J()(e);if(t){var i=J()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return V()(this,n)}}var dn="uniform vec3 uColor;\n    uniform float uTime;uniform float uOpacity;\n    attribute vec3 position2; attribute float cRatio;\n    varying vec4 vColor;\n    varying vec2 vUv;\n    void main() {\n        vUv = uv;\n        float _k = uTime + cRatio;\n        _k = fract(_k);\n        vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n        vec3 vPos = mix( position, position2, _k * length(mvPosition.xyz)/800.0);\n        vColor = vec4( uColor, (1.0 - _k) * uOpacity); vUv = uv;\n        gl_Position = projectionMatrix * modelViewMatrix * vec4( vPos, 1.0 );\n    }",pn="uniform sampler2D uTexture;\n    varying vec4 vColor;\n    varying vec2 vUv;\n    void main() {\n        gl_FragColor = vColor * texture2D(uTexture, vUv);\n    }",fn=function(e){F()(n,e);var t=hn(n);function n(e){var r,o=e.options,s=e.render;return a()(this,n),r=t.call(this),i()(j()(r),"animate",(function(e){if(r.group.traverse((function(t){t._isSpread&&(t.transTimes+=e,t.material.uniforms.uTime.value=t.transTimes/t.perTimes)})),r.opacityConfig.start){r.opacityConfig.transTimes+=e;var t=r.opacityConfig,n=t.transTimes,i=t.perTimes;if(n<=i+e){var o=Math.min(1,n/i);r.setTipOpacityAnimate(o)}else r.opacityConfig.start=!1,r.opacityConfig.animateEndCallback&&r.opacityConfig.animateEndCallback()}})),r.renderers=s,r.loadConfig={loadedCount:0,allNodeCount:0},r.opacityConfig={start:!1,transTimes:0,perTimes:1},r.currentMouseObject=null,r.init(o),r}return u()(n,[{key:"onMouseIn",value:function(e,t){if(t.length>0){var n=t[0].object.userData;return this.currentMouseObject!==t[0].object&&(this.currentMouseObject=t[0].object,this.currentMouseObject.material.color=new THREE.Color("#FF0000")),[e,n]}}},{key:"onMouseOut",value:function(e,t){this.currentMouseObject&&(this.currentMouseObject.material.color=new THREE.Color("#FFFFFF"),this.currentMouseObject=null)}},{key:"onClick",value:function(e,t,n){return t.length>0?[e,t[0].object.userData]:[e]}},{key:"onDblClick",value:function(e,t,n){return t.length>0?[e,t[0].object.userData]:[e]}},{key:"setTipOpacityAnimate",value:function(e){this.opacityConfig.direct&&(e=1-e),this.group.traverse((function(t){t.material&&void 0!==t._opacity&&(t.material.uniforms?t.material.uniforms.u_opacity.value=t._opacity*e:t.material.opacity=t._opacity*e)}))}},{key:"setPointTips",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.isShow,r=void 0===n||n,i=t.callback;switch(e){case"opacity":this.opacityConfig.start=!0,this.opacityConfig.direct=r,this.opacityConfig.transTimes=0,this.opacityConfig.animateEndCallback=i}}},{key:"createTips",value:function(e){var t=this,n=e.url,r=new Image;r.src=n,r.onload=function(){var n=document.createElement("canvas");n.width=r.width,n.height=r.height,n.getContext("2d").drawImage(r,0,0,r.width,r.height);var i=r.src.substring(r.src.lastIndexOf(".")+1).toLowerCase(),o=n.toDataURL("image/".concat(i));t.createTipObj(ln({background:o},e))}}},{key:"createTipObj",value:function(e){var t,n,r=this,i=e.background,o=e.content,a=e.position,s=e.divCallback,u=e.center,c=e.mouseEvent,l=e.opacityMark,h=s?s(i,o):"<div style = \"width: 388px;height: 175px;background: url('".concat(i,'\') no-repeat 100% 100%;">\n        <div style="color: #fbf5f5;font-size: 24px;position: absolute;left: 154px;top: 26px;">').concat(o,"</div></div>"),d=(t=h,(n=document.createElement("div")).innerHTML=t,n.childNodes[0]);document.body.appendChild(d),un(d,(function(e){var t=function(e,t,n){var r=e.offsetWidth,i=e.offsetHeight,o=THREE.Math.ceilPowerOfTwo(r),a=THREE.Math.ceilPowerOfTwo(i),s={minX:0,maxX:1,minY:0,maxY:1};n?(s.minX=(o-r)/(2*o),s.maxX=1-s.minX,s.minY=(a-i)/(2*a),s.maxY=1-s.minY):(s.minX=(o-r)/(2*o),s.maxX=1-s.minX,s.minY=0,s.maxY=i/a);var u=(new THREE.TextureLoader).load(t,(function(e){var t=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");t.width=o,t.height=a;var s=t.getContext("2d"),u=e.image;n?s.drawImage(u,(o-r)/2,(a-i)/2):s.drawImage(u,(o-r)/2,a-i),e.image=t,u=null}));return u.needsUpdate=!0,u._nodeWidth=r,u._nodeHeight=i,u._width=o,u._height=a,u._boundary=s,u}(d,e,!0),n=new THREE.SpriteMaterial({map:t,transparent:!0,depthTest:!1,depthWrite:!1,sizeAttenuation:!1}),i=new THREE.Sprite(n);i.renderOrder=100,i.scale.set(t._width/1500,t._height/1500,t._width/1500),u?i.center.set(u.x,u.y):i.center.set(t._boundary.minX+.03,t._boundary.minY+.07),i.position.copy(a),i.userData={content:o},c&&r.eventArr.push(i),l&&(i._opacity=1),r.group.add(i),r.loadConfig.loadedCount++,r._onTotalLoaded()})),document.body.removeChild(d)}},{key:"createSpreadPoint",value:function(e){for(var t=e.color,n=e.textureName,r=e.size,i=void 0===r?40:r,o=I.getColorArr(t),a={indices:[],ratios:[],vecs1:[],vecs2:[],uvs:[]},s=0;s<3;s++){for(var u=0;u<4;u++)a.vecs1.push(0,0,0),a.ratios.push(s/3);a.vecs2.push(-i,-i,0),a.uvs.push(0,0),a.vecs2.push(i,-i,0),a.uvs.push(1,0),a.vecs2.push(-i,i,0),a.uvs.push(0,1),a.vecs2.push(i,i,0),a.uvs.push(1,1),a.indices.push(4*s,4*s+2,4*s+3),a.indices.push(4*s,4*s+3,4*s+1)}var c=new THREE.BufferGeometry;c.setIndex(a.indices),c.setAttribute("uv",new THREE.Float32BufferAttribute(a.uvs,2)),c.setAttribute("cRatio",new THREE.Float32BufferAttribute(a.ratios,1)),c.setAttribute("position",new THREE.Float32BufferAttribute(a.vecs1,3)),c.setAttribute("position2",new THREE.Float32BufferAttribute(a.vecs2,3));var l=new THREE.ShaderMaterial({uniforms:{uTexture:{value:this.renderers.getTxue(n)},uOpacity:{value:1},uColor:{value:o[0]},uTime:{value:0}},transparent:!0,side:THREE.DoubleSide,depthTest:!1,vertexShader:dn,fragmentShader:pn}),h=new THREE.Mesh(c,l);return h.transTimes=0,h.perTimes=2,h._isSpread=!0,h.onBeforeRender=function(e,t,n){h.rotation.copy(n.rotation)},h}},{key:"_onTotalLoaded",value:function(){this.loadConfig.loadedCount===this.loadConfig.allNodeCount-1&&this.renderers.updateEventArr(this)}},{key:"compEftInit",value:function(){var e=this;this.eventArr=[],this.renderers.removeEventArr(this.id);var t=this.config.config.points,n=void 0===t?[]:t;this.loadConfig.allNodeCount=n.length,n.forEach((function(t){var n=t.position,r=t.spreadStyle,i=t.tipStyle,o=t.mouseEvent,a=t.opacityMark;if(r){var s=e.createSpreadPoint(r);s.position.copy(n),e.group.add(s)}i&&e.createTips(ln({position:n,mouseEvent:o,opacityMark:a},i))}))}}]),n}(Zt);function vn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=J()(e);if(t){var i=J()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return V()(this,n)}}var mn=function(e){F()(n,e);var t=vn(n);function n(e){var r,i=e.options,o=e.render;return a()(this,n),(r=t.call(this)).render=o,r.modelLoader=new THREE.FBXLoader,r.InstanceMesh=null,r.init(i.config),i.created&&i.created(r.group),r.effectInit().then((function(){i.mounted&&i.mounted(r.group),i.loadEnd&&i.loadEnd()})),r}return u()(n,[{key:"effectInit",value:function(){var e=this;return new Promise((function(t,n){try{e.baseInit();var r=e.config.data,i=e.config.material||{},o=0;r.forEach((function(n){e.loadModelData(n.meshData).then((function(a){var s=a.length;e.loadBascMesh(n.model).then((function(u){var c=new THREE.Color;I.eachMaterial(u.material,(function(e){e.setValues(i)})),e.InstanceMesh=new THREE.InstancedMesh(u.geometry,u.material,s),e.InstanceMesh.renderOrder=n.renderOrder,e.group.add(e.InstanceMesh);var l=new THREE.Matrix4;a.forEach((function(t,n){l.identity(),l.makeRotationFromEuler(t.rotation),l.scale(t.scale),l.setPosition(t.position),e.InstanceMesh.setMatrixAt(n,l),e.InstanceMesh.setColorAt(n,c)})),++o===r.length&&t()})).catch((function(){++o===r.length&&t()}))}))}))}catch(e){n(e)}})).catch((function(){}))}},{key:"baseInit",value:function(){}},{key:"loadBascMesh",value:function(e){var t=this;return new Promise((function(n,r){try{var i=e.material.map((function(e){return e.name}));t.modelLoader.load(e.url,(function(t){t.traverse((function(t){t.isMesh&&(I.eachMaterial(t.material,(function(t){var n=i.indexOf(t.name);-1!==n&&t.setValues(e.material[n])})),n(t))}))}))}catch(e){r(e)}}))}},{key:"loadModelData",value:function(e){var t=this,n=e.type,r=e.data,i=this.config.rotation;return new Promise((function(e,o){try{if("data"===n){var a=[];r.forEach((function(e){var t=e.position,n=e.rotation,r=e.scale;a.push({position:new THREE.Vector3(t.x,t.y,t.z),rotation:new THREE.Euler(n.x+i.x,n.y+i.y,n.y+i.z),scale:new THREE.Vector3(r.x,r.y,r.z)})})),e(a)}else if("fbx"===n){var s=new THREE.Euler(0,0,0,"XYZ");t.modelLoader.load(r,(function(t){var n=[];t.children.forEach((function(e){e.rotation.x+=i.x,e.rotation.y+=i.y,e.rotation.z+=i.z,s.set(e.rotation.x+t.rotation.x,e.rotation.y+t.rotation.y,e.rotation.z+t.rotation.z),n.push({position:e.position,rotation:s.clone(),scale:e.scale})})),e(n),I.disposeObj(t)}))}}catch(e){o(e)}})).catch((function(){}))}},{key:"setVisible",value:function(e){this.group.traverse((function(t){I.eachMaterial(t.material,(function(t){t.opacity=e?1:0}))}))}},{key:"dispose",value:function(){I.disposeObj(this.group)}}]),n}(Zt);function yn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=J()(e);if(t){var i=J()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return V()(this,n)}}var gn=function(e){F()(n,e);var t=yn(n);function n(e){var r,i=e.options,o=e.render;a()(this,n),(r=t.call(this)).render=o,r.init(i.config),i.loadEnd&&i.loadEnd();j()(r);return r.animate=function(e){},r}return u()(n,[{key:"setDefaultConfig",value:function(e){I.copy(e,{})}},{key:"disposeCompEft",value:function(){}},{key:"compEftInit",value:function(){console.log(I,this)}}]),n}(Zt),xn=function(){var e,t={defaultRadius:40,defaultRenderer:"canvas2d",defaultGradient:{.25:"rgb(0,0,255)",.55:"rgb(0,255,0)",.85:"yellow",1:"rgb(255,0,0)"},defaultMaxOpacity:1,defaultMinOpacity:0,defaultBlur:.85,defaultXField:"x",defaultYField:"y",defaultValueField:"value",plugins:{}},n=function(){var e=function(e){this._coordinator={},this._data=[],this._radi=[],this._min=10,this._max=1,this._xField=e.xField||e.defaultXField,this._yField=e.yField||e.defaultYField,this._valueField=e.valueField||e.defaultValueField,e.radius&&(this._cfgRadius=e.radius)},n=t.defaultRadius;return e.prototype={_organiseData:function(e,t){var r=e[this._xField],i=e[this._yField],o=this._radi,a=this._data,s=this._max,u=this._min,c=e[this._valueField]||1,l=e.radius||this._cfgRadius||n;a[r]||(a[r]=[],o[r]=[]),a[r][i]?a[r][i]+=c:(a[r][i]=c,o[r][i]=l);var h=a[r][i];return h>s?(t?this.setDataMax(h):this._max=h,!1):h<u?(t?this.setDataMin(h):this._min=h,!1):{x:r,y:i,value:c,radius:l,min:u,max:s}},_unOrganizeData:function(){var e=[],t=this._data,n=this._radi;for(var r in t)for(var i in t[r])e.push({x:r,y:i,radius:n[r][i],value:t[r][i]});return{min:this._min,max:this._max,data:e}},_onExtremaChange:function(){this._coordinator.emit("extremachange",{min:this._min,max:this._max})},addData:function(){if(arguments[0].length>0)for(var e=arguments[0],t=e.length;t--;)this.addData.call(this,e[t]);else{var n=this._organiseData(arguments[0],!0);n&&(0===this._data.length&&(this._min=this._max=n.value),this._coordinator.emit("renderpartial",{min:this._min,max:this._max,data:[n]}))}return this},setData:function(e){var t=e.data,n=t.length;this._data=[],this._radi=[];for(var r=0;r<n;r++)this._organiseData(t[r],!1);return this._max=e.max,this._min=e.min||0,this._onExtremaChange(),this._coordinator.emit("renderall",this._getInternalData()),this},removeData:function(){},setDataMax:function(e){return this._max=e,this._onExtremaChange(),this._coordinator.emit("renderall",this._getInternalData()),this},setDataMin:function(e){return this._min=e,this._onExtremaChange(),this._coordinator.emit("renderall",this._getInternalData()),this},setCoordinator:function(e){this._coordinator=e},_getInternalData:function(){return{max:this._max,min:this._min,data:this._data,radi:this._radi}},getData:function(){return this._unOrganizeData()}},e}(),r=function(){var e=function(e){var t=e.gradient||e.defaultGradient,n=document.createElement("canvas"),r=n.getContext("2d");n.width=256,n.height=1;var i=r.createLinearGradient(0,0,256,1);for(var o in t)i.addColorStop(o,t[o]);return r.fillStyle=i,r.fillRect(0,0,256,1),r.getImageData(0,0,256,1).data},t=function(e,t){var n=document.createElement("canvas"),r=n.getContext("2d"),i=e,o=e;if(n.width=n.height=2*e,1==t)r.beginPath(),r.arc(i,o,e,0,2*Math.PI,!1),r.fillStyle="rgba(0,0,0,1)",r.fill();else{var a=r.createRadialGradient(i,o,e*t,i,o,e);a.addColorStop(0,"rgba(0,0,0,1)"),a.addColorStop(1,"rgba(0,0,0,0)"),r.fillStyle=a,r.fillRect(0,0,2*e,2*e)}return n};function n(t){var n=t.container,r=this.shadowCanvas=document.createElement("canvas"),i=this.canvas=t.canvas||document.createElement("canvas"),o=(this._renderBoundaries=[1e4,1e4,0,0],getComputedStyle(t.container)||{});i.className="heatmap-canvas",this._width=i.width=r.width=t.width||+o.width.replace(/px/,""),this._height=i.height=r.height=t.height||+o.height.replace(/px/,""),this.shadowCtx=r.getContext("2d"),this.ctx=i.getContext("2d"),i.style.cssText=r.style.cssText="position:absolute;left:0;top:0;",n.style.position="relative",n.appendChild(i),this._palette=e(t),this._templates={},this._setStyles(t)}return n.prototype={renderPartial:function(e){e.data.length>0&&(this._drawAlpha(e),this._colorize())},renderAll:function(e){this._clear(),e.data.length>0&&(this._drawAlpha(function(e){for(var t=[],n=e.min,r=e.max,i=e.radi,o=(e=e.data,Object.keys(e)),a=o.length;a--;)for(var s=o[a],u=Object.keys(e[s]),c=u.length;c--;){var l=u[c],h=e[s][l],d=i[s][l];t.push({x:s,y:l,value:h,radius:d})}return{min:n,max:r,data:t}}(e)),this._colorize())},_updateGradient:function(t){this._palette=e(t)},updateConfig:function(e){e.gradient&&this._updateGradient(e),this._setStyles(e)},setDimensions:function(e,t){this._width=e,this._height=t,this.canvas.width=this.shadowCanvas.width=e,this.canvas.height=this.shadowCanvas.height=t},_clear:function(){this.shadowCtx.clearRect(0,0,this._width,this._height),this.ctx.clearRect(0,0,this._width,this._height)},_setStyles:function(e){this._blur=0==e.blur?0:e.blur||e.defaultBlur,e.backgroundColor&&(this.canvas.style.backgroundColor=e.backgroundColor),this._width=this.canvas.width=this.shadowCanvas.width=e.width||this._width,this._height=this.canvas.height=this.shadowCanvas.height=e.height||this._height,this._opacity=255*(e.opacity||0),this._maxOpacity=255*(e.maxOpacity||e.defaultMaxOpacity),this._minOpacity=255*(e.minOpacity||e.defaultMinOpacity),this._useGradientOpacity=!!e.useGradientOpacity},_drawAlpha:function(e){for(var n=this._min=e.min,r=this._max=e.max,i=(e=e.data||[]).length,o=1-this._blur;i--;){var a,s=e[i],u=s.x,c=s.y,l=s.radius,h=Math.min(s.value,r),d=u-l,p=c-l,f=this.shadowCtx;this._templates[l]?a=this._templates[l]:this._templates[l]=a=t(l,o);var v=(h-n)/(r-n);f.globalAlpha=v<.01?.01:v,f.drawImage(a,d,p),d<this._renderBoundaries[0]&&(this._renderBoundaries[0]=d),p<this._renderBoundaries[1]&&(this._renderBoundaries[1]=p),d+2*l>this._renderBoundaries[2]&&(this._renderBoundaries[2]=d+2*l),p+2*l>this._renderBoundaries[3]&&(this._renderBoundaries[3]=p+2*l)}},_colorize:function(){var e=this._renderBoundaries[0],t=this._renderBoundaries[1],n=this._renderBoundaries[2]-e,r=this._renderBoundaries[3]-t,i=this._width,o=this._height,a=this._opacity,s=this._maxOpacity,u=this._minOpacity,c=this._useGradientOpacity;e<0&&(e=0),t<0&&(t=0),e+n>i&&(n=i-e),t+r>o&&(r=o-t);for(var l=this.shadowCtx.getImageData(e,t,n,r),h=l.data,d=h.length,p=this._palette,f=3;f<d;f+=4){var v,m=h[f],y=4*m;if(y)v=a>0?a:m<s?m<u?u:m:s,h[f-3]=p[y],h[f-2]=p[y+1],h[f-1]=p[y+2],h[f]=c?p[y+3]:v}l.data.set(h),this.ctx.putImageData(l,e,t),this._renderBoundaries=[1e3,1e3,0,0]},getValueAt:function(e){var t=this.shadowCtx.getImageData(e.x,e.y,1,1).data[3],n=this._max,r=this._min;return Math.abs(n-r)*(t/255)>>0},getDataURL:function(){return this.canvas.toDataURL()}},n}(),i=(e=!1,"canvas2d"===t.defaultRenderer&&(e=r),e),o=function(){for(var e={},t=arguments.length,n=0;n<t;n++){var r=arguments[n];for(var i in r)e[i]=r[i]}return e},a=function(){var e=function(){function e(){this.cStore={}}return e.prototype={on:function(e,t,n){var r=this.cStore;r[e]||(r[e]=[]),r[e].push((function(e){return t.call(n,e)}))},emit:function(e,t){var n=this.cStore;if(n[e])for(var r=n[e].length,i=0;i<r;i++){(0,n[e][i])(t)}}},e}(),r=function(e){var t=e._renderer,n=e._coordinator,r=e._store;n.on("renderpartial",t.renderPartial,t),n.on("renderall",t.renderAll,t),n.on("extremachange",(function(t){e._config.onExtremaChange&&e._config.onExtremaChange({min:t.min,max:t.max,gradient:e._config.gradient||e._config.defaultGradient})})),r.setCoordinator(n)};function a(){var a=this._config=o(t,arguments[0]||{});if(this._coordinator=new e,a.plugin){var s=a.plugin;if(!t.plugins[s])throw new Error("Plugin '"+s+"' not found. Maybe it was not registered.");var u=t.plugins[s];this._renderer=new u.renderer(a),this._store=new u.store(a)}else this._renderer=new i(a),this._store=new n(a);r(this)}return a.prototype={addData:function(){return this._store.addData.apply(this._store,arguments),this},removeData:function(){return this._store.removeData&&this._store.removeData.apply(this._store,arguments),this},setData:function(){return this._store.setData.apply(this._store,arguments),this},setDataMax:function(){return this._store.setDataMax.apply(this._store,arguments),this},setDataMin:function(){return this._store.setDataMin.apply(this._store,arguments),this},configure:function(e){return this._config=o(this._config,e),this._renderer.updateConfig(this._config),this._coordinator.emit("renderall",this._store._getInternalData()),this},repaint:function(){return this._coordinator.emit("renderall",this._store._getInternalData()),this},getData:function(){return this._store.getData()},getDataURL:function(){return this._renderer.getDataURL()},getValueAt:function(e){return this._store.getValueAt?this._store.getValueAt(e):this._renderer.getValueAt?this._renderer.getValueAt(e):null}},a}();return{create:function(e){return new a(e)},register:function(e,n){t.plugins[e]=n}}}();function bn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=J()(e);if(t){var i=J()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return V()(this,n)}}var wn={HeatMapVShader:["\n        uniform float u_time;\n        uniform float u_opacity;\n        uniform float u_height;\n        uniform sampler2D u_shadow;\n\n        varying vec2 vUv;\n        varying float vShow;\n        varying vec4 vColor;\n\n        void main() {\n            vUv = uv;\n            vShow = texture2D(u_shadow, uv).w;\n            vec3 pos = vec3(position.x, vShow * u_height, position.z);\n            vColor = vec4(vec3(1.0), u_time * (2.0 - u_time) * u_opacity);\n            gl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1.0);\n        }\n    "].join("\n"),HeatMapFShader:["\n        uniform sampler2D u_txue;\n\n        varying vec2 vUv;\n        varying float vShow;\n        varying vec4 vColor;\n\n        void main() {\n            if (vShow < 0.00000001) discard;\n            // if (vShow < 0.00000001) gl_FragColor = vec4(1.0, 1.0, 1.0, 0.5);\n            else gl_FragColor = vColor * texture2D(u_txue, vUv);\n        }\n    "].join("\n")},Tn=function(e){F()(n,e);var t=bn(n);function n(e){var r,i=e.options,o=e.render;a()(this,n),(r=t.call(this)).render=o,r.init(i.config),i.loadEnd&&i.loadEnd();j()(r);return r.animate=function(e){},r}return u()(n,[{key:"onMouseOut",value:function(){}},{key:"onMouseIn",value:function(){}},{key:"onMouseUp",value:function(){}},{key:"onMouseDown",value:function(){}},{key:"setDefaultConfig",value:function(e){I.copy(e,{data:[],maximum:"auto",minimum:0,maxcolor:"#CC0000",mincolor:"#000033",height:8,opacity:.75,segments:200,blurRadius:20,offsetY:1,cameraP:{x:-150,y:200,z:300},visible:!1})}},{key:"disposeCompEft",value:function(){}},{key:"compEftInit",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.config.data,t=arguments.length>1?arguments[1]:void 0;this._heatMap&&I.disposeNode(this._heatMap),e&&e.length&&(t&&I.copy(this.config,t),this._heatMap=this.creatHeatMap(e,this.config),this.group.add(this._heatMap))}},{key:"creatHeatMap",value:function(e,t){var n=this.handleHMData(e,t);this.__HEATMap=xn.create({container:document.createElementNS("http://www.w3.org/1999/xhtml","div"),width:n.w,height:n.h,radius:t.blurRadius,gradient:t.__gradient}),this.__HEATMap.setData({min:t.minimum,max:t.maximum,data:n.heatmapData});var r=I.geo.plane(n.w,n.h,n.sw,n.sh);r.applyMatrix4(this.Matrix(-1));var i=new THREE.Texture(this.__HEATMap._renderer.shadowCanvas);i.needsUpdate=!0;var o=new THREE.Texture(this.__HEATMap._renderer.canvas);o.needsUpdate=!0;var a=new THREE.Mesh(r,I.mtl.shader({uniforms:{u_time:{value:t.visible?1:0},u_height:{value:t.height},u_opacity:{value:t.opacity},u_shadow:{value:i},u_txue:{value:o}},vertexShader:wn.HeatMapVShader,fragmentShader:wn.HeatMapFShader,transparent:!0,side:THREE.DoubleSide,depthWrite:!1}));return a.position.set(n.px,t.offsetY||0,n.py),a.renderOrder=7,a.name="heatMap",a._isHeatMap=!0,a}},{key:"handleHMData",value:function(e,t){var n,r,i,o=[[],e.length,t.basic[t.dataTans].vScale,t.basic[t.dataTans].center],a=o[0],s=o[2],u=o[3],c=1e8,l=-c,h=c,d=-c,p=c,f=-c,v=c;for(n=o[1]-1;n>=0;n--){var m=[e[n].vec,e[n].weight||0],y=m[0],g=m[1];r=(y[0]-u[0])*s,i=(y[1]-u[1])*s,l=l>r?l:r,h=h<r?h:r,d=d>i?d:i,p=p<i?p:i,f=f>g?f:g,v=v<g?v:g,a.push({x:r,y:i,value:g,radius:t.blurRadius})}this.handleColors(t,{nmax:f,nmin:v});var x=l-h,b=d-p,w=.5*(l+h),T=.5*(d+p),E=2*t.blurRadius,_=[THREE.Math.ceilPowerOfTwo(x+E),THREE.Math.ceilPowerOfTwo(b+E)],S=_[0],O=_[1],R=t.segments*(S>O?1:S/O),N=t.segments*(O>S?1:O/S);return a.forEach((function(e){e.x=e.x-h+.5*(S-x)|0,e.y=e.y-p+.5*(O-b)|0})),{heatmapData:a,w:S,h:O,px:w,py:T,sw:R,sh:N}}},{key:"Matrix",value:function(e){return(new THREE.Matrix4).makeRotationX(1.570796*e)}},{key:"handleColors",value:function(e,t){e.__gradient={};var n=[I.getColorArr(e.mincolor),I.getColorArr(e.maxcolor)],r=n[0],i=n[1];e.maximum="auto"===e.maximum?t.nmax:e.maximum,e.minimum="auto"===e.minimum?t.nmin:e.minimum;var o=[[],r[0].getHSL({h:0,s:0,l:0}),i[0].getHSL({h:0,s:0,l:0})],a=o[0],s=o[1],u=o[2],c=new THREE.Vector3(s.h,s.s,s.l),l=new THREE.Vector3(u.h,u.s,u.l),h=e.maximum-e.minimum;a.push(e.minimum,e.maximum),a.push(r[1],(i[1]-r[1])/h),a.push(c,l.sub(c).divideScalar(h)),e.__gradient[.25]=I.getRGBColor(r);var d=this.getRatioColors(a,.5*h);e.__gradient[.55]=I.getRGBColor(d),d=this.getRatioColors(a,.75*h),e.__gradient[.85]=I.getRGBColor(d),e.__gradient["1.0"]=I.getRGBColor(i)}},{key:"getRatioColors",value:function(e,t){var n=[],r=e[4].clone().add(e[5].clone().multiplyScalar(t)),i=I.color().setHSL(r.x,r.y,r.z);return n.push(i,e[2]+e[3]*t),n}},{key:"setShow",value:function(e,t){this._heatMap&&(e&&(this.tweenTims=e),this.setTestTween(this._heatMap.material.uniforms.u_time,{value:1},t),this.config.cameraP&&(this.tweenTims=800,this._currentPosition=this.render.camera.position.clone(),this.setTestTween(this.render.camera.position,this.config.cameraP)))}},{key:"setHide",value:function(e,t){this._heatMap&&(e&&(this.tweenTims=e),this.setTestTween(this._heatMap.material.uniforms.u_time,{value:0},t),this.config.cameraP&&this.setTestTween(this.render.camera.position,this._currentPosition))}},{key:"setConfig",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};switch(e){case"loade":this.compEftInit(t.data,t.config);break;case"hide":this.setHide(t.time,t.callback);break;case"show":this.setShow(t.time,t.callback)}}}]),n}(Zt);function En(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=J()(e);if(t){var i=J()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return V()(this,n)}}var _n="\n        precision lowp float;\n        varying vec2 vUv;\n        void main() {\n        vUv = uv;\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n        }",Sn="\n        precision mediump float;\n        uniform float time;\n        uniform vec3 color;\n        uniform float opacity;\n\n        varying vec2 vUv; // 正常纹理\n\n        float snoise(vec3 uv, float res) {\n        const vec3 s = vec3(1e0, 1e2, 1e3);\n\n        uv *= res;\n\n        vec3 uv0 = floor(mod(uv, res))*s;\n        vec3 uv1 = floor(mod(uv+vec3(1.), res))*s;\n\n        vec3 f = fract(uv);\n        f = f*f*(4.0-3.0*f);\n\n        vec4 v = vec4(uv0.x+uv0.y+uv0.z, uv1.x+uv0.y+uv0.z, uv0.x+uv1.y+uv0.z, uv1.x+uv1.y+uv0.z);\n        vec4 r = fract(sin(v*1e-1)*1e3);\n        float r0 = mix(mix(r.x, r.y, f.x), mix(r.z, r.w, f.x), f.y);\n\n        r = fract(sin((v + uv1.z - uv0.z)*1e-1)*1e3);\n        float r1 = mix(mix(r.x, r.y, f.x), mix(r.z, r.w, f.x), f.y);\n\n        return mix(r0, r1, f.z)*2.-1.;\n        }\n\n        void main() {\n\n        vec2 p = vec2(-0.5 + vUv.x, (1. - vUv.y)*0.4);\n\n        float aColor = 3. - (6.*p.y );\n\n        vec3 coord = vec3(atan(p.x, p.y)/6.2832+.5, length(p)*.4, .5);\n        coord = 1.0 - coord;\n\n        for(int i = 1; i <= 3; i++) {\n            float power = pow(2.0, float(i));\n            aColor += (0.4 / power) * snoise(coord + vec3(.0, -time*.04, time*.03), power*16.);\n        }\n        aColor = 1.0 - aColor;\n        aColor *= 2.7;\n        aColor *= smoothstep(0.43, 0.4, p.y);\n\n        gl_FragColor = vec4(vec3(aColor), aColor) * vec4(color, opacity * 0.22);\n\n        // gl_FragColor = vec4(aColor, pow(max(aColor,0.),2.)*0.4, pow(max(aColor,0.),3.)*0.15 , aColor);\n        }",On=function(e){F()(n,e);var t=En(n);function n(e){var r,i=e.options,o=e.render;a()(this,n),(r=t.call(this)).aTime={value:0},r.aOpacity={value:0},r.render=o,r.init(i.config);var s=j()(r),u=0;return r.animate=function(e){u<4&&(u+=e,s.aOpacity.value=u/4),s.aTime.value+=e},i.loadEnd&&i.loadEnd(),r}return u()(n,[{key:"onMouseOut",value:function(){}},{key:"onMouseIn",value:function(){}},{key:"onMouseUp",value:function(){}},{key:"onMouseDown",value:function(){}},{key:"setDefaultConfig",value:function(e){I.copy(e,{fire:[]})}},{key:"disposeCompEft",value:function(){}},{key:"compEftInit",value:function(){this.creatEft()}},{key:"creatEft",value:function(){var e=this;this.config.fire.forEach((function(t){var n=t.radius,r=t.height,i=t.seg,o=t.points,a=(t.rotation,I.geo.cylinder(n,n,r,i,!0));e.updateGeometry(a,n);var s=e.getMaterial(t);o.forEach((function(t){var n=new THREE.Mesh(a,s);n.position.fromArray(t,0),n.rotation.set(0,.8,0),n.renderOrder=22,e.group.add(n)}))}))}},{key:"updateGeometry",value:function(e,t){for(var n=e.attributes.position,r=e.attributes.uv,i=0,o=n.count;i<o;i++){var a=(n.getX(i)/t+1)/2;r.setX(i,a)}}},{key:"getMaterial",value:function(e){var t=e.color,n={time:this.aTime,opacity:this.aOpacity,color:{value:I.color(t)}};return I.mtl.shader({uniforms:n,blending:THREE.AdditiveBlending,transparent:!0,side:THREE.DoubleSide,depthWrite:!1,vertexShader:_n,fragmentShader:Sn})}}]),n}(Zt);function Rn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=J()(e);if(t){var i=J()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return V()(this,n)}}var Nn={RoadVShader:["\n        uniform float uTime;\n        uniform float uTime2;\n        uniform vec4 uColor;\n        uniform vec3 uRatio;\n\n        attribute vec4 cRatio;\n        attribute vec4 cColor;\n\n        varying vec4 vColor;\n        varying vec3 vUv;\n\n        const float PI = 3.14159265359;\n        void main() {\n            vUv = vec3(uv, cRatio.w);\n            vColor = uColor * cColor;\n            vec4 mP = modelViewMatrix * vec4(position + cRatio.xyz * uRatio.z, 1.0);\n            gl_Position = projectionMatrix * mP;\n        }"].join("\n"),RoadFShader:["\n        uniform float uTime;\n        uniform float uTime2;\n        uniform vec3 uRatio;\n        uniform sampler2D uTxue;\n\n        varying vec4 vColor;\n        varying vec3 vUv;\n        const float PI = 3.14159265359;\n        void main() {\n            float c = 1.0 * uTime2;\n            if (uTime > 0.0 && uRatio.y > 0.0 && vUv.z > 0.0) {\n                float k = uTime - vUv.z; c = 0.0;\n                float ma = (k <= 0.0 ? k + 1.0 : k) * (1.0 + uRatio.x);\n                if (vUv.x > ma - uRatio.x && vUv.x < ma) {\n                    c = 2.5 * sin(PI * (vUv.x - ma + uRatio.x) / uRatio.x);\n                }\n            }\n            gl_FragColor = vec4(vColor.xyz, vColor.w * (0.2 + c)) * texture2D(uTxue, vUv.xy);\n        }"].join("\n")};function Cn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=J()(e);if(t){var i=J()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return V()(this,n)}}function Mn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=J()(e);if(t){var i=J()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return V()(this,n)}}function Dn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=J()(e);if(t){var i=J()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return V()(this,n)}}var Pn="\n        uniform float time;\n        uniform float delta;\n\n        void main() {\n            vec2 uv = gl_FragCoord.xy / resolution.xy;\n            vec4 tmpPos = texture2D(txuePos, uv);\n            vec3 velocity = texture2D(txueVlt, uv).xyz;\n\n            float phase = mod((tmpPos.w + delta +\n                length(velocity.xz) * delta * 3. +\n                max(velocity.y, 0.0) * delta * 6.), 62.83);\n\n            gl_FragColor = vec4(tmpPos.xyz + velocity * delta * 15., phase);\n        }\n    ",Ln="\n        uniform float time;\n        uniform float testing;\n        uniform float delta; // about 0.016\n        uniform float separationD; // 20\n        uniform float alignmentD; // 40\n        uniform float cohesionD; //\n        // uniform float freedomF;\n        uniform vec3 predator;\n\n        const float width = resolution.x;\n        const float height = resolution.y;\n\n        const float PI = 3.141592653589793;\n        const float PI_2 = PI * 2.0;\n\n        const float SPEED_LIMIT = 9.0;\n\n        float rand(vec2 co){\n            return fract(sin(dot(co.xy, vec2(12.9898,78.233))) * 43758.5453);\n        }\n\n        void main() {\n\n            float zoneRadius = radius * (separationD + alignmentD + cohesionD);\n            float separationThresh = separationD / zoneRadius;\n            float alignmentThresh = (separationD + alignmentD) / zoneRadius;\n            float zoneRadiusSquared = zoneRadius * zoneRadius;\n\n            float separationSquared = separationD * separationD;\n            float cohesionSquared = cohesionD * cohesionD;\n\n            vec2 uv = gl_FragCoord.xy / resolution.xy;\n\n            vec3 selfPosition = texture2D(txuePos, uv).xyz; // -- position\n            vec3 selfVelocity = texture2D(txueVlt, uv).xyz;\n\n            float dist, distSquared, f, percent, limit = SPEED_LIMIT;;\n            vec3 dir = predator - selfPosition, velocity = selfVelocity; // -- dir - direction\n\n            dist = length(dir);\n            distSquared = dist * dist;\n\n            float preyRadiusSq = preyRadius * preyRadius;\n\n            // -- move birds away from predator\n            if (isPrey > 0.0 && dist < preyRadius) {\n                f = (distSquared / preyRadiusSq - 1.0) * delta * 100.;\n                velocity += normalize( dir ) * f;\n                limit += 5.0;\n            }\n\n            // -- Attract flocks to the center\n            // vec3 central = vec3(510.0, 370.0, 0.);\n            dir = selfPosition - central;\n            dist = length(dir);\n\n            dir.y *= 2.5;\n            velocity -= normalize(dir) * delta * 5.;\n\n            vec3 birdPosition, birdVelocity;\n            for (float y = 0.0; y < height; y++) {\n                for (float x = 0.0; x < width; x++) {\n\n                    vec2 ref = vec2(x + 0.5, y + 0.5) / resolution.xy;\n                    birdPosition = texture2D(txuePos, ref).xyz;\n\n                    dir = birdPosition - selfPosition;\n                    dist = length(dir);\n\n                    if (dist < 0.0001) continue;\n\n                    distSquared = dist * dist;\n\n                    if (distSquared > zoneRadiusSquared) continue;\n\n                    percent = distSquared / zoneRadiusSquared;\n\n                    if (percent < separationThresh) { // low\n                        // -- Separation - Move apart for comfort\n                        f = (separationThresh / percent - 1.0) * delta;\n                        velocity -= normalize(dir) * f;\n\n                    } else if (percent < alignmentThresh) { // high\n                        // -- Alignment - fly the same direction\n                        float threshDelta = alignmentThresh - separationThresh;\n                        float adjustedPercent = (percent - separationThresh) / threshDelta;\n\n                        birdVelocity = texture2D(txueVlt, ref).xyz;\n\n                        f = (0.5 - cos(adjustedPercent * PI_2) * 0.5 + 0.5) * delta;\n                        velocity += normalize(birdVelocity) * f;\n\n                    } else {\n                        // -- Attraction / Cohesion - move closer\n                        float threshDelta = 1.0 - alignmentThresh;\n                        float adjustedPercent;\n                        if(threshDelta == 0.) adjustedPercent = 1.;\n                        else adjustedPercent = (percent - alignmentThresh) / threshDelta;\n\n                        f = (0.5 - (cos(adjustedPercent * PI_2) * -0.5 + 0.5)) * delta;\n\n                        velocity += normalize(dir) * f;\n                    }\n                }\n            }\n\n            // -- this make tends to fly around than down or up\n            // if (velocity.y > 0.) velocity.y *= (1. - 0.2 * delta);\n\n            // -- Speed Limits\n            if (length(velocity) > limit) {\n                velocity = normalize(velocity) * limit;\n            }\n\n            gl_FragColor = vec4(velocity, 1.0);\n        }\n    ",kn={LoaderModel:tn,CameraAnimate:on,InstanceMesh:mn,GlowsEft:gn,HtMapEft:Tn,FencesEft:On,FlowsEft:function(e){F()(n,e);var t=Rn(n);function n(e){var r,i=e.options,o=e.render;a()(this,n),(r=t.call(this)).render=o,r.init(i.config);var s=j()(r);return i.loadEnd&&i.loadEnd(),i.created&&i.created(r.group),r.animate=function(e){var t=s._flowObj;t&&t._isFlows&&(t._isInit||s.nodeAmtFunc(e,t,(function(){t._isInit=!0}),"_transTimes1","_initTime","uTime2"),s.nodeAmtFunc(e,t))},r}return u()(n,[{key:"onMouseOut",value:function(){}},{key:"onMouseIn",value:function(){}},{key:"onMouseUp",value:function(){}},{key:"onMouseDown",value:function(){}},{key:"setDefaultConfig",value:function(e){I.copy(e,{data:[],offsetY:1,initTime:2,lightTime:1,effectLen:1e3,isLight:!1,mtl:{width:2,effectRatio:.8,color:"rgba(204, 204, 255, 0.5)",txue:""},colors:["rgba(102, 153, 255, 0.9)","rgba(255, 255, 102, 0.9)"]})}},{key:"disposeCompEft",value:function(){}},{key:"compEftInit",value:function(){this._flowObj&&I.disposeNode(this._flowObj);var e=this.config.data;e&&e.length&&(this._flowObj=this.creatRoads(e,this.config),this.group.add(this._flowObj))}},{key:"creatRoads",value:function(e,t){for(var n=[I.geo.buf(),t.dataTans,t.basic],r=n[0],i=n[1],o=n[2],a=n[3],s=void 0===a?o[i].vScale:a,u=n[4],c=void 0===u?o[i].center:u,l={l_indices:[],ofs:0,l_position:[],l_color:[],l_uvs:[],l_ratio:[]},h={effectLen:t.effectLen,_colorArr:this.handleColor(t.colors)},d=e.length-1;d>=0;d--){var p=this.handleArray(e[d],s,c,!1,!0);this.roadsBuffer(p,l,h)}r.setIndex(l.l_indices),r.setAttribute("uv",new THREE.Float32BufferAttribute(l.l_uvs,2)),r.setAttribute("cColor",new THREE.Float32BufferAttribute(l.l_color,4)),r.setAttribute("cRatio",new THREE.Float32BufferAttribute(l.l_ratio,4)),r.setAttribute("position",new THREE.Float32BufferAttribute(l.l_position,3)),t.mtl.isEffect=t.isLight;var f=new THREE.Mesh(r,this.roadsMtl(t.mtl));return f.position.y=t.offsetY||0,f.renderOrder=t.renderOrder||0,f.name="flowsEft",f._isInit=!1,f._transTimes=0,f._transTimes1=0,f._isFlows=t.isLight,f._initTime=t.initTime-0,f._perTimes=t.lightTime*(1+.3*Math.random()),f}},{key:"handleArray",value:function(e,t,n,r,i){for(var o,a,s=[],u=0,c=-1/0,l=1/0,h=-1/0,d=1/0,p=this.vec2StartEnd(e,r),f=p.vlen-1;f>=0;f--)e[f][0]=o=(e[f][0]-n[0])*t,e[f][1]=a=(e[f][1]-n[1])*t,r&&f===p.vlen-1||s.push([o,a]),i&&f>0&&(u+=this.vec2Distance(e[f],e[f-1])),r&&(c=c>o?c:o,l=l<o?l:o,h=h>a?h:a,d=d<a?d:a);return{x:l,y:d,w:c-l,h:h-d,l:p.vlen,vec2s:s,dtc:u}}},{key:"vec2StartEnd",value:function(e,t){var n=e.length,r=!1,i=e[0],o=e[n-1];return!t||o[0]===i[0]&&o[1]===i[1]||(e.push([i[0],i[1]]),r=!0),{change:r,vlen:n=r?e.length:n}}},{key:"vec2Distance",value:function(e,t){var n=e[0]-t[0],r=e[1]-t[1];return Math.sqrt(n*n+r*r)}},{key:"roadsMtl",value:function(e){var t=[I.getColorArr(e.color),this.uVector3(e.effectRatio,e.isEffect?1:-1,e.width)],n=t[0],r=t[1];return I.mtl.shader({uniforms:{uTime:{value:0},uTime2:{value:0},uRatio:{value:r},uColor:{value:this.uColor(n)},uTxue:{value:this.render.getTxue(e.txue)}},transparent:!0,depthWrite:!1,side:THREE.BackSide,polygonOffset:!0,polygonOffsetUnits:3,polygonOffsetFactor:.6,blending:THREE.AdditiveBlending,vertexShader:Nn.RoadVShader,fragmentShader:Nn.RoadFShader})}},{key:"uVector3",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.length>1?(t[2]=t[2]||0,new THREE.Vector3(t[0],t[1],t[2])):(new THREE.Vector3).copy(t[0])}},{key:"uColor",value:function(e){return new THREE.Vector4(e[0].r,e[0].g,e[0].b,e[1])}},{key:"roadsBuffer",value:function(e,t,n){for(var r=[Math.random(),this.getPathInfo([e.vec2s],!1,!0,!1)],i=r[0],o=r[1],a=[o.vertices,o.beveling,this.getArri(n._colorArr,i),e.dtc>n.effectLen?i:-1],s=a[0],u=a[1],c=a[2],l=a[3],h=e.l-1;h>=0;h--){var d=[h/(e.l-1),2*h],p=d[0],f=d[1],v=d[2],m=void 0===v?f+1:v;t.l_uvs.push(p,1,p,0),this.pushColor(t.l_color,c,c),t.l_position.push(s[f],0,s[m],s[f],0,s[m]),t.l_ratio.push(u[f],.4,u[m],l,-u[f],.4,-u[m],l),h<e.l-1&&this.sideIndices(t.l_indices,h,t.ofs)}t.ofs+=2*e.l}},{key:"getArri",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.random();return e[e.length*t|0]}},{key:"setShow",value:function(e,t){this._flowObj&&(e&&(this.tweenTims=e),this.setTestTween(this._flowObj.material.uniforms.uTime,{value:1},t))}},{key:"setHide",value:function(e,t){this._flowObj&&(e&&(this.tweenTims=e),this.setTestTween(this._flowObj.material.uniforms.uTime,{value:0},t))}},{key:"setConfig",value:function(e,t){switch(e){case"hide":this.setHide(t.time,t.callback);break;case"show":this.setShow(t.time,t.callback)}}}]),n}(Zt),FlyEffect:function(e){F()(n,e);var t=Cn(n);function n(e){var r,o=e.options,s=e.render;return a()(this,n),r=t.call(this),i()(j()(r),"animate",(function(e){r.time.value+=e})),r.render=s,r.init(o.config),r.time={value:0},o.created&&o.created(r.group),r.effectInit().then((function(){o.mounted&&o.mounted(r.group),o.loadEnd&&o.loadEnd()})),r}return u()(n,[{key:"effectInit",value:function(){var e=this;return new Promise((function(t,n){try{e.baseInit(),t()}catch(e){n(e)}})).catch((function(){}))}},{key:"baseInit",value:function(){var e=this,t=this.config,n=t.data,r=t.dpi,i=t.color,o=t.range,a=void 0===o?100:o,s=t.size,u=void 0===s?10:s,c=t.point,l=t.speed,h=void 0===l?1:l,d=t.renderOrder,p=t.visible,f=void 0===p||p;n.forEach((function(t){var n=e.tranformPath(t.data,r),o=e.createPoint({data:n,color:new THREE.Color(i),range:a,size:u,speed:h,point:e.render.Txues.getTxue(c)});e.group.add(o),o.renderOrder=d})),this.group.visible=f}},{key:"createPoint",value:function(e){var t=e.data,n=e.color,r=e.range,i=void 0===r?100:r,o=e.size,a=void 0===o?10:o,s=e.point,u=e.speed,c=[],l=[];t.forEach((function(e,t){c.push(e.x,e.y,e.z),l.push(t)}));var h=new THREE.BufferGeometry;h.setAttribute("position",new THREE.Float32BufferAttribute(c,3)),h.setAttribute("index",new THREE.Float32BufferAttribute(l,1));var d=new THREE.ShaderMaterial({transparent:!0,depthWrite:!1,blending:THREE.AdditiveBlending,uniforms:{uColor:{value:n},uRange:{value:i},uSize:{value:a},uSpeed:{value:u},uTotal:{value:t.length},uMap:{value:s},time:this.time},vertexShader:"\n        attribute float index;\n        uniform float time;\n        uniform float uSize;\n        uniform float uRange; // 展示区间\n        uniform float uTotal; // 粒子总数\n        uniform vec3 uColor; \n        varying vec3 vColor;\n        varying float vOpacity;\n        uniform float uSpeed;\n        void main() {\n            // 需要当前显示的索引\n            float size = uSize;\n            float showNumber = uTotal * mod(time, 1.1);\n            float tindex = mod(time * uSpeed, uTotal);\n\n            vColor = uColor;\n            if (tindex > index && tindex < index + uRange) {\n                float ts = (index + uRange - tindex) / uRange;\n                size *= ts;\n                vOpacity = 1.0;\n            } else {\n                vOpacity = 0.0;\n                size = 0.0;\n            }\n\n            // 顶点着色器计算后的Position\n            vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n            gl_Position = projectionMatrix * mvPosition; \n            // 大小\n            gl_PointSize = size * 300.0 / (-mvPosition.z);\n        }",fragmentShader:"\n        uniform sampler2D uMap;\n        uniform vec3 uColor;\n        varying float vOpacity;\n        void main() {\n            gl_FragColor = vec4(uColor, vOpacity) * texture2D(uMap, vec2(gl_PointCoord.x, 1.0 - gl_PointCoord.y));\n        }"});return new THREE.Points(h,d)}},{key:"setVisible",value:function(e){this.group.visible=!!e}},{key:"tranformPath",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=[],r=1;r<e.length;r++)for(var i=e[r-1],o=e[r],a=new THREE.Vector3(i.x,i.y,i.z),s=new THREE.Vector3(o.x,o.y,o.z),u=a.distanceTo(s)*t,c=Math.round(u),l=0;l<=c;l++)n.push(a.clone().lerp(s,l/c));return n}},{key:"dispose",value:function(){}}]),n}(Zt),SwitchAnimate:function(e){F()(n,e);var t=Mn(n);function n(e){var r,o=e.options,s=e.render;return a()(this,n),r=t.call(this,{options:o,render:s}),i()(j()(r),"animate",(function(e){var t=r.renderers.camera.userData,n=t.path,i=t.perTimes,o=void 0===i?0:i,a=t.transTimes,s=void 0===a?0:a,u=t.animateEnd,c=void 0!==u&&u;if(r.isStart)if(s<=o+e){var l=Math.min(1,s/o),h=n.getPointAt(l*l);r.renderers.camera.position.copy(h),r.renderers.camera.userData.transTimes+=e,l>.9&&(r.group.traverse((function(e){e.material&&e._opacity&&(e.material.uniforms?e.material.uniforms.u_opacity.value=e._opacity*(1-l)*10:e.material.opacity=e._opacity*(1-l)*10)})),r.isEffectEnd||(r.isEffectEnd=!0,r.options.mounted&&r.options.mounted()))}else c||(r.renderers.camera.userData.animateEnd=!0,r.eftEnd&&r.eftEnd())})),r.renderers=s,r.init(o.config),r.options=o,r.eftEnd=o.eftEnd,r.isEffectEnd=!1,r.isStart=o.config.start||!1,o.created&&o.created(),r.effectInit().then((function(){o.loadEnd&&o.loadEnd()})),r}return u()(n,[{key:"effectInit",value:function(){var e=this;return new Promise((function(t,n){try{e.baseInit(),t()}catch(e){n(e)}}))}},{key:"baseInit",value:function(){var e=this.config,t=e.earth,n=void 0===t?{}:t,r=e.defaultPosition,i=void 0===r?{x:0,y:0,z:0}:r,o=n.radius,a=void 0===o?100:o,s=new THREE.SphereBufferGeometry(a,64,64),u=new THREE.MeshStandardMaterial({color:16777215,roughness:1,metalness:0,side:THREE.DoubleSide,map:this.renderers.getTxue("em_color"),normalMap:this.renderers.getTxue("em_normal"),normalScale:new THREE.Vector2(1,-1),displacementMap:this.renderers.getTxue("em_display"),displacementScale:.5,aoMap:this.renderers.getTxue("em_aomap"),aoMapIntensity:1,transparent:!0}),c=new THREE.Mesh(s,u);c._isSphere=!0,c._opacity=1,this.group.add(c);var l=new THREE.Mesh(s,new THREE.MeshLambertMaterial({blending:THREE.AdditiveBlending,map:this.renderers.getTxue("em_cloud"),transparent:!0,depthWrite:!1,opacity:.3}));l.scale.setScalar(1.05),l._isClouds=!0,l._opacity=.3,this.group.add(l),c.position.copy(i),this.renderers.camera.userData.lastPosition=this.renderers.camera.position.clone(),this.renderers.camera.userData.path=new THREE.CatmullRomCurve3([new THREE.Vector3(40,12,-7),new THREE.Vector3(20,13,-36),new THREE.Vector3(-4,13,-41),new THREE.Vector3(-5,26,-34),new THREE.Vector3(-1,7,-9)]),this.renderers.camera.userData.perTimes=5,this.renderers.camera.userData.transTimes=0}},{key:"start",value:function(){this.isStart=!0}},{key:"repeatOnce",value:function(){this.isEffectEnd=!1,this.renderers.camera.userData.perTimes=5,this.renderers.camera.userData.transTimes=0,this.renderers.camera.userData.animateEnd=!1,this.renderers.camera.position.copy(this.renderers.camera.userData.lastPosition),this.group.traverse((function(e){e.material&&e._opacity&&(e.material.uniforms?e.material.uniforms.u_opacity.value=e._opacity:e.material.opacity=e._opacity)}))}},{key:"dispose",value:function(){this.isStart=!1,I.disposeObj(this.group)}}]),n}(Zt),FlyerEft:function(e){F()(n,e);var t=Dn(n);function n(e){var r,i=e.options,o=e.render;a()(this,n),(r=t.call(this)).render=o,r.init(i.config),r.isShow=!0;var s=j()(r);i.loadEnd&&i.loadEnd(),i.created&&i.created(r.group);var u=performance.now();return r.animate=function(e){if(u+=1e3*e,s.isShow&&s.gpuCompt){if(s.posUnifms.delta.value=e,s.posUnifms.time.value=u,s.vltUnifms.delta.value=e,s.vltUnifms.time.value=u,s.config.isPrey){var t=s.config.center.y,n=I.transPosition(s.render._Events._Mouse2,t,s.render);s.vltUnifms.predator.value.copy(n)}s.mtlShader&&(s.mtlShader.uniforms.delta.value=e,s.mtlShader.uniforms.time.value=u/1e3),s.gpuCompt.compute(),s.mtlShader&&(s.mtlShader.uniforms.txuePos.value=s.gpuCompt.getCurrentRenderTarget(s.posVarib).texture,s.mtlShader.uniforms.txueVlt.value=s.gpuCompt.getCurrentRenderTarget(s.vltVarib).texture)}},r}return u()(n,[{key:"onMouseOut",value:function(){}},{key:"onMouseIn",value:function(){}},{key:"onMouseUp",value:function(){}},{key:"onMouseDown",value:function(){}},{key:"setDefaultConfig",value:function(e){I.copy(e,{url:"",size:.1,width:16,count:.6,center:{x:500,y:300,z:0},radius:.7,isPrey:!0,preyRadius:400,cohesion:20,alignment:20,separation:20,scopeR:{x:1,y:.2,z:1}})}},{key:"disposeCompEft",value:function(){this.gpuCompt=null}},{key:"compEftInit",value:function(){console.log(this);var e=this.config;this.WIDTH=e.width,this.COUMT=e.count,this.BIRDS=this.WIDTH*this.WIDTH,this.BirdGeo=I.geo.buf(),this.loadeBirds(e),this.computeRender(e)}},{key:"nextPowerOf2",value:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.log(2)))}},{key:"lerp",value:function(e,t,n){return e+(t-e)*(n=Math.max(Math.min(n,1),0))}},{key:"loadeBirds",value:function(e){var t=this;(new THREE.GLTFLoader).load(e.url,(function(n){for(var r=[n.animations,n.scene.children[0].geometry],i=r[0],o=r[1],a=o.getAttribute("position"),s=a.count,u=Math.round(60*i[0].duration),c=o.morphAttributes.position,l=[t.nextPowerOf2(u),t.nextPowerOf2(s)],h=l[0],d=l[1],p=new Float32Array(3*d*h),f=0;f<d;f++)for(var v=0;v<h;v++){var m=v*d*3,y=Math.floor(v/u*c.length),g=(Math.floor(v/u*c.length)+1)%c.length,x=v/u*c.length%1;if(v<u){var b=void 0,w=void 0;b=c[y].array[3*f],w=c[g].array[3*f],void 0!==b&&void 0!==w&&(p[m+3*f]=t.lerp(b,w,x)),b=c[y].array[3*f+1],w=c[g].array[3*f+1],void 0!==b&&void 0!==w&&(p[m+3*f+1]=t.lerp(b,w,x)),b=c[y].array[3*f+2],w=c[g].array[3*f+2],void 0!==b&&void 0!==w&&(p[m+3*f+2]=t.lerp(b,w,x))}}t.txueAmt=new THREE.DataTexture(p,d,h,THREE.RGBFormat,THREE.FloatType),t.txueAmt.needsUpdate=!0;for(var T=[],E=[],_=[],S=[],O=[],R=0;R<3*s*t.BIRDS;R++){var N=R%(3*s);T.push(a.array[N]),E.push(o.getAttribute("color").array[N])}Math.random();for(var C=0;C<s*t.BIRDS;C++){var M=C%s,D=Math.floor(C/s);0==M&&Math.random();var P=~~D,L=P%t.WIDTH/t.WIDTH,k=~~(P/t.WIDTH)/t.WIDTH;_.push(L,k,M/d,u/h),S.push(D,Math.random())}for(var I=[o.index.array],A=I[0],j=I[1],H=void 0===j?A.length:j,F=0;F<H*t.BIRDS;F++){var z=Math.floor(F/H)*s;O.push(A[F%H]+z)}t.BirdGeo.setAttribute("color",new THREE.Float32BufferAttribute(E,3)),t.BirdGeo.setAttribute("seeds",new THREE.Float32BufferAttribute(S,2)),t.BirdGeo.setAttribute("position",new THREE.Float32BufferAttribute(T,3)),t.BirdGeo.setAttribute("reference",new THREE.Float32BufferAttribute(_,4)),t.BirdGeo.setIndex(O);var V=t.BIRDS*t.COUMT|0;t.BirdGeo.setDrawRange(0,3*s*V),t.initBirds(e)}))}},{key:"fillTxue",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n=e.image.data,r=0,i=n.length;r<i;r+=4){var o=Math.random()-.5,a=Math.random()-.5,s=Math.random()-.5;n[r+0]=o*t,n[r+1]=a*t,n[r+2]=s*t,n[r+3]=1}}},{key:"computeRender",value:function(e){this.gpuCompt=new THREE.GPUComputationRenderer(this.WIDTH,this.WIDTH,this.render.renderer);var t=this.gpuCompt.createTexture(),n=this.gpuCompt.createTexture();this.fillTxue(t,100),this.fillTxue(n,10),this.vltVarib=this.gpuCompt.addVariable("txueVlt",Ln,n),this.posVarib=this.gpuCompt.addVariable("txuePos",Pn,t),this.gpuCompt.setVariableDependencies(this.vltVarib,[this.posVarib,this.vltVarib]),this.gpuCompt.setVariableDependencies(this.posVarib,[this.posVarib,this.vltVarib]),this.posUnifms=this.posVarib.material.uniforms,this.vltUnifms=this.vltVarib.material.uniforms,this.posUnifms.time={value:0},this.posUnifms.delta={value:0},this.vltUnifms.time={value:1},this.vltUnifms.delta={value:0},this.vltUnifms.testing={value:1},this.vltUnifms.cohesionD={value:e.cohesion},this.vltUnifms.alignmentD={value:e.alignment},this.vltUnifms.separationD={value:e.separation},this.vltUnifms.predator={value:new THREE.Vector3};var r=e.center;this.vltVarib.material.defines.central="vec3(".concat(r.x.toFixed(1),", ").concat(r.y.toFixed(1),", ").concat(r.z.toFixed(1),")"),this.vltVarib.material.defines.radius=e.radius.toFixed(2),this.vltVarib.material.defines.isPrey=(e.isPrey?1:-1).toFixed(2),this.vltVarib.material.defines.preyRadius=e.preyRadius.toFixed(2),this.vltVarib.wrapS=THREE.RepeatWrapping,this.vltVarib.wrapT=THREE.RepeatWrapping,this.posVarib.wrapS=THREE.RepeatWrapping,this.posVarib.wrapT=THREE.RepeatWrapping;var i=this.gpuCompt.init();null!==i&&console.error(i)}},{key:"initBirds",value:function(e){var t=this,n=I.mtl.standard({vertexColors:!0,flatShading:!0,roughness:1,metalness:0,transparent:!0}),r=e.scopeR;n.defines.scopeR="vec3(".concat(r.x.toFixed(1),", ").concat(r.y.toFixed(1),", ").concat(r.z.toFixed(1),")"),n.onBeforeCompile=function(n){n.uniforms.txuePos={value:null},n.uniforms.txueVlt={value:null},n.uniforms.txueAmt={value:t.txueAmt},n.uniforms.time={value:1},n.uniforms.size={value:e.size},n.uniforms.delta={value:0},n.uniforms.uTime={value:0},t.isShow=!1;var r="#define STANDARD",i="\n                attribute vec4 reference;\n                attribute vec2 seeds;\n                // attribute vec3 birdColor;\n                uniform sampler2D txuePos;\n                uniform sampler2D txueVlt;\n                uniform sampler2D txueAmt;\n                uniform float size;\n                uniform float time;\n            ";n.vertexShader=n.vertexShader.replace(r,r+i),r="#include <begin_vertex>",i="\n                vec4 tmpPos = texture2D(txuePos, reference.xy);\n                vec3 pos = tmpPos.xyz * scopeR;\n\n                vec3 velocity = normalize(texture2D(txueVlt, reference.xy).xyz);\n                vec3 v3 = seeds.x * (0.0004 + seeds.y / 10000.0 + velocity / 20000.0);\n                vec3 aniPos = texture2D(txueAmt, vec2(reference.z, mod(time + v3, reference.w))).xyz;\n\n                vec3 newPosition = position;\n\n                newPosition = mat3(modelMatrix) * (newPosition + aniPos);\n                newPosition *= size + seeds.y * size * 0.2;\n\n                velocity.z *= -1.;\n                float xz = length(velocity.xz);\n                float xyz = 1.;\n                float x = sqrt(1. - velocity.y * velocity.y);\n\n                float cosry = velocity.x / xz;\n                float sinry = velocity.z / xz;\n\n                float cosrz = x / xyz;\n                float sinrz = scopeR.y * velocity.y / xyz;\n\n                mat3 maty =  mat3(cosry, 0, -sinry, 0, 1, 0, sinry, 0, cosry);\n                mat3 matz =  mat3(cosrz, sinrz, 0, -sinrz, cosrz, 0, 0, 0, 1);\n\n                newPosition = maty * matz * newPosition;\n                newPosition += pos;\n\n                vec3 transformed = vec3(newPosition);\n            ",n.vertexShader=n.vertexShader.replace(r,i),r="#define STANDARD",i="\nuniform float uTime;",n.fragmentShader=n.fragmentShader.replace(r,r+i),r="#include <dithering_fragment>",i="\ngl_FragColor *= vec4(1.0, 1.0, 1.0, uTime);",n.fragmentShader=n.fragmentShader.replace(r,r+i),t.mtlShader=n};var i=new THREE.Mesh(this.BirdGeo,n);i.castShadow=!0,i.receiveShadow=!0,i.rotation.y=Math.PI/2,this.group.add(i)}},{key:"setShow",value:function(e,t){this.mtlShader&&(e&&(this.tweenTims=e),this.isShow=!0,this.setTestTween(this.mtlShader.uniforms.uTime,{value:1},t))}},{key:"setHide",value:function(e,t){var n=this;this.mtlShader&&(e&&(this.tweenTims=e),this.setTestTween(this.mtlShader.uniforms.uTime,{value:0},(function(){n.isShow=!1,t&&t()})))}},{key:"setConfig",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};switch(e){case"hide":this.setHide(t.time,t.callback);break;case"show":this.setShow(t.time,t.callback)}}}]),n}(Zt),pointTips:fn};function In(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var An=new WeakMap,jn=new WeakMap,Hn=function(){function e(){a()(this,e),An.set(this,{writable:!0,value:new Wt}),jn.set(this,{writable:!0,value:new Xt}),this.eventObjs={onMouseDown:null}}return u()(e,[{key:"init",value:function(e){var t=e.sky,n=e.render,r=e.textures,i=e.sort,o=void 0!==i&&i,a=e.loadEndCallback,s=void 0===a?null:a,u=e.components,c=void 0===u?[]:u;if(n)if(r&&(l()(this,jn).init(r),l()(this,An).Txues=l()(this,jn)),l()(this,An).init(n,this.eventObjs),this.addHdrEffect(t),c.forEach((function(t){var n=void 0===e.visible||e.visible;void 0!==t.visible&&(n=!!t.visible),t.visible=n})),o){var h=c.length,d=c.sort((function(e,t){return e.renderOrder-t.renderOrder})),p=0;this.handleSortComponents(d,p,(function(){p++,h===p&&s&&s()}))}else this.handleComponents(c)}},{key:"trans",value:function(e,t){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?In(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):In(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},void 0!==t?I.transPosition(e,t,l()(this,An)):I.transCoord((new THREE.Vector3).copy(e),l()(this,An)))}},{key:"setSize",value:function(e,t){l()(this,An).setRenderSize(e,t)}},{key:"getCameraData",value:function(){var e=l()(this,An).camera.position,t=l()(this,An).controls.target;return I.getCameraData(e,t)}},{key:"handleSortComponents",value:function(e,t,n){var r=this,i=e.shift(),o=kn[i.name];o&&this.loadComponents(o,i,t).then((function(){n(),0!==e.length&&r.handleSortComponents(e,t,n)}))}},{key:"handleComponents",value:function(e){var t=this;return e.forEach((function(e,n){var r=kn[e.name];r&&t.loadComponents(r,e,n)})),[]}},{key:"loadComponents",value:function(e,t,n){var r=this;return new Promise((function(i,o){try{t.loadEnd=function(){i()};var a=new e({render:l()(r,An),options:t});a.index=n,a.sort=t.renderSort,a.original=t,a.group.renderOrder=t.renderOrder||1,a.group.visible=t.visible,l()(r,An).addCompEft(a)}catch(e){o(e)}}))}},{key:"on",value:function(e,t,n){var r=this.getComponent(t);return!!r&&(r.bind(e,n),r)}},{key:"un",value:function(e,t,n){var r=this.getComponent(t);return!!r&&(r.unbind(e,n),r)}},{key:"getComponent",value:function(e){if("render"===e)return l()(this,An);var t=l()(this,An).subCompEffectArr;if("string"==typeof e)return t.filter((function(t){return t.options.id===e}))[0]||!1;var n=e.sort,r=e.index;return void 0!==n?t.filter((function(e){return e.sort===n}))[0]||!1:void 0!==r&&t.filter((function(e,t){return t===r}))[0]||!1}},{key:"setOption",value:function(e,t){switch(e){case"skyCube":l()(this,An).scene.background=t.visible?l()(this,An).scene.environment:void 0}}},{key:"addHdrEffect",value:function(e){var t=this;if(!e||!e.state)return!1;switch(e.type){case"hdr":l()(this,jn).loadHdr(e.url,l()(this,An).renderer).then((function(n){e.sky&&(l()(t,An).scene.background=n),l()(t,An).scene.environment=n}));break;case"cube":l()(this,jn).loadCubeSky(e.url).then((function(n){e.sky&&(l()(t,An).scene.background=n),l()(t,An).scene.environment=n}))}return!1}},{key:"dispose",value:function(){l()(this,An).dispose(),l()(this,An).subCompEffectArr.forEach((function(e){e.dispose&&e.dispose()}))}}]),e}();window.glInstance=Hn},"./editorgl/utils/detail/Tween.js":function(e,t,n){"use strict";(function(e){var n,r,i=(n=[],{getAll:function(){return n},removeAll:function(){n=[]},add:function(e){n.push(e)},remove:function(e){var t=n.indexOf(e);-1!==t&&n.splice(t,1)},update:function(e,t){if(0===n.length)return!1;var r=0;for(e=void 0!==e?e:i.now();r<n.length;)n[r].update(e)||t?r++:n.splice(r,1);return!0}});"undefined"==typeof window&&void 0!==e?i.now=function(){var t=e.hrtime();return 1e3*t[0]+t[1]/1e6}:"undefined"!=typeof window&&void 0!==window.performance&&void 0!==window.performance.now?i.now=window.performance.now.bind(window.performance):void 0!==Date.now?i.now=Date.now:i.now=function(){return(new Date).getTime()},i.Tween=function(e){var t,n=e,r={},o={},a={},s=1e3,u=0,c=!1,l=!1,h=!1,d=0,p=null,f=i.Easing.Linear.None,v=i.Interpolation.Linear,m=[],y=null,g=!1,x=null,b=null,w=null;this.to=function(e,t){return o=e,void 0!==t&&(s=t),this},this.start=function(e){for(var t in i.add(this),l=!0,g=!1,p=void 0!==e?e:i.now(),p+=d,o){if(o[t]instanceof Array){if(0===o[t].length)continue;o[t]=[n[t]].concat(o[t])}void 0!==n[t]&&(r[t]=n[t],r[t]instanceof Array==!1&&(r[t]*=1),a[t]=r[t]||0)}return this},this.stop=function(){return l?(i.remove(this),l=!1,null!==w&&w.call(n,n),this.stopChainedTweens(),this):this},this.end=function(){return this.update(p+s),this},this.stopChainedTweens=function(){for(var e=0,t=m.length;e<t;e++)m[e].stop()},this.delay=function(e){return d=e,this},this.repeat=function(e){return u=e,this},this.repeatDelay=function(e){return t=e,this},this.yoyo=function(e){return c=e,this},this.easing=function(e){return f=e,this},this.interpolation=function(e){return v=e,this},this.chain=function(){return m=arguments,this},this.onStart=function(e){return y=e,this},this.onUpdate=function(e){return x=e,this},this.onComplete=function(e){return b=e,this},this.onStop=function(e){return w=e,this},this.update=function(e){var i,l,w;if(e<p)return!0;for(i in!1===g&&(null!==y&&y.call(n,n),g=!0),w=f(l=(l=(e-p)/s)>1?1:l),o)if(void 0!==r[i]){var T=r[i]||0,E=o[i];E instanceof Array?n[i]=v(E,w):("string"==typeof E&&(E="+"===E.charAt(0)||"-"===E.charAt(0)?T+parseFloat(E):parseFloat(E)),"number"==typeof E&&(n[i]=T+(E-T)*w))}if(null!==x&&x.call(n,w),1===l){if(u>0){for(i in isFinite(u)&&u--,a){if("string"==typeof o[i]&&(a[i]=a[i]+parseFloat(o[i])),c){var _=a[i];a[i]=o[i],o[i]=_}r[i]=a[i]}return c&&(h=!h),p=void 0!==t?e+t:e+d,!0}null!==b&&b.call(n,n);for(var S=0,O=m.length;S<O;S++)m[S].start(p+s);return!1}return!0}},i.Easing={Linear:{None:function(e){return e}},Quadratic:{In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)}},Cubic:{In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)}},Quartic:{In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)}},Quintic:{In:function(e){return e*e*e*e*e},Out:function(e){return--e*e*e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}},Sinusoidal:{In:function(e){return 1-Math.cos(e*Math.PI/2)},Out:function(e){return Math.sin(e*Math.PI/2)},InOut:function(e){return.5*(1-Math.cos(Math.PI*e))}},Exponential:{In:function(e){return 0===e?0:Math.pow(1024,e-1)},Out:function(e){return 1===e?1:1-Math.pow(2,-10*e)},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(2-Math.pow(2,-10*(e-1)))}},Circular:{In:function(e){return 1-Math.sqrt(1-e*e)},Out:function(e){return Math.sqrt(1- --e*e)},InOut:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}},Elastic:{In:function(e){return 0===e?0:1===e?1:-Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)},Out:function(e){return 0===e?0:1===e?1:Math.pow(2,-10*e)*Math.sin(5*(e-.1)*Math.PI)+1},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?-.5*Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI):.5*Math.pow(2,-10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)+1}},Back:{In:function(e){var t=1.70158;return e*e*((t+1)*e-t)},Out:function(e){var t=1.70158;return--e*e*((t+1)*e+t)+1},InOut:function(e){var t=2.5949095;return(e*=2)<1?e*e*((t+1)*e-t)*.5:.5*((e-=2)*e*((t+1)*e+t)+2)}},Bounce:{In:function(e){return 1-i.Easing.Bounce.Out(1-e)},Out:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},InOut:function(e){return e<.5?.5*i.Easing.Bounce.In(2*e):.5*i.Easing.Bounce.Out(2*e-1)+.5}}},i.Interpolation={Linear:function(e,t){var n=e.length-1,r=n*t,o=Math.floor(r),a=i.Interpolation.Utils.Linear;return t<0?a(e[0],e[1],r):t>1?a(e[n],e[n-1],n-r):a(e[o],e[o+1>n?n:o+1],r-o)},Bezier:function(e,t){for(var n=0,r=e.length-1,o=Math.pow,a=i.Interpolation.Utils.Bernstein,s=0;s<=r;s++)n+=o(1-t,r-s)*o(t,s)*e[s]*a(r,s);return n},CatmullRom:function(e,t){var n=e.length-1,r=n*t,o=Math.floor(r),a=i.Interpolation.Utils.CatmullRom;return e[0]===e[n]?(t<0&&(o=Math.floor(r=n*(1+t))),a(e[(o-1+n)%n],e[o],e[(o+1)%n],e[(o+2)%n],r-o)):t<0?e[0]-(a(e[0],e[0],e[1],e[1],-r)-e[0]):t>1?e[n]-(a(e[n],e[n],e[n-1],e[n-1],r-n)-e[n]):a(e[o?o-1:0],e[o],e[n<o+1?n:o+1],e[n<o+2?n:o+2],r-o)},Utils:{Linear:function(e,t,n){return(t-e)*n+e},Bernstein:function(e,t){var n=i.Interpolation.Utils.Factorial;return n(e)/n(t)/n(e-t)},Factorial:(r=[1],function(e){var t=1;if(r[e])return r[e];for(var n=e;n>1;n--)t*=n;return r[e]=t,t}),CatmullRom:function(e,t,n,r,i){var o=.5*(n-e),a=.5*(r-t),s=i*i;return(2*t-2*n+o+a)*(i*s)+(-3*t+3*n-2*o-a)*s+o*i+t}}},t.a=i}).call(this,n("./node_modules/process/browser.js"))},"./node_modules/@babel/runtime/helpers/arrayLikeToArray.js":function(e,t){e.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r},e.exports.default=e.exports,e.exports.__esModule=!0},"./node_modules/@babel/runtime/helpers/arrayWithoutHoles.js":function(e,t,n){var r=n("./node_modules/@babel/runtime/helpers/arrayLikeToArray.js");e.exports=function(e){if(Array.isArray(e))return r(e)},e.exports.default=e.exports,e.exports.__esModule=!0},"./node_modules/@babel/runtime/helpers/assertThisInitialized.js":function(e,t){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e},e.exports.default=e.exports,e.exports.__esModule=!0},"./node_modules/@babel/runtime/helpers/classApplyDescriptorGet.js":function(e,t){e.exports=function(e,t){return t.get?t.get.call(e):t.value},e.exports.default=e.exports,e.exports.__esModule=!0},"./node_modules/@babel/runtime/helpers/classApplyDescriptorSet.js":function(e,t){e.exports=function(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=n}},e.exports.default=e.exports,e.exports.__esModule=!0},"./node_modules/@babel/runtime/helpers/classCallCheck.js":function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},e.exports.default=e.exports,e.exports.__esModule=!0},"./node_modules/@babel/runtime/helpers/classExtractFieldDescriptor.js":function(e,t){e.exports=function(e,t,n){if(!t.has(e))throw new TypeError("attempted to "+n+" private field on non-instance");return t.get(e)},e.exports.default=e.exports,e.exports.__esModule=!0},"./node_modules/@babel/runtime/helpers/classPrivateFieldGet.js":function(e,t,n){var r=n("./node_modules/@babel/runtime/helpers/classApplyDescriptorGet.js"),i=n("./node_modules/@babel/runtime/helpers/classExtractFieldDescriptor.js");e.exports=function(e,t){var n=i(e,t,"get");return r(e,n)},e.exports.default=e.exports,e.exports.__esModule=!0},"./node_modules/@babel/runtime/helpers/classPrivateFieldSet.js":function(e,t,n){var r=n("./node_modules/@babel/runtime/helpers/classApplyDescriptorSet.js"),i=n("./node_modules/@babel/runtime/helpers/classExtractFieldDescriptor.js");e.exports=function(e,t,n){var o=i(e,t,"set");return r(e,o,n),n},e.exports.default=e.exports,e.exports.__esModule=!0},"./node_modules/@babel/runtime/helpers/createClass.js":function(e,t){function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e.exports=function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e},e.exports.default=e.exports,e.exports.__esModule=!0},"./node_modules/@babel/runtime/helpers/defineProperty.js":function(e,t){e.exports=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},e.exports.default=e.exports,e.exports.__esModule=!0},"./node_modules/@babel/runtime/helpers/getPrototypeOf.js":function(e,t){function n(t){return e.exports=n=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},e.exports.default=e.exports,e.exports.__esModule=!0,n(t)}e.exports=n,e.exports.default=e.exports,e.exports.__esModule=!0},"./node_modules/@babel/runtime/helpers/inherits.js":function(e,t,n){var r=n("./node_modules/@babel/runtime/helpers/setPrototypeOf.js");e.exports=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&r(e,t)},e.exports.default=e.exports,e.exports.__esModule=!0},"./node_modules/@babel/runtime/helpers/iterableToArray.js":function(e,t){e.exports=function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)},e.exports.default=e.exports,e.exports.__esModule=!0},"./node_modules/@babel/runtime/helpers/nonIterableSpread.js":function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.default=e.exports,e.exports.__esModule=!0},"./node_modules/@babel/runtime/helpers/possibleConstructorReturn.js":function(e,t,n){var r=n("./node_modules/@babel/runtime/helpers/typeof.js").default,i=n("./node_modules/@babel/runtime/helpers/assertThisInitialized.js");e.exports=function(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?i(e):t},e.exports.default=e.exports,e.exports.__esModule=!0},"./node_modules/@babel/runtime/helpers/setPrototypeOf.js":function(e,t){function n(t,r){return e.exports=n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},e.exports.default=e.exports,e.exports.__esModule=!0,n(t,r)}e.exports=n,e.exports.default=e.exports,e.exports.__esModule=!0},"./node_modules/@babel/runtime/helpers/toConsumableArray.js":function(e,t,n){var r=n("./node_modules/@babel/runtime/helpers/arrayWithoutHoles.js"),i=n("./node_modules/@babel/runtime/helpers/iterableToArray.js"),o=n("./node_modules/@babel/runtime/helpers/unsupportedIterableToArray.js"),a=n("./node_modules/@babel/runtime/helpers/nonIterableSpread.js");e.exports=function(e){return r(e)||i(e)||o(e)||a()},e.exports.default=e.exports,e.exports.__esModule=!0},"./node_modules/@babel/runtime/helpers/typeof.js":function(e,t){function n(t){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?(e.exports=n=function(e){return typeof e},e.exports.default=e.exports,e.exports.__esModule=!0):(e.exports=n=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.default=e.exports,e.exports.__esModule=!0),n(t)}e.exports=n,e.exports.default=e.exports,e.exports.__esModule=!0},"./node_modules/@babel/runtime/helpers/unsupportedIterableToArray.js":function(e,t,n){var r=n("./node_modules/@babel/runtime/helpers/arrayLikeToArray.js");e.exports=function(e,t){if(e){if("string"==typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}},e.exports.default=e.exports,e.exports.__esModule=!0},"./node_modules/process/browser.js":function(e,t){var n,r,i=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(e){if(n===setTimeout)return setTimeout(e,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:o}catch(e){n=o}try{r="function"==typeof clearTimeout?clearTimeout:a}catch(e){r=a}}();var u,c=[],l=!1,h=-1;function d(){l&&u&&(l=!1,u.length?c=u.concat(c):h=-1,c.length&&p())}function p(){if(!l){var e=s(d);l=!0;for(var t=c.length;t;){for(u=c,c=[];++h<t;)u&&u[h].run();h=-1,t=c.length}u=null,l=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===a||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function v(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new f(e,t)),1!==c.length||l||s(p)},f.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=v,i.addListener=v,i.once=v,i.off=v,i.removeListener=v,i.removeAllListeners=v,i.emit=v,i.prependListener=v,i.prependOnceListener=v,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}}});